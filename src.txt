// SRC BUNDLE 2025-10-13T12:10:43.612Z

/* FILE: src/api/axios.config.ts */
// src/api/axios.config.ts
import axios from 'axios';
import { useAuthStore } from '../store/authStore';

const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  headers: { 'Content-Type': 'application/json', Accept: 'application/json' },
});

api.interceptors.request.use((config) => {
  const token = useAuthStore.getState().token;
  if (token) config.headers.Authorization = `Bearer ${token}`;
  return config;
});

api.interceptors.response.use(
  (response) => response, // keep AxiosResponse
  (error) => {
    const { response } = error || {};
    const structuredError = {
      status: response?.status,
      message:
        response?.data?.message ||
        response?.data?.error ||
        'Something went wrong',
      errors: response?.data?.errors ?? null,
    };
    // Override Axios default text
    error.message = structuredError.message;
    return Promise.reject(structuredError); // or Promise.reject(error);
  }
);

export default api;

/* FILE: src/api/handlers/adminSupplierZones.api.ts */
// src/api/handlers/adminSupplierZones.api.ts
import api from '../axios.config';

export interface DeliveryZone {
  address: string;
  lat: number;
  long: number;
  radius: number;
}

export interface SupplierWithZones {
  id: number;
  name: string;
  email: string;
  profile_image?: string;
  delivery_zones: DeliveryZone[];
}

export interface PaginatedSuppliersResponse {
  current_page: number;
  data: SupplierWithZones[];
  first_page_url: string;
  from: number;
  last_page: number;
  last_page_url: string;
  links: Array<{
    url: string | null;
    label: string;
    page: number | null;
    active: boolean;
  }>;
  next_page_url: string | null;
  path: string;
  per_page: number;
  prev_page_url: string | null;
  to: number;
  total: number;
}

export interface AdminSupplierZonesParams {
  page?: number;
  per_page?: number;
  search?: string;
}

export const adminSupplierZonesAPI = {
  /**
   * Get all suppliers with their delivery zones (paginated)
   */
  getSuppliersWithZones: async (
    params: AdminSupplierZonesParams = {}
  ): Promise<PaginatedSuppliersResponse> => {
    try {
      const response = await api.get('/suppliers-with-zones', { params });
      return response.data;
    } catch (error: any) {
      throw new Error(
        error?.message || 'Failed to fetch suppliers with zones'
      );
    }
  },
};
/* FILE: src/api/handlers/auth.api.ts */
// src/api/handlers/auth.api.ts
import api from '../axios.config';

interface LoginCredentials {
  email: string;
  password: string;
}

interface ClientRegistrationData {
  name: string;
  email: string;
  password: string;
  contact_name: string;
  contact_number: string;
  shipping_address: string;
  billing_address: string;
  company_name?: string;
  profile_image?: File;
  lat: number; long: number; 
}

interface SupplierRegistrationData {
  name: string;
  email: string;
  password: string;
  contact_name: string;
  contact_number: string;
  location: string;
  delivery_radius: number;
  company_name: string;
  profile_image?: File;
}

export const authAPI = {
  login: async (credentials: LoginCredentials) => {
    try {
        const res = await api.post('/login', credentials);
        return res.data;
      } catch (e: any) {
        const msg =
          e?.message ||
          e?.response?.data?.error ||
          (e?.status === 401 ? 'Invalid credentials' : 'Something went wrong');
        throw new Error(msg);
      }
  },

  // ✅ FIXED: Client Registration with FormData
  registerClient: async (data) => {
  const formData = new FormData();
  formData.append('name', data.name);
  formData.append('email', data.email);
  formData.append('password', data.password);
  formData.append('contact_name', data.contact_name);
  formData.append('contact_number', data.contact_number);
  formData.append('shipping_address', data.shipping_address);
  formData.append('billing_address', data.billing_address);
  if (data.company_name) formData.append('company_name', data.company_name);
  if (data.profile_image) formData.append('profile_image', data.profile_image);
  formData.append('lat', String(data.lat));    // ← send
  formData.append('long', String(data.long));  // ← send
  return api.post('/register/client', formData, { headers: { 'Content-Type': 'multipart/form-data' }});
},

  // ✅ FIXED: Supplier Registration with FormData
  registerSupplier: async (data: SupplierRegistrationData) => {
    const formData = new FormData();
    
    // Append all fields to FormData
    formData.append('name', data.name);
    formData.append('email', data.email);
    formData.append('password', data.password);
    formData.append('contact_name', data.contact_name);
    formData.append('contact_number', data.contact_number);
    formData.append('location', data.location);
    formData.append('company_name', data.company_name);
    
    // ✅ CRITICAL: Properly append file
    if (data.profile_image) {
      formData.append('profile_image', data.profile_image);
    }
    
    return await api.post('/register/supplier', formData, {
      headers: { 
        'Content-Type': 'multipart/form-data' 
      },
    });
  },

  logout: async () => {
    return await api.post('/logout');
  },

  checkAuth: async () => {
    return await api.get('/user');
  },
};
/* FILE: src/api/handlers/masterProducts.api.ts */
// FILE PATH: src/api/handlers/masterProducts.api.ts

/**
 * Master Products API Handler
 * 
 * This service handles all API calls related to Master Products.
 * Following the project's pattern:
 * - Uses centralized axios config from src/api/axios.config.ts
 * - TypeScript interfaces for type safety
 * - Structured error handling
 * - Returns response.data directly
 */

import api from '../axios.config';

// ===========================
// TypeScript Interfaces
// ===========================

export interface Category {
  id: number;
  name: string;
}

export interface User {
  id: number;
  name: string;
  email: string;
  profile_image?: string | null;
}

export interface MasterProduct {
  id: number;
  added_by: User;
  is_approved: 0 | 1;
  approved_by: User | null;
  slug: string;
  category: Category;
  product_name: string;
  product_type: string;
  specifications: string;
  unit_of_measure: string;
  tech_doc: string | null;
  photo: string | null;
  created_at: string;
  updated_at: string;
  supplierOffersCount: number;
}

export interface SupplierOffer {
  id: number;
  supplier_id: number;
  supplier: User;
  master_product_id: number;
  price: number;
  // Add other fields as needed
}

export interface MasterProductWithOffers extends MasterProduct {
  supplierOffers: SupplierOffer[];
}

export interface PaginatedMasterProductsResponse {
  current_page: number;
  data: MasterProduct[];
  first_page_url: string;
  from: number;
  last_page: number;
  last_page_url: string;
  links: Array<{
    url: string | null;
    label: string;
    page: number | null;
    active: boolean;
  }>;
  next_page_url: string | null;
  path: string;
  per_page: number;
  prev_page_url: string | null;
  to: number;
  total: number;
}

export interface MasterProductsFilters {
  page?: number;
  per_page?: number;
  search?: string;
  category?: string;
  is_approved?: 0 | 1;
}

export interface CreateMasterProductPayload {
  product_name: string;
  product_type: string;
  specifications?: string;
  unit_of_measure?: string;
  tech_doc?: File;
  photo?: File;
  is_approved?: boolean;
  category?: string;
}

export interface UpdateMasterProductPayload extends Partial<CreateMasterProductPayload> {}

// ===========================
// API Handler
// ===========================

export const masterProductsAPI = {
  /**
   * Get paginated list of master products
   * 
   * WHY: Fetch all products with pagination and optional filters
   * HOW: Sends GET request to /master-products with query params
   * 
   * @param filters - Pagination and filter options
   * @returns Paginated product list
   */
  getAll: async (filters: MasterProductsFilters = {}): Promise<PaginatedMasterProductsResponse> => {
    try {
      const response = await api.get('/master-products', { params: filters });
      return response.data;
    } catch (error: any) {
      throw new Error(
        error?.message || 'Failed to fetch master products'
      );
    }
  },

  /**
   * Get single master product by ID
   * 
   * WHY: Fetch detailed product info including supplier offers
   * HOW: Sends GET request to /master-products/{id}
   * 
   * @param id - Product ID
   * @returns Product details with supplier offers
   */
  getById: async (id: number): Promise<MasterProductWithOffers> => {
    try {
      const response = await api.get(`/master-products/${id}`);
      return response.data;
    } catch (error: any) {
      throw new Error(
        error?.message || `Failed to fetch product with ID ${id}`
      );
    }
  },

  /**
   * Create new master product
   * 
   * WHY: Add new product to the system
   * HOW: Converts payload to FormData and sends POST request
   * 
   * @param payload - Product data
   * @returns Created product data
   */
  create: async (payload: CreateMasterProductPayload): Promise<{ message: string; product: MasterProduct }> => {
    try {
      const formData = new FormData();
      
      // Append all fields to FormData
      formData.append('product_name', payload.product_name);
      formData.append('product_type', payload.product_type);
      
      if (payload.specifications) formData.append('specifications', payload.specifications);
      if (payload.unit_of_measure) formData.append('unit_of_measure', payload.unit_of_measure);
      if (payload.category) formData.append('category', payload.category);
      if (payload.is_approved !== undefined) formData.append('is_approved', payload.is_approved ? '1' : '0');
      
      // Append files if present
      if (payload.tech_doc) formData.append('tech_doc', payload.tech_doc);
      if (payload.photo) formData.append('photo', payload.photo);

      const response = await api.post('/master-products', formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
      
      return response.data;
    } catch (error: any) {
      throw new Error(
        error?.message || 'Failed to create product'
      );
    }
  },

  /**
   * Update existing master product
   * 
   * WHY: Modify product details
   * HOW: Converts payload to FormData and sends POST to /master-products/{id}
   *      (Laravel uses POST for file uploads with _method spoofing)
   * 
   * @param id - Product ID
   * @param payload - Updated product data (only changed fields)
   * @returns Updated product data
   */
  update: async (id: number, payload: UpdateMasterProductPayload): Promise<{ message: string; product: MasterProduct }> => {
    try {
      const formData = new FormData();
      
      // Append only provided fields
      if (payload.product_name) formData.append('product_name', payload.product_name);
      if (payload.product_type) formData.append('product_type', payload.product_type);
      if (payload.specifications) formData.append('specifications', payload.specifications);
      if (payload.unit_of_measure) formData.append('unit_of_measure', payload.unit_of_measure);
      if (payload.category) formData.append('category', payload.category);
      if (payload.is_approved !== undefined) formData.append('is_approved', payload.is_approved ? '1' : '0');
      
      // Append files if present
      if (payload.tech_doc) formData.append('tech_doc', payload.tech_doc);
      if (payload.photo) formData.append('photo', payload.photo);

      const response = await api.post(`/master-products/${id}`, formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
      
      return response.data;
    } catch (error: any) {
      throw new Error(
        error?.message || `Failed to update product with ID ${id}`
      );
    }
  },

  /**
   * Toggle product approval status (Active/Inactive)
   * 
   * WHY: Admin needs to activate/deactivate products
   * HOW: Sends partial update with only is_approved field
   * 
   * @param id - Product ID
   * @param isApproved - New approval status
   * @returns Updated product data
   */
  toggleApproval: async (id: number, isApproved: boolean): Promise<{ message: string; product: MasterProduct }> => {
    try {
      const formData = new FormData();
      formData.append('is_approved', isApproved ? '1' : '0');
      
      const response = await api.post(`/master-products/${id}`, formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
      
      return response.data;
    } catch (error: any) {
      throw new Error(
        error?.message || `Failed to toggle approval for product ID ${id}`
      );
    }
  },

  /**
   * Delete master product
   * 
   * WHY: Remove product from system
   * HOW: Sends DELETE request to /master-products/{id}
   * 
   * @param id - Product ID
   * @returns Success message
   */
  delete: async (id: number): Promise<{ message: string }> => {
    try {
      const response = await api.delete(`/master-products/${id}`);
      return response.data;
    } catch (error: any) {
      throw new Error(
        error?.message || `Failed to delete product with ID ${id}`
      );
    }
  },
};
/* FILE: src/api/handlers/profile.api.ts */
// src/api/handlers/profile.api.ts
import api from '../axios.config';

interface UpdateProfileData {
  name?: string;
  email?: string;
  contact_name?: string;
  contact_number?: string;
  company_name?: string;
  profile_image?: File;
  
  // Client-specific
  shipping_address?: string;
  billing_address?: string;
  lat?: number;
  long?: number;
  
  // Supplier-specific
  location?: string;
  delivery_radius?: number;
}

interface ChangePasswordData {
  current_password: string;
  new_password: string;
  new_password_confirmation: string;
}

export const profileAPI = {
  /**
   * Update user profile - only sends changed fields
   * @param data - Partial profile data (only dirty fields)
   */
  updateProfile: async (data: UpdateProfileData) => {
    try {
      const formData = new FormData();
      
      // Append only the fields that are present in data object
      Object.entries(data).forEach(([key, value]) => {
        if (value !== undefined && value !== null) {
          if (key === 'profile_image' && value instanceof File) {
            formData.append('profile_image', value);
          } else if (typeof value === 'number') {
            formData.append(key, String(value));
          } else {
            formData.append(key, value as string);
          }
        }
      });

      const response = await api.post('/profile', formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });

      return response.data;
    } catch (error: any) {
      throw new Error(
        error?.response?.data?.message || 
        error?.message || 
        'Failed to update profile'
      );
    }
  },

  /**
   * Change user password
   * @param data - Current and new password
   * @returns response with message and new token
   */
  changePassword: async (data: ChangePasswordData) => {
    try {
      const response = await api.post('/change-password', data);
      return response.data; // { message: "Password updated", token: "..." }
    } catch (error: any) {
      // Handle structured error from backend
      if (error?.response?.data?.error) {
        const errors = error.response.data.error;
        
        // Check if it's a validation error object
        if (typeof errors === 'object') {
          const firstError = Object.values(errors)[0];
          throw new Error(
            Array.isArray(firstError) ? firstError[0] : String(firstError)
          );
        }
        
        throw new Error(String(errors));
      }
      
      throw new Error(
        error?.message || 
        'Failed to change password'
      );
    }
  },

  /**
   * Get current user profile
   */
  getCurrentUser: async () => {
    try {
      const response = await api.get('/user');
      return response.data;
    } catch (error: any) {
      throw new Error(
        error?.response?.data?.message || 
        error?.message || 
        'Failed to fetch user data'
      );
    }
  },
};
/* FILE: src/api/handlers/projects.api.ts */
// --- src/api/handlers/projects.api.ts ---
import api from '../axios.config';

export interface ProjectDTO {
  id: number;
  name: string;
  site_contact_name?: string | null;
  site_contact_phone?: string | null;
  site_instructions?: string | null;
  added_by: number;
  created_at: string;
  updated_at: string;
}

export interface Paginated<T> { data: T[]; meta: { page: number; per_page: number; total: number } }

export type ProjectCreateInput = {
  name: string;
  site_contact_name?: string | null;
  site_contact_phone?: string | null;
  site_instructions?: string | null;
};

export type ProjectUpdateInput = Partial<ProjectCreateInput> & { id: number };

const BASE = '/projects';

export const projectsAPI = {
  list: (params: Record<string, unknown>) => api.get<Paginated<ProjectDTO>>(BASE, { params }).then(r => r.data),
  get:  (id: number) => api.get<ProjectDTO>(`${BASE}/${id}`).then(r => r.data),
  create: (payload: ProjectCreateInput) => api.post<ProjectDTO>(BASE, payload).then(r => r.data),
  update: ({ id, ...payload }: ProjectUpdateInput) => api.put<ProjectDTO>(`${BASE}/${id}`, payload).then(r => r.data),
  remove: (id: number) => api.delete(`${BASE}/${id}`).then(r => r.data),
};
/* FILE: src/api/handlers/supplierProducts.api.ts */
// FILE PATH: src/api/handlers/supplierProducts.api.ts
/**
 * SUPPLIER PRODUCTS API - UPDATED
 * 
 * CHANGES:
 * ✅ Added price to RequestProductPayload
 * ✅ Added availability_status to RequestProductPayload  
 * ✅ Updated requestMasterProduct function to send new fields
 */

import axiosInstance from '../axios.config';

// ==================== TYPE DEFINITIONS ====================

export interface Category {
  id: number;
  name: string;
  created_at: string;
  updated_at: string;
}

export interface AddedBy {
  id: number;
  name: string;
  email: string;
  profile_image: string | null;
}

export interface ProductCategory {
  id: number;
  name: string;
}

export interface Supplier {
  id: number;
  name: string;
  email: string;
  profile_image: string | null;
  delivery_zones: Array<{
    address: string;
    lat: number;
    long: number;
    radius: number;
  }>;
}

export interface SupplierOffer {
  id: number;
  supplier_id: number;
  master_product_id: number;
  price: string;
  availability_status: string;
  status: string;
  created_at: string;
  updated_at: string;
  isMe: boolean;
  supplier: Supplier;
  pivot?: {
    price: string;
    availability_status: string;
    is_active: boolean;
    admin_approval_status: string;
  };
}

export interface MasterProduct {
  id: number;
  added_by: AddedBy;
  is_approved: number;
  approved_by: AddedBy | null;
  slug: string;
  category: ProductCategory;
  product_name: string;
  product_type: string;
  specifications: string;
  unit_of_measure: string;
  tech_doc: string | null;
  photo: string;
  created_at: string;
  updated_at: string;
  supplierOffersCount: number;
  suppliers: SupplierOffer[];
}

export interface ProductsResponse {
  current_page: number;
  data: MasterProduct[];
  first_page_url: string;
  from: number;
  last_page: number;
  last_page_url: string;
  links: Array<{
    url: string | null;
    label: string;
    page: number | null;
    active: boolean;
  }>;
  next_page_url: string | null;
  path: string;
  per_page: number;
  prev_page_url: string | null;
  to: number;
  total: number;
}

export interface CategoriesResponse {
  current_page: number;
  data: Category[];
  first_page_url: string;
  from: number;
  last_page: number;
  last_page_url: string;
  links: Array<{
    url: string | null;
    label: string;
    page: number | null;
    active: boolean;
  }>;
  next_page_url: string | null;
  path: string;
  per_page: number;
  prev_page_url: string | null;
  to: number;
  total: number;
}

export interface AddOfferPayload {
  master_product_id: number;
  price: number;
  availability_status: string;
}

export interface UpdateOfferPayload {
  price: number;
  availability_status: string;
}

// ========== UPDATED: Request Product Payload with NEW FIELDS ==========
export interface RequestProductPayload {
  product_name: string;
  product_type: string;
  category_id: number;
  specifications: string;
  unit_of_measure: string;
  price: string;                    // ✅ NEW FIELD
  availability_status: string;      // ✅ NEW FIELD
  photo?: File | null;
}

export interface OfferStatus {
  id: number;
  supplier_id: number;
  master_product_id: number;
  price: string;
  availability_status: string;
  status: string;
  created_at: string;
  updated_at: string;
}

// ==================== API FUNCTIONS ====================

/**
 * Get all master products with supplier offers
 */
export const getProducts = async (params?: {
  page?: number;
  per_page?: number;
  search?: string;
  category_id?: number;
}): Promise<ProductsResponse> => {
  const response = await axiosInstance.get('/master-product-inventory', { params });
  return response.data;
};

/**
 * Get all categories
 */
export const getCategories = async (): Promise<CategoriesResponse> => {
  const response = await axiosInstance.get('/categories');
  return response.data;
};

/**
 * Add product to supplier offers
 */
export const addSupplierOffer = async (payload: AddOfferPayload): Promise<{ message: string }> => {
  const response = await axiosInstance.post('/supplier-offers', payload);
  return response.data;
};

/**
 * Update supplier offer (price/availability)
 */
export const updateSupplierOffer = async (
  offerId: number,
  payload: UpdateOfferPayload
): Promise<{ message: string }> => {
  const response = await axiosInstance.put(`/update-pricing/${offerId}`, payload);
  return response.data;
};

/**
 * Delete supplier offer
 */
export const deleteSupplierOffer = async (offerId: number): Promise<{ message: string }> => {
  const response = await axiosInstance.delete(`/supplier-offers/${offerId}`);
  return response.data;
};

/**
 * Request new master product - UPDATED WITH NEW FIELDS
 * 
 * WHAT: Submit request for new product to be added to master catalog
 * WHY: Suppliers can request products not in the system
 * HOW: Sends FormData with all fields including NEW price and availability_status
 */
export const requestMasterProduct = async (payload: RequestProductPayload): Promise<{ message: string }> => {
  const formData = new FormData();
  
  // Existing fields
  formData.append('product_name', payload.product_name);
  formData.append('product_type', payload.product_type);
  formData.append('category_id', payload.category_id.toString());
  formData.append('specifications', payload.specifications);
  formData.append('unit_of_measure', payload.unit_of_measure);
  
  // ✅ NEW FIELDS
  formData.append('price', payload.price);
  formData.append('availability_status', payload.availability_status);
  
  // Optional photo
  if (payload.photo) {
    formData.append('photo', payload.photo);
  }

  const response = await axiosInstance.post('/request-master-product', formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
  
  return response.data;
};

/**
 * Get supplier offer status
 */
export const getOfferStatus = async (): Promise<OfferStatus[]> => {
  const response = await axiosInstance.get('/supplier-offer-status');
  return response.data;
};

// Export as default object
export const supplierProductsAPI = {
  getProducts,
  getCategories,
  addSupplierOffer,
  updateSupplierOffer,
  deleteSupplierOffer,
  requestMasterProduct,
  getOfferStatus,
};
/* FILE: src/api/handlers/users.api.ts */
// src/api/handlers/users.api.ts
import api from '../axios.config';

export interface UserFilters {
  role?: string;
  company_id?: string;
  contact_name?: string;
  location?: string;
  lat?: number;
  long?: number;
  isDeleted?: boolean;
  page?: number;
  per_page?: number;
}

export interface User {
  id: number;
  name: string;
  email: string;
  role: 'admin' | 'client' | 'supplier';
  company_id?: number;
  company?: {
    id: number;
    name: string;
  };
  contact_name?: string;
  contact_number?: string;
  location?: string;
  lat?: number;
  long?: number;
  delivery_radius?: number;
  shipping_address?: string;
  billing_address?: string;
  client_public_id?: string;
  profile_image?: string;
  isDeleted: boolean;
  notes?: string;
  created_at: string;
  updated_at: string;
}

export interface PaginatedUsers {
  current_page: number;
  data: User[];
  first_page_url: string;
  from: number;
  last_page: number;
  last_page_url: string;
  next_page_url: string | null;
  path: string;
  per_page: number;
  prev_page_url: string | null;
  to: number;
  total: number;
}

export const usersAPI = {
  /**
   * Get paginated list of users with filters
   */
  getUsers: async (params: UserFilters): Promise<PaginatedUsers> => {
    try {
      const response = await api.get('/users', { params });
      return response.data;
    } catch (error: any) {
      throw new Error(error?.message || 'Failed to fetch users');
    }
  },

  /**
   * Get single user by ID
   */
  getUser: async (id: number): Promise<User> => {
    try {
      const response = await api.get(`/users/${id}`);
      return response.data;
    } catch (error: any) {
      throw new Error(error?.message || 'Failed to fetch user details');
    }
  },

  /**
   * Create new user
   */
  createUser: async (data: FormData) => {
    try {
      const response = await api.post('/users', data, {
        headers: { 'Content-Type': 'multipart/form-data' },
      });
      return response.data;
    } catch (error: any) {
      throw new Error(error?.message || 'Failed to create user');
    }
  },

  /**
   * Update existing user
   */
  updateUser: async (id: number, data: FormData) => {
    try {
      const response = await api.post(`/users/${id}`, data, {
        headers: { 'Content-Type': 'multipart/form-data' },
      });
      return response.data;
    } catch (error: any) {
      throw new Error(error?.message || 'Failed to update user');
    }
  },

  /**
   * Soft delete or restore user (toggle)
   */
  deleteRestoreUser: async (id: number) => {
    try {
      const response = await api.get(`/user-delete-restore/${id}`);
      return response.data;
    } catch (error: any) {
      throw new Error(error?.message || 'Failed to update user status');
    }
  },

  /**
   * Check if company exists
   */
  checkCompany: async (companyName: string) => {
    try {
      const response = await api.post('/check-company', { company_name: companyName });
      return response.data;
    } catch (error: any) {
      throw new Error(error?.message || 'Failed to check company');
    }
  },
};

/**
 * Companies API - separate concern
 */
export const companiesAPI = {
  /**
   * Get all companies (no pagination from your backend)
   */
  getAll: async () => {
    try {
      const response = await api.get('/companies');
      return response.data;
    } catch (error: any) {
      throw new Error(error?.message || 'Failed to fetch companies');
    }
  },
};
/* FILE: src/api/handlers/zones.api.ts */
// src/api/handlers/zones.api.ts
import api from '../axios.config';

export interface DeliveryZone {
  address: string;
  lat: number;
  long: number;
  radius: number;
}

export interface ZonesResponse {
  delivery_zones: DeliveryZone[];
}

export interface SaveZonesResponse {
  message: string;
  delivery_zones: DeliveryZone[];
}

export const zonesAPI = {
  getZones: async (): Promise<ZonesResponse> => {
    try {
      const response = await api.get('/delivery-zones');
      return response.data;
    } catch (error: any) {
      throw new Error(error?.message || 'Failed to fetch delivery zones');
    }
  },

  saveZones: async (zones: DeliveryZone[]): Promise<SaveZonesResponse> => {
    try {
      const response = await api.post('/delivery-zones', { zones });
      return response.data;
    } catch (error: any) {
      throw new Error(error?.message || 'Failed to save delivery zones');
    }
  },
};
/* FILE: src/App.css */
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

/* FILE: src/App.tsx */
// src/App.tsx
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import AppRouter from "./routes";
import ToasterProvider from "./components/common/Toaster"; // Changed from ToasterProvider
import "./index.css";

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      refetchOnWindowFocus: false,
      retry: 1,
      staleTime: 5 * 60 * 1000, // 5 minutes
    },
  },
});

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <ToasterProvider />
      <AppRouter />
    </QueryClientProvider>
  );
}

export default App;
/* FILE: src/components/admin/AdminSupplierZonesMapView.tsx */
// src/components/admin/AdminSupplierZonesMapView.tsx
import React, { useEffect, useRef, useState } from 'react';
import { Loader2, AlertCircle, MapPin } from 'lucide-react';
import { SupplierWithZones } from '../../api/handlers/adminSupplierZones.api';

interface MapViewProps {
  suppliers: SupplierWithZones[];
  supplierColors: Map<number, string>;
}

declare global {
  interface Window {
    google: any;
  }
}

const AdminSupplierZonesMapView: React.FC<MapViewProps> = ({ suppliers, supplierColors }) => {
  const mapRef = useRef<HTMLDivElement>(null);
  const [map, setMap] = useState<google.maps.Map | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const markersRef = useRef<google.maps.Marker[]>([]);
  const circlesRef = useRef<google.maps.Circle[]>([]);
  const [visibleSuppliers, setVisibleSuppliers] = useState<Set<number>>(
    new Set(suppliers.map(s => s.id))
  );

  // Initialize map
  useEffect(() => {
    const initWhenReady = () => {
      if (!mapRef.current) {
        requestAnimationFrame(initWhenReady);
        return;
      }
      if (!window.google || !window.google.maps) return;

      try {
        const defaultCenter = { lat: -25.2744, lng: 133.7751 }; // Australia center
        
        const mapInstance = new window.google.maps.Map(mapRef.current, {
          center: defaultCenter,
          zoom: 4,
          mapTypeControl: true,
          streetViewControl: false,
          fullscreenControl: true,
        });

        setMap(mapInstance);
        setLoading(false);
      } catch (e) {
        setError('Failed to initialize map');
        setLoading(false);
      }
    };

    // Check if already loaded
    if (window.google && window.google.maps) {
      initWhenReady();
      return;
    }

    // Check for existing script
    const existing = document.getElementById('google-maps-script') as HTMLScriptElement | null;
    if (existing) {
      existing.addEventListener('load', initWhenReady, { once: true });
      return;
    }

    // Load script
    const apiKey = import.meta.env.VITE_GOOGLE_MAPS_API_KEY;
    if (!apiKey) {
      setError('Missing VITE_GOOGLE_MAPS_API_KEY');
      setLoading(false);
      return;
    }

    const script = document.createElement('script');
    script.id = 'google-maps-script';
    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places`;
    script.async = true;
    script.defer = true;
    script.onload = initWhenReady;
    script.onerror = () => {
      setError('Failed to load Google Maps');
      setLoading(false);
    };
    document.head.appendChild(script);

    return () => {
      markersRef.current.forEach(m => m.setMap(null));
      circlesRef.current.forEach(c => c.setMap(null));
    };
  }, []);

  // Draw zones on map
  useEffect(() => {
    if (!map || !window.google) return;

    // Clear old markers and circles
    markersRef.current.forEach(m => m.setMap(null));
    circlesRef.current.forEach(c => c.setMap(null));
    markersRef.current = [];
    circlesRef.current = [];

    const bounds = new window.google.maps.LatLngBounds();
    let hasZones = false;

    suppliers.forEach((supplier) => {
      if (!visibleSuppliers.has(supplier.id)) return;
      if (supplier.delivery_zones.length === 0) return;

      const color = supplierColors.get(supplier.id) || '#3B82F6';

      supplier.delivery_zones.forEach((zone, zoneIdx) => {
        const pos = { lat: zone.lat, lng: zone.long };

        // Create marker
        const marker = new window.google.maps.Marker({
          position: pos,
          map,
          title: `${supplier.name} - Zone ${zoneIdx + 1}`,
          label: {
            text: String(zoneIdx + 1),
            color: 'white',
            fontWeight: 'bold',
          },
          icon: {
            path: window.google.maps.SymbolPath.CIRCLE,
            scale: 14,
            fillColor: color,
            fillOpacity: 1,
            strokeColor: 'white',
            strokeWeight: 3,
          },
        });

        // Create InfoWindow
        const infoWindow = new window.google.maps.InfoWindow({
          content: `
            <div style="padding:12px;max-width:280px">
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
                <div style="width:12px;height:12px;border-radius:50%;background-color:${color}"></div>
                <h3 style="margin:0;font-weight:700;color:#111827;font-size:16px">${supplier.name}</h3>
              </div>
              <div style="font-size:13px;color:#374151;line-height:1.6">
                <div style="margin-bottom:4px"><strong>Zone ${zoneIdx + 1}</strong></div>
                <div style="margin-bottom:4px">📍 ${zone.address}</div>
                <div style="margin-bottom:4px"><strong>Radius:</strong> ${zone.radius} km</div>
                <div style="margin-bottom:4px"><strong>Coverage:</strong> ~${(Math.PI * zone.radius * zone.radius).toFixed(0)} km²</div>
                <div style="color:#6B7280;font-size:11px;margin-top:6px">
                  ${zone.lat.toFixed(6)}, ${zone.long.toFixed(6)}
                </div>
              </div>
            </div>
          `,
        });

        marker.addListener('click', () => infoWindow.open(map, marker));

        // Create circle
        const circle = new window.google.maps.Circle({
          strokeColor: color,
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: color,
          fillOpacity: 0.15,
          map,
          center: pos,
          radius: zone.radius * 1000, // km to meters
        });

        markersRef.current.push(marker);
        circlesRef.current.push(circle);
        bounds.extend(pos);
        hasZones = true;
      });
    });

    // Fit bounds
    if (hasZones) {
      map.fitBounds(bounds);
    }
  }, [map, suppliers, supplierColors, visibleSuppliers]);

  const toggleSupplierVisibility = (supplierId: number) => {
    setVisibleSuppliers((prev) => {
      const newSet = new Set(prev);
      if (newSet.has(supplierId)) {
        newSet.delete(supplierId);
      } else {
        newSet.add(supplierId);
      }
      return newSet;
    });
  };

  const showAllSuppliers = () => {
    setVisibleSuppliers(new Set(suppliers.map(s => s.id)));
  };

  const hideAllSuppliers = () => {
    setVisibleSuppliers(new Set());
  };

  const suppliersWithZones = suppliers.filter(s => s.delivery_zones.length > 0);

  return (
    <div className="bg-white rounded-xl border-2 border-secondary-200 p-6">
      <div className="relative">
        {/* Map Container */}
        <div
          ref={mapRef}
          className="w-full h-[600px] rounded-lg overflow-hidden border border-secondary-200"
        />

        {/* Loading Overlay */}
        {loading && (
          <div className="absolute inset-0 flex items-center justify-center bg-white/70 z-10">
            <div className="text-center">
              <Loader2 className="animate-spin text-primary-600 mx-auto mb-2" size={40} />
              <p className="text-secondary-600">Loading map...</p>
            </div>
          </div>
        )}

        {/* Error Overlay */}
        {error && (
          <div className="absolute inset-0 flex flex-col items-center justify-center bg-white/90 p-6 text-center z-10">
            <AlertCircle className="text-error-600 mb-2" size={28} />
            <p className="text-error-700 font-medium mb-1">Map Loading Error</p>
            <p className="text-sm text-secondary-600">{error}</p>
          </div>
        )}
      </div>

      {/* Legend */}
      {suppliersWithZones.length > 0 ? (
        <div className="mt-4 p-4 bg-secondary-50 rounded-lg">
          <div className="flex items-center justify-between mb-3">
            <p className="text-sm font-semibold text-secondary-900">Supplier Legend</p>
            <div className="flex gap-2">
              <button
                onClick={showAllSuppliers}
                className="text-xs px-3 py-1 bg-primary-100 text-primary-700 rounded hover:bg-primary-200 transition-colors"
              >
                Show All
              </button>
              <button
                onClick={hideAllSuppliers}
                className="text-xs px-3 py-1 bg-secondary-200 text-secondary-700 rounded hover:bg-secondary-300 transition-colors"
              >
                Hide All
              </button>
            </div>
          </div>
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 max-h-48 overflow-y-auto">
            {suppliersWithZones.map((supplier) => {
              const color = supplierColors.get(supplier.id) || '#3B82F6';
              const isVisible = visibleSuppliers.has(supplier.id);

              return (
                <button
                  key={supplier.id}
                  onClick={() => toggleSupplierVisibility(supplier.id)}
                  className={`flex items-center gap-2 p-2 rounded border-2 transition-all text-left ${
                    isVisible
                      ? 'border-secondary-300 bg-white hover:border-primary-300'
                      : 'border-secondary-200 bg-secondary-100 opacity-50 hover:opacity-75'
                  }`}
                >
                  <div
                    className="w-4 h-4 rounded-full border-2 border-white shadow-sm flex-shrink-0"
                    style={{ backgroundColor: color }}
                  />
                  <div className="flex-1 min-w-0">
                    <p className="text-xs font-medium text-secondary-900 truncate">
                      {supplier.name}
                    </p>
                    <p className="text-xs text-secondary-600">
                      {supplier.delivery_zones.length} zone{supplier.delivery_zones.length !== 1 ? 's' : ''}
                    </p>
                  </div>
                </button>
              );
            })}
          </div>
        </div>
      ) : (
        <div className="h-32 flex flex-col items-center justify-center text-secondary-600 mt-4">
          <MapPin className="mb-2 text-secondary-400" size={20} />
          <p className="text-sm">No delivery zones to display</p>
        </div>
      )}
    </div>
  );
};

export default AdminSupplierZonesMapView;
/* FILE: src/components/admin/AdminSupplierZonesStats.tsx */
// src/components/admin/AdminSupplierZonesStats.tsx
import React, { useMemo } from 'react';
import { Users, MapPin, Layers, TrendingUp } from 'lucide-react';
import { SupplierWithZones } from '../../api/handlers/adminSupplierZones.api';

interface StatsProps {
  suppliers: SupplierWithZones[];
  totalSuppliers: number;
}

const AdminSupplierZonesStats: React.FC<StatsProps> = ({ suppliers, totalSuppliers }) => {
  const stats = useMemo(() => {
    const totalZones = suppliers.reduce((sum, s) => sum + s.delivery_zones.length, 0);
    
    const totalCoverage = suppliers.reduce((sum, supplier) => {
      const supplierCoverage = supplier.delivery_zones.reduce((zoneSum, zone) => {
        return zoneSum + (Math.PI * zone.radius * zone.radius);
      }, 0);
      return sum + supplierCoverage;
    }, 0);

    const allRadii = suppliers.flatMap(s => s.delivery_zones.map(z => z.radius));
    const avgRadius = allRadii.length > 0 
      ? allRadii.reduce((sum, r) => sum + r, 0) / allRadii.length 
      : 0;

    const suppliersWithZones = suppliers.filter(s => s.delivery_zones.length > 0).length;
    const suppliersWithoutZones = totalSuppliers - suppliersWithZones;

    return {
      totalSuppliers,
      totalZones,
      totalCoverage: totalCoverage.toFixed(0),
      avgRadius: avgRadius.toFixed(1),
      suppliersWithZones,
      suppliersWithoutZones,
    };
  }, [suppliers, totalSuppliers]);

  const statCards = [
    {
      icon: Users,
      label: 'Total Suppliers',
      value: stats.totalSuppliers,
      subtext: `${stats.suppliersWithZones} with zones`,
      bgColor: 'bg-primary-100',
      iconColor: 'text-primary-600',
    },
    {
      icon: MapPin,
      label: 'Total Zones',
      value: stats.totalZones,
      subtext: `Across ${stats.suppliersWithZones} suppliers`,
      bgColor: 'bg-success-100',
      iconColor: 'text-success-600',
    },
    {
      icon: Layers,
      label: 'Total Coverage',
      value: `${stats.totalCoverage} km²`,
      subtext: 'Combined area',
      bgColor: 'bg-warning-100',
      iconColor: 'text-warning-600',
    },
    {
      icon: TrendingUp,
      label: 'Avg Radius',
      value: `${stats.avgRadius} km`,
      subtext: 'Per delivery zone',
      bgColor: 'bg-secondary-100',
      iconColor: 'text-secondary-600',
    },
  ];

  return (
    <div className="bg-white rounded-xl border-2 border-secondary-200 p-6">
      <h2 className="text-lg font-bold text-secondary-900 mb-4">System Statistics</h2>
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {statCards.map((stat, index) => (
          <div key={index} className="flex items-center gap-4">
            <div className={`w-12 h-12 rounded-lg ${stat.bgColor} flex items-center justify-center flex-shrink-0`}>
              <stat.icon size={24} className={stat.iconColor} />
            </div>
            <div className="flex-1 min-w-0">
              <p className="text-sm text-secondary-600 mb-1">{stat.label}</p>
              <p className="text-2xl font-bold text-secondary-900 truncate">{stat.value}</p>
              <p className="text-xs text-secondary-500">{stat.subtext}</p>
            </div>
          </div>
        ))}
      </div>

      {stats.suppliersWithoutZones > 0 && (
        <div className="mt-4 p-3 bg-warning-50 border border-warning-200 rounded-lg">
          <p className="text-sm text-warning-700">
            ⚠️ <strong>{stats.suppliersWithoutZones}</strong> supplier{stats.suppliersWithoutZones > 1 ? 's' : ''} without delivery zones
          </p>
        </div>
      )}
    </div>
  );
};

export default AdminSupplierZonesStats;
/* FILE: src/components/admin/SupplierZoneCard.tsx */
// src/components/admin/SupplierZoneCard.tsx
import React, { useState } from 'react';
import { MapPin, Mail, ChevronDown, ChevronUp, Layers } from 'lucide-react';
import { SupplierWithZones } from '../../api/handlers/adminSupplierZones.api';

interface SupplierZoneCardProps {
  supplier: SupplierWithZones;
  color: string;
}

const SupplierZoneCard: React.FC<SupplierZoneCardProps> = ({ supplier, color }) => {
  const [isExpanded, setIsExpanded] = useState(false);

  const totalCoverage = supplier.delivery_zones.reduce((sum, zone) => {
    return sum + (Math.PI * zone.radius * zone.radius);
  }, 0);

  const hasZones = supplier.delivery_zones.length > 0;

  return (
    <div 
      className="bg-white rounded-xl border-2 hover:border-primary-300 hover:shadow-lg transition-all overflow-hidden"
      style={{ borderLeftColor: color, borderLeftWidth: '6px' }}
    >
      {/* Header */}
      <div className="p-6">
        <div className="flex items-start gap-4 mb-4">
          {/* Profile Image */}
          <div 
            className="w-16 h-16 rounded-full flex items-center justify-center flex-shrink-0 border-4"
            style={{ borderColor: color + '40' }}
          >
            {supplier.profile_image ? (
              <img
                src={`${import.meta.env.VITE_IMAGE_BASE_URL}${supplier.profile_image}`}
                alt={supplier.name}
                className="w-full h-full rounded-full object-cover"
              />
            ) : (
              <div 
                className="w-full h-full rounded-full flex items-center justify-center text-white font-bold text-xl"
                style={{ backgroundColor: color }}
              >
                {supplier.name.charAt(0).toUpperCase()}
              </div>
            )}
          </div>

          {/* Supplier Info */}
          <div className="flex-1 min-w-0">
            <h3 className="text-lg font-bold text-secondary-900 truncate mb-1">
              {supplier.name}
            </h3>
            <div className="flex items-center gap-2 text-sm text-secondary-600 mb-2">
              <Mail size={14} />
              <span className="truncate">{supplier.email}</span>
            </div>
            
            {/* Zone Stats */}
            <div className="flex items-center gap-4 text-sm">
              <span className="inline-flex items-center gap-1 text-secondary-700">
                <MapPin size={14} />
                <strong>{supplier.delivery_zones.length}</strong> Zone{supplier.delivery_zones.length !== 1 ? 's' : ''}
              </span>
              {hasZones && (
                <span className="inline-flex items-center gap-1 text-secondary-700">
                  <Layers size={14} />
                  <strong>~{totalCoverage.toFixed(0)}</strong> km²
                </span>
              )}
            </div>
          </div>
        </div>

        {/* Zone Summary */}
        {!hasZones ? (
          <div className="bg-secondary-50 rounded-lg p-4 text-center">
            <p className="text-sm text-secondary-600">No delivery zones configured</p>
          </div>
        ) : (
          <>
            {/* Show first 2 zones */}
            <div className="space-y-2">
              {supplier.delivery_zones.slice(0, isExpanded ? undefined : 2).map((zone, idx) => (
                <div 
                  key={idx}
                  className="flex items-start gap-3 p-3 bg-secondary-50 rounded-lg"
                >
                  <div 
                    className="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm flex-shrink-0"
                    style={{ backgroundColor: color }}
                  >
                    {idx + 1}
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="text-sm font-medium text-secondary-900 line-clamp-2 mb-1">
                      {zone.address}
                    </p>
                    <div className="flex items-center gap-3 text-xs text-secondary-600">
                      <span>📍 {zone.lat.toFixed(4)}, {zone.long.toFixed(4)}</span>
                      <span className="font-semibold text-primary-600">{zone.radius} km radius</span>
                    </div>
                    <p className="text-xs text-secondary-500 mt-1">
                      Coverage: ~{(Math.PI * zone.radius * zone.radius).toFixed(0)} km²
                    </p>
                  </div>
                </div>
              ))}
            </div>

            {/* Expand/Collapse Button */}
            {supplier.delivery_zones.length > 2 && (
              <button
                onClick={() => setIsExpanded(!isExpanded)}
                className="w-full mt-3 flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-primary-600 hover:bg-primary-50 rounded-lg transition-colors"
              >
                {isExpanded ? (
                  <>
                    <ChevronUp size={16} />
                    Show Less
                  </>
                ) : (
                  <>
                    <ChevronDown size={16} />
                    Show {supplier.delivery_zones.length - 2} More Zone{supplier.delivery_zones.length - 2 > 1 ? 's' : ''}
                  </>
                )}
              </button>
            )}
          </>
        )}
      </div>
    </div>
  );
};

export default SupplierZoneCard;
/* FILE: src/components/common/Buttons.tsx */
// src/components/common/Buttons.tsx
import { Loader2 } from 'lucide-react';
import { ButtonHTMLAttributes, ReactNode } from 'react';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  children: ReactNode;
  variant?: 'primary' | 'secondary' | 'outline' | 'ghost';
  isLoading?: boolean;
  fullWidth?: boolean;
}

const Button = ({ 
  children, 
  variant = 'primary', 
  isLoading = false, 
  disabled = false,
  type = 'button',
  fullWidth = true,
  className = '',
  ...props 
}: ButtonProps) => {
  const baseStyles = `${fullWidth ? 'w-full' : ''} px-4 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed`;
  
  const variants = {
    primary: "bg-primary-500 text-white hover:bg-primary-600 active:bg-primary-700 shadow-sm hover:shadow-md",
    secondary: "bg-secondary-100 text-secondary-900 hover:bg-secondary-200 active:bg-secondary-300",
    outline: "border-2 border-primary-500 text-primary-500 hover:bg-primary-50 active:bg-primary-100",
    ghost: "text-primary-500 hover:bg-primary-50 active:bg-primary-100",
  };

  return (
    <button
      type={type}
      disabled={disabled || isLoading}
      className={`${baseStyles} ${variants[variant]} ${className}`}
      {...props}
    >
      {isLoading && <Loader2 className="w-5 h-5 animate-spin" />}
      {children}
    </button>
  );
};

export default Button;
/* FILE: src/components/common/ConfirmModal.tsx */
// FILE PATH: src/components/common/ConfirmModal.tsx

/**
 * ConfirmModal Component
 * 
 * Reusable confirmation modal for destructive or important actions.
 * 
 * Features:
 * - Customizable title, message, and button text
 * - Danger mode (red) or normal mode (blue)
 * - Loading state during action
 * - Backdrop click to cancel
 */

import React, { useEffect } from 'react';

interface ConfirmModalProps {
  isOpen: boolean;
  onClose: () => void;
  onConfirm: () => void;
  title?: string;
  message?: string;
  confirmText?: string;
  cancelText?: string;
  isDanger?: boolean;
  loading?: boolean;
}

const ConfirmModal: React.FC<ConfirmModalProps> = ({ 
  isOpen,
  onClose,
  onConfirm,
  title = "Confirm Action",
  message = "Are you sure you want to proceed?",
  confirmText = "Confirm",
  cancelText = "Cancel",
  isDanger = false,
  loading = false
}) => {
  // Handle ESC key to close modal
  useEffect(() => {
    const handleEsc = (e: KeyboardEvent) => {
      if (e.key === 'Escape' && !loading) {
        onClose();
      }
    };
    
    if (isOpen) {
      document.addEventListener('keydown', handleEsc);
      // Prevent body scroll when modal is open
      document.body.style.overflow = 'hidden';
    }
    
    return () => {
      document.removeEventListener('keydown', handleEsc);
      document.body.style.overflow = 'unset';
    };
  }, [isOpen, loading, onClose]);

  if (!isOpen) return null;

  const handleBackdropClick = (e: React.MouseEvent<HTMLDivElement>) => {
    if (e.target === e.currentTarget && !loading) {
      onClose();
    }
  };

  const confirmButtonClass = isDanger
    ? "bg-red-600 hover:bg-red-700 focus:ring-red-500"
    : "bg-blue-600 hover:bg-blue-700 focus:ring-blue-500";

  return (
    <div 
      className="fixed inset-0 z-50 overflow-y-auto"
      aria-labelledby="modal-title" 
      role="dialog" 
      aria-modal="true"
    >
      {/* Backdrop */}
      <div 
        className="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0"
        onClick={handleBackdropClick}
      >
        {/* Background overlay */}
        <div 
          className="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75" 
          aria-hidden="true"
        ></div>

        {/* Center modal */}
        <span 
          className="hidden sm:inline-block sm:align-middle sm:h-screen" 
          aria-hidden="true"
        >
          &#8203;
        </span>

        {/* Modal panel */}
        <div className="inline-block overflow-hidden text-left align-bottom transition-all transform bg-white rounded-lg shadow-xl sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
          <div className="px-4 pt-5 pb-4 bg-white sm:p-6 sm:pb-4">
            <div className="sm:flex sm:items-start">
              {/* Icon */}
              <div className={`flex items-center justify-center flex-shrink-0 w-12 h-12 mx-auto rounded-full sm:mx-0 sm:h-10 sm:w-10 ${
                isDanger ? 'bg-red-100' : 'bg-blue-100'
              }`}>
                {isDanger ? (
                  <svg 
                    className="w-6 h-6 text-red-600" 
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                  >
                    <path 
                      strokeLinecap="round" 
                      strokeLinejoin="round" 
                      strokeWidth="2" 
                      d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" 
                    />
                  </svg>
                ) : (
                  <svg 
                    className="w-6 h-6 text-blue-600" 
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                  >
                    <path 
                      strokeLinecap="round" 
                      strokeLinejoin="round" 
                      strokeWidth="2" 
                      d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" 
                    />
                  </svg>
                )}
              </div>

              {/* Content */}
              <div className="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                <h3 
                  className="text-lg font-medium leading-6 text-gray-900" 
                  id="modal-title"
                >
                  {title}
                </h3>
                <div className="mt-2">
                  <p className="text-sm text-gray-500">
                    {message}
                  </p>
                </div>
              </div>
            </div>
          </div>

          {/* Actions */}
          <div className="px-4 py-3 bg-gray-50 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="button"
              onClick={onConfirm}
              disabled={loading}
              className={`inline-flex justify-center w-full px-4 py-2 text-base font-medium text-white border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm ${confirmButtonClass} ${
                loading ? 'opacity-50 cursor-not-allowed' : ''
              }`}
            >
              {loading ? (
                <>
                  <svg 
                    className="w-5 h-5 mr-2 -ml-1 animate-spin" 
                    fill="none" 
                    viewBox="0 0 24 24"
                  >
                    <circle 
                      className="opacity-25" 
                      cx="12" 
                      cy="12" 
                      r="10" 
                      stroke="currentColor" 
                      strokeWidth="4"
                    ></circle>
                    <path 
                      className="opacity-75" 
                      fill="currentColor" 
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                    ></path>
                  </svg>
                  Processing...
                </>
              ) : (
                confirmText
              )}
            </button>
            <button
              type="button"
              onClick={onClose}
              disabled={loading}
              className={`inline-flex justify-center w-full px-4 py-2 mt-3 text-base font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm ${
                loading ? 'opacity-50 cursor-not-allowed' : ''
              }`}
            >
              {cancelText}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ConfirmModal;
/* FILE: src/components/common/ImageUpload.tsx */
// src/components/common/ImageUpload.tsx
import { useState, ChangeEvent } from 'react';
import { Upload, X, Image as ImageIcon } from 'lucide-react';

interface ImageUploadProps {
  label?: string;
  onChange: (file: File | null) => void;
  error?: string;
  currentImage?: string | null;
}

const ImageUpload = ({ 
  label, 
  onChange, 
  error, 
  currentImage = null 
}: ImageUploadProps) => {
  const [preview, setPreview] = useState<string | null>(currentImage);

  const handleFileChange = (e: ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      // Validate file type
      if (!file.type.startsWith('image/')) {
        onChange(null);
        return;
      }

      // Validate file size (max 2MB)
      if (file.size > 2 * 1024 * 1024) {
        onChange(null);
        return;
      }

      // Create preview
      const reader = new FileReader();
      reader.onloadend = () => {
        setPreview(reader.result as string);
      };
      reader.readAsDataURL(file);
      
      onChange(file);
    }
  };

  const clearImage = () => {
    setPreview(null);
    onChange(null);
  };

  return (
    <div className="space-y-2">
      {label && (
        <label className="block text-sm font-medium text-secondary-700">
          {label}
        </label>
      )}

      <div className="flex items-start gap-4">
        {/* Preview */}
        {preview ? (
          <div className="relative w-32 h-32 rounded-lg overflow-hidden border-2 border-secondary-200 bg-secondary-50">
            <img 
              src={preview} 
              alt="Preview" 
              className="w-full h-full object-cover"
            />
            <button
              type="button"
              onClick={clearImage}
              className="absolute top-2 right-2 p-1 bg-error-500 text-white rounded-full hover:bg-error-600 transition-colors"
            >
              <X size={16} />
            </button>
          </div>
        ) : (
          <div className="w-32 h-32 rounded-lg border-2 border-dashed border-secondary-300 bg-secondary-50 flex items-center justify-center">
            <ImageIcon size={32} className="text-secondary-400" />
          </div>
        )}

        {/* Upload Button */}
        <div className="flex-1">
          <label className="cursor-pointer">
            <input
              type="file"
              accept="image/*"
              onChange={handleFileChange}
              className="hidden"
            />
            <div className="flex items-center gap-2 px-4 py-3 border-2 border-secondary-300 rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-all">
              <Upload size={20} className="text-secondary-600" />
              <span className="text-sm text-secondary-700">
                {preview ? 'Change Image' : 'Upload Image'}
              </span>
            </div>
          </label>
          <p className="text-xs text-secondary-500 mt-2">
            PNG, JPG, GIF up to 2MB
          </p>
        </div>
      </div>

      {error && (
        <p className="text-sm text-error-500">{error}</p>
      )}
    </div>
  );
};

export default ImageUpload;
/* FILE: src/components/common/Input.tsx */
// src/components/common/Input.tsx
import { Eye, EyeOff, LucideIcon } from 'lucide-react';
import { useState, InputHTMLAttributes } from 'react';
import { UseFormRegisterReturn } from 'react-hook-form';

interface InputProps extends Omit<InputHTMLAttributes<HTMLInputElement>, 'type'> {
  label?: string;
  error?: string;
  type?: 'text' | 'email' | 'password' | 'number' | 'tel';
  register?: UseFormRegisterReturn;
  icon?: LucideIcon;
}

const Input = ({ 
  label, 
  error, 
  type = 'text',
  register,
  icon: Icon,
  ...props 
}: InputProps) => {
  const [showPassword, setShowPassword] = useState(false);
  const isPassword = type === 'password';
  const inputType = isPassword && showPassword ? 'text' : type;

  return (
    <div className="space-y-2">
      {label && (
        <label className="block text-sm font-medium text-secondary-700">
          {label}
          {props.required && <span className="text-error-500 ml-1">*</span>}
        </label>
      )}
      
      <div className="relative">
        {Icon && (
          <div className="absolute left-3 top-1/2 -translate-y-1/2 text-secondary-400">
            <Icon size={20} />
          </div>
        )}
        
        <input
          type={inputType}
          className={`
            w-full px-4 py-3 rounded-lg border-2 transition-all
            ${Icon ? 'pl-10' : ''}
            ${isPassword ? 'pr-10' : ''}
            ${error 
              ? 'border-error-500 focus:border-error-500 focus:ring-error-500' 
              : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
            }
            focus:outline-none focus:ring-2 focus:ring-opacity-20
            disabled:bg-secondary-50 disabled:cursor-not-allowed
          `}
          {...register}
          {...props}
        />
        
        {isPassword && (
          <button
            type="button"
            onClick={() => setShowPassword(!showPassword)}
            className="absolute right-3 top-1/2 -translate-y-1/2 text-secondary-400 hover:text-secondary-600"
          >
            {showPassword ? <EyeOff size={20} /> : <Eye size={20} />}
          </button>
        )}
      </div>
      
      {error && (
        <p className="text-sm text-error-500 flex items-center gap-1">
          {error}
        </p>
      )}
    </div>
  );
};

export default Input;
/* FILE: src/components/common/Input2.tsx */
// src/components/common/Input2.tsx
import { Eye, EyeOff } from 'lucide-react';
import { useState, InputHTMLAttributes, ReactNode, FC } from 'react';
import { UseFormRegisterReturn } from 'react-hook-form';

// ✅ Type for Lucide Icon components
type LucideIconType = FC<{ size?: number | string; className?: string }>;

interface Input2Props extends Omit<InputHTMLAttributes<HTMLInputElement>, 'type'> {
  label?: string;
  error?: string;
  type?: 'text' | 'email' | 'password' | 'number' | 'tel';
  register?: UseFormRegisterReturn;
  icon?: LucideIconType; // ✅ Only accept Lucide component type
}

const Input2 = ({ 
  label, 
  error, 
  type = 'text',
  register,
  icon: IconComponent, // ✅ Renamed for clarity
  ...props 
}: Input2Props) => {
  const [showPassword, setShowPassword] = useState(false);
  const isPassword = type === 'password';
  const inputType = isPassword && showPassword ? 'text' : type;

  return (
    <div className="space-y-2">
      {label && (
        <label className="block text-sm font-medium text-secondary-700">
          {label}
          {props.required && <span className="text-error-500 ml-1">*</span>}
        </label>
      )}
      
      <div className="relative">
        {IconComponent && (
          <div className="absolute left-3 top-1/2 -translate-y-1/2 text-secondary-400">
            {/* ✅ Properly render the Lucide icon component */}
            <IconComponent size={20} />
          </div>
        )}
        
        <input
          type={inputType}
          className={`
            w-full px-4 py-3 rounded-lg border-2 transition-all
            ${IconComponent ? 'pl-10' : ''}
            ${isPassword ? 'pr-10' : ''}
            ${error 
              ? 'border-error-500 focus:border-error-500 focus:ring-error-500' 
              : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
            }
            focus:outline-none focus:ring-2 focus:ring-opacity-20
            disabled:bg-secondary-50 disabled:cursor-not-allowed
          `}
          {...register}
          {...props}
        />
        
        {isPassword && (
          <button
            type="button"
            onClick={() => setShowPassword(!showPassword)}
            className="absolute right-3 top-1/2 -translate-y-1/2 text-secondary-400 hover:text-secondary-600"
          >
            {showPassword ? <EyeOff size={20} /> : <Eye size={20} />}
          </button>
        )}
      </div>

      {error && (
        <p className="text-sm text-error-500">{error}</p>
      )}
    </div>
  );
};

export default Input2;
/* FILE: src/components/common/LocationPicker.tsx */
// src/components/common/LocationPicker.tsx
import { useState, useEffect, useRef } from 'react';
import { MapPin, Loader2 } from 'lucide-react';
import { Loader } from '@googlemaps/js-api-loader';

interface LocationPickerProps {
  onLocationSelect: (location: { lat: number; lng: number }) => void;
  initialLocation?: { lat: number; lng: number } | null;
  error?: string;
}

const LocationPicker = ({ 
  onLocationSelect, 
  initialLocation = null,
  error 
}: LocationPickerProps) => {
  const [map, setMap] = useState<google.maps.Map | null>(null);
  const [marker, setMarker] = useState<google.maps.Marker | null>(null);
  const [loading, setLoading] = useState(true);
  const [selectedLocation, setSelectedLocation] = useState<{ lat: number; lng: number } | null>(initialLocation);
  const mapRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const initMap = async () => {
      try {
        const loader = new Loader({
          apiKey: import.meta.env.VITE_GOOGLE_MAPS_API_KEY || '',
          version: 'weekly',
        });

        await loader.load();

        if (!mapRef.current) return;

        const mapInstance = new google.maps.Map(mapRef.current, {
          center: initialLocation || { lat: 24.8607, lng: 67.0011 }, // Karachi default
          zoom: 12,
          mapTypeControl: false,
        });

        setMap(mapInstance);

        // Add click listener
        mapInstance.addListener('click', (e: google.maps.MapMouseEvent) => {
          if (e.latLng) {
            const lat = e.latLng.lat();
            const lng = e.latLng.lng();
            updateLocation(lat, lng, mapInstance);
          }
        });

        // Set initial marker if location provided
        if (initialLocation) {
          updateLocation(initialLocation.lat, initialLocation.lng, mapInstance);
        }

        setLoading(false);
      } catch (error) {
        console.error('Error loading Google Maps:', error);
        setLoading(false);
      }
    };

    initMap();
  }, []);

  const updateLocation = (lat: number, lng: number, mapInstance: google.maps.Map) => {
    // Remove old marker
    if (marker) {
      marker.setMap(null);
    }

    // Create new marker
    const newMarker = new google.maps.Marker({
      position: { lat, lng },
      map: mapInstance,
      draggable: true,
    });

    // Update marker drag
    newMarker.addListener('dragend', (e: google.maps.MapMouseEvent) => {
      if (e.latLng) {
        const newLat = e.latLng.lat();
        const newLng = e.latLng.lng();
        setSelectedLocation({ lat: newLat, lng: newLng });
        onLocationSelect({ lat: newLat, lng: newLng });
      }
    });

    setMarker(newMarker);
    setSelectedLocation({ lat, lng });
    onLocationSelect({ lat, lng });
  };

  const getCurrentLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          if (map) {
            map.setCenter({ lat, lng });
            updateLocation(lat, lng, map);
          }
        },
        () => {
          alert('Could not get your location');
        }
      );
    } else {
      alert('Geolocation is not supported by your browser');
    }
  };

  return (
    <div className="space-y-2">
      <label className="block text-sm font-medium text-secondary-700">
        Select Location on Map
        <span className="text-error-500 ml-1">*</span>
      </label>

      <div className="relative">
        {loading && (
          <div className="absolute inset-0 bg-secondary-100 rounded-lg flex items-center justify-center z-10">
            <Loader2 className="w-8 h-8 animate-spin text-primary-500" />
          </div>
        )}
        
        <div 
          ref={mapRef}
          className="w-full h-64 rounded-lg border-2 border-secondary-200"
        />
        
        <button
          type="button"
          onClick={getCurrentLocation}
          className="absolute bottom-4 right-4 bg-white p-3 rounded-lg shadow-lg hover:shadow-xl transition-shadow border border-secondary-200"
        >
          <MapPin size={20} className="text-primary-500" />
        </button>
      </div>

      {selectedLocation && (
        <div className="text-sm text-secondary-600 bg-secondary-50 p-3 rounded-lg">
          <strong>Selected:</strong> {selectedLocation.lat.toFixed(6)}, {selectedLocation.lng.toFixed(6)}
        </div>
      )}

      {error && (
        <p className="text-sm text-error-500">{error}</p>
      )}
    </div>
  );
};

export default LocationPicker;
/* FILE: src/components/common/LocationPickerSimple.tsx */
// src/components/common/LocationPickerSimple.tsx
import { MapPin } from 'lucide-react';
import { useEffect } from 'react';

interface LocationPickerSimpleProps {
  onLocationSelect: (location: { lat: number; lng: number }) => void;
  initialLocation?: { lat: number; lng: number } | null;
  error?: string;
  currentLat?: number;
  currentLng?: number;
}

const LocationPickerSimple = ({ 
  onLocationSelect, 
  initialLocation = null,
  error,
  currentLat,
  currentLng
}: LocationPickerSimpleProps) => {
  
  // Update parent when initial location changes
  useEffect(() => {
    if (initialLocation) {
      onLocationSelect(initialLocation);
    }
  }, [initialLocation]);

  const handleLatChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const lat = parseFloat(e.target.value);
    if (!isNaN(lat)) {
      onLocationSelect({ 
        lat, 
        lng: currentLng || initialLocation?.lng || 0 
      });
    }
  };

  const handleLngChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const lng = parseFloat(e.target.value);
    if (!isNaN(lng)) {
      onLocationSelect({ 
        lat: currentLat || initialLocation?.lat || 0, 
        lng 
      });
    }
  };

  const getCurrentLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          onLocationSelect({ lat, lng });
        },
        () => {
          alert('Could not get your location. Please check location permissions.');
        }
      );
    } else {
      alert('Geolocation is not supported by your browser');
    }
  };

  const displayLat = currentLat || initialLocation?.lat || '';
  const displayLng = currentLng || initialLocation?.lng || '';

  return (
    <div className="space-y-2">
      <label className="block text-sm font-medium text-secondary-700">
        Business Location Coordinates
        <span className="text-error-500 ml-1">*</span>
      </label>

      <div className="grid grid-cols-2 gap-4">
        <div>
          <label className="block text-xs text-secondary-600 mb-1">Latitude</label>
          <input
            type="number"
            step="any"
            placeholder="24.8607"
            value={displayLat}
            onChange={handleLatChange}
            className={`
              w-full px-4 py-3 rounded-lg border-2 transition-all
              ${error 
                ? 'border-error-500 focus:border-error-500 focus:ring-error-500' 
                : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
              }
              focus:outline-none focus:ring-2 focus:ring-opacity-20
            `}
          />
        </div>

        <div>
          <label className="block text-xs text-secondary-600 mb-1">Longitude</label>
          <input
            type="number"
            step="any"
            placeholder="67.0011"
            value={displayLng}
            onChange={handleLngChange}
            className={`
              w-full px-4 py-3 rounded-lg border-2 transition-all
              ${error 
                ? 'border-error-500 focus:border-error-500 focus:ring-error-500' 
                : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
              }
              focus:outline-none focus:ring-2 focus:ring-opacity-20
            `}
          />
        </div>
      </div>

      <button
        type="button"
        onClick={getCurrentLocation}
        className="flex items-center gap-2 px-4 py-2 text-sm text-primary-600 bg-primary-50 rounded-lg hover:bg-primary-100 transition-colors"
      >
        <MapPin size={16} />
        Use My Current Location
      </button>

      {error && (
        <p className="text-sm text-error-500">{error}</p>
      )}

      {displayLat && displayLng && (
        <div className="bg-success-50 border border-success-200 rounded-lg p-3">
          <p className="text-xs text-success-700 font-medium">
            ✓ Location Set: {displayLat}, {displayLng}
          </p>
        </div>
      )}

      <p className="text-xs text-secondary-500">
        💡 Tip: Select your address above and coordinates will auto-fill, or use "Use My Current Location"
      </p>
    </div>
  );
};

export default LocationPickerSimple;
/* FILE: src/components/common/Pagination.tsx */
// FILE PATH: src/components/common/Pagination.tsx

/**
 * Pagination Component
 * 
 * Handles pagination display and navigation.
 * Works with Laravel's pagination response format.
 * 
 * Features:
 * - Previous/Next buttons
 * - Page number display
 * - Total items count
 * - Responsive design
 */

import React from 'react';

interface PaginationProps {
  currentPage: number;
  lastPage: number;
  total: number;
  perPage: number;
  onPageChange: (page: number) => void;
  loading?: boolean;
}

const Pagination: React.FC<PaginationProps> = ({ 
  currentPage, 
  lastPage, 
  total, 
  perPage,
  onPageChange,
  loading = false 
}) => {
  // ✅ FIX: Handle edge cases properly
  const startItem = total === 0 ? 0 : Math.max(1, ((currentPage - 1) * perPage) + 1);
  const endItem = total === 0 ? 0 : Math.min(currentPage * perPage, total);

  const handlePrevious = () => {
    if (currentPage > 1 && !loading) {
      onPageChange(currentPage - 1);
    }
  };

  const handleNext = () => {
    if (currentPage < lastPage && !loading) {
      onPageChange(currentPage + 1);
    }
  };

  const handlePageClick = (page: number) => {
    if (page !== currentPage && !loading) {
      onPageChange(page);
    }
  };

  // Generate page numbers to display
  const getPageNumbers = (): (number | string)[] => {
    const pages: (number | string)[] = [];
    const maxPagesToShow = 5;
    
    if (lastPage <= maxPagesToShow) {
      // Show all pages if total pages is less than max
      for (let i = 1; i <= lastPage; i++) {
        pages.push(i);
      }
    } else {
      // Show first, last, current, and nearby pages
      const start = Math.max(1, currentPage - 2);
      const end = Math.min(lastPage, currentPage + 2);
      
      if (start > 1) {
        pages.push(1);
        if (start > 2) pages.push('...');
      }
      
      for (let i = start; i <= end; i++) {
        pages.push(i);
      }
      
      if (end < lastPage) {
        if (end < lastPage - 1) pages.push('...');
        pages.push(lastPage);
      }
    }
    
    return pages;
  };

  if (total === 0) {
    return null;
  }

  return (
    <div className="flex items-center justify-between px-4 py-3 bg-white border-t border-gray-200 sm:px-6">
      {/* Mobile view */}
      <div className="flex justify-between flex-1 sm:hidden">
        <button
          onClick={handlePrevious}
          disabled={currentPage === 1 || loading}
          className="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Previous
        </button>
        <button
          onClick={handleNext}
          disabled={currentPage === lastPage || loading}
          className="relative ml-3 inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          Next
        </button>
      </div>

      {/* Desktop view */}
      <div className="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
        <div>
          <p className="text-sm text-gray-700">
            Showing <span className="font-medium">{startItem}</span> to{' '}
            <span className="font-medium">{endItem}</span> of{' '}
            <span className="font-medium">{total}</span> results
          </p>
        </div>
        <div>
          <nav className="inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
            {/* Previous Button */}
            <button
              onClick={handlePrevious}
              disabled={currentPage === 1 || loading}
              className="relative inline-flex items-center px-2 py-2 text-gray-400 rounded-l-md border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span className="sr-only">Previous</span>
              <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" />
              </svg>
            </button>

            {/* Page Numbers */}
            {getPageNumbers().map((page, index) => (
              page === '...' ? (
                <span
                  key={`ellipsis-${index}`}
                  className="relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300"
                >
                  ...
                </span>
              ) : (
                <button
                  key={`page-${page}`}
                  onClick={() => handlePageClick(Number(page))}
                  disabled={loading}
                  className={`relative inline-flex items-center px-4 py-2 text-sm font-medium border ${
                    page === currentPage
                      ? 'z-10 bg-blue-600 border-blue-600 text-white'
                      : 'bg-white border-gray-300 text-gray-700 hover:bg-gray-50'
                  } ${loading ? 'cursor-not-allowed opacity-50' : ''}`}
                >
                  {page}
                </button>
              )
            ))}

            {/* Next Button */}
            <button
              onClick={handleNext}
              disabled={currentPage === lastPage || loading}
              className="relative inline-flex items-center px-2 py-2 text-gray-400 rounded-r-md border border-gray-300 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <span className="sr-only">Next</span>
              <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" />
              </svg>
            </button>
          </nav>
        </div>
      </div>
    </div>
  );
};

export default Pagination;
/* FILE: src/components/common/StatusBadge.tsx */
// FILE PATH: src/components/common/StatusBadge.tsx

/**
 * StatusBadge Component
 * 
 * Displays approval status as a badge with toggle functionality.
 * - Green badge for "Active" (is_approved = 1)
 * - Red badge for "Inactive" (is_approved = 0)
 * - Optional: Click to toggle status (with confirmation)
 */

import React from 'react';

interface StatusBadgeProps {
  isApproved: boolean;
  onToggle?: () => void;
  loading?: boolean;
  disabled?: boolean;
}

const StatusBadge: React.FC<StatusBadgeProps> = ({ 
  isApproved, 
  onToggle, 
  loading = false,
  disabled = false 
}) => {
  const handleClick = () => {
    if (onToggle && !disabled && !loading) {
      onToggle();
    }
  };

  const baseClasses = "px-3 py-1 rounded-full text-xs font-semibold inline-flex items-center gap-2";
  const interactiveClasses = onToggle && !disabled 
    ? "cursor-pointer hover:opacity-80 transition-opacity" 
    : "";
  
  const statusClasses = isApproved
    ? "bg-green-100 text-green-800 border border-green-300"
    : "bg-red-100 text-red-800 border border-red-300";

  return (
    <span 
      className={`${baseClasses} ${statusClasses} ${interactiveClasses} ${disabled ? 'opacity-50 cursor-not-allowed' : ''}`}
      onClick={handleClick}
      title={onToggle ? 'Click to toggle status' : ''}
    >
      <span className={`w-2 h-2 rounded-full ${isApproved ? 'bg-green-500' : 'bg-red-500'}`}></span>
      {loading ? (
        <span className="animate-pulse">Processing...</span>
      ) : (
        <span>{isApproved ? 'Active' : 'Inactive'}</span>
      )}
    </span>
  );
};

export default StatusBadge;
/* FILE: src/components/common/Toaster.tsx */
// src/components/common/Toaster.jsx
import { Toaster } from 'react-hot-toast';

const ToasterProvider = () => {
  return (
    <Toaster
      position="top-right"
      toastOptions={{
        duration: 4000,
        style: {
          background: '#fff',
          color: '#0f172a',
          padding: '16px',
          borderRadius: '8px',
          boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)',
        },
        success: {
          iconTheme: {
            primary: '#10b981',
            secondary: '#fff',
          },
        },
        error: {
          iconTheme: {
            primary: '#ef4444',
            secondary: '#fff',
          },
        },
      }}
    />
  );
};

export default ToasterProvider;
/* FILE: src/components/layout/DashboardLayout.tsx */
// src/components/layout/DashboardLayout.tsx
import { ReactNode, useState } from 'react';
import { Link, useNavigate, useLocation } from 'react-router-dom';
import { 
  Menu, 
  X, 
  LogOut, 
  User, 
  Settings,
  ChevronDown
} from 'lucide-react';
import { useAuthStore } from '../../store/authStore';
import toast from 'react-hot-toast';

interface DashboardLayoutProps {
  children: ReactNode;
  menuItems: Array<{
    label: string;
    path: string;
    icon: ReactNode;
  }>;
}

const DashboardLayout = ({ children, menuItems }: DashboardLayoutProps) => {
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [profileDropdown, setProfileDropdown] = useState(false);
  const { user, logout } = useAuthStore();
  const navigate = useNavigate();
  const location = useLocation();

  const handleLogout = () => {
    logout();
    toast.success('Logged out successfully');
    navigate('/login');
  };

  // ✅ Navigate to profile page based on user role
  const handleProfileClick = () => {
    setProfileDropdown(false);
    navigate(`/${user?.role}/profile`);
  };

  const isActive = (path: string) => location.pathname === path;

  return (
    <div className="min-h-screen bg-secondary-50">
      {/* Header */}
      <header className="bg-white border-b border-secondary-200 fixed top-0 left-0 right-0 z-40">
        <div className="flex items-center justify-between px-4 py-4">
          {/* Mobile Menu Button */}
          <button
            onClick={() => setSidebarOpen(!sidebarOpen)}
            className="lg:hidden p-2 rounded-lg hover:bg-secondary-100 transition-colors"
          >
            {sidebarOpen ? <X size={24} /> : <Menu size={24} />}
          </button>

          {/* Logo */}
          <div className="flex items-center gap-3">
            <img
              src="https://demowebportals.com/material_connect/public/assets/img/logo-text.png"
              alt="Material Connect"
              className="h-8"
            />
          </div>

          {/* Profile Dropdown */}
          <div className="relative">
            <button
              onClick={() => setProfileDropdown(!profileDropdown)}
              className="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-secondary-100 transition-colors"
            >
              <div className="w-10 h-10 rounded-full bg-primary-500 flex items-center justify-center text-white font-medium">
                {user?.profile_image ? (
                  <img
                    src={`${import.meta.env.VITE_IMAGE_BASE_URL}${user.profile_image}`}
                    alt={user.name}
                    className="w-full h-full rounded-full object-cover"
                  />) : (
                  user?.name.charAt(0).toUpperCase()
                )}
              </div>
              <div className="hidden md:block text-left">
                <p className="text-sm font-medium text-secondary-900">{user?.name}</p>
                <p className="text-xs text-secondary-500 capitalize">{user?.role}</p>
              </div>
              <ChevronDown size={16} className="text-secondary-400" />
            </button>

            {/* Dropdown Menu */}
            {profileDropdown && (
              <>
                <div
                  className="fixed inset-0 z-40"
                  onClick={() => setProfileDropdown(false)}
                />
                <div className="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-secondary-200 py-2 z-50">
                  <div className="px-4 py-3 border-b border-secondary-200">
                    <p className="text-sm font-medium text-secondary-900">{user?.name}</p>
                    <p className="text-xs text-secondary-500">{user?.email}</p>
                  </div>
                  
                  {/* ✅ Profile button with navigation */}
                  <button 
                    onClick={handleProfileClick}
                    className="w-full px-4 py-2 text-left text-sm text-secondary-700 hover:bg-secondary-50 flex items-center gap-2 transition-colors"
                  >
                    <User size={16} />
                    Profile Settings
                  </button>
                  
                  <button className="w-full px-4 py-2 text-left text-sm text-secondary-700 hover:bg-secondary-50 flex items-center gap-2 transition-colors">
                    <Settings size={16} />
                    Settings
                  </button>
                  
                  <hr className="my-2 border-secondary-200" />
                  
                  <button
                    onClick={handleLogout}
                    className="w-full px-4 py-2 text-left text-sm text-error-600 hover:bg-error-50 flex items-center gap-2 transition-colors"
                  >
                    <LogOut size={16} />
                    Logout
                  </button>
                </div>
              </>
            )}
          </div>
        </div>
      </header>

      {/* Sidebar */}
      <aside
        className={`
          fixed top-16 left-0 bottom-0 w-64 bg-white border-r border-secondary-200 z-30 transition-transform duration-300
          ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}
          lg:translate-x-0
        `}
      >
        <nav className="p-4 space-y-2">
          {menuItems.map((item) => (
            <Link
              key={item.path}
              to={item.path}
              onClick={() => setSidebarOpen(false)}
              className={`
                flex items-center gap-3 px-4 py-3 rounded-lg transition-all
                ${
                  isActive(item.path)
                    ? 'bg-primary-50 text-primary-600 font-medium'
                    : 'text-secondary-700 hover:bg-secondary-50'
                }
              `}
            >
              {item.icon}
              {item.label}
            </Link>
          ))}
        </nav>
      </aside>

      {/* Main Content */}
      <main className="pt-16 lg:pl-64">
        <div className="p-6">
          {children}
        </div>
      </main>

      {/* Mobile Overlay */}
      {sidebarOpen && (
        <div
          className="fixed inset-0 bg-black/50 z-20 lg:hidden"
          onClick={() => setSidebarOpen(false)}
        />
      )}
    </div>
  );
};

export default DashboardLayout;
/* FILE: src/components/profile/ChangePasswordSection.tsx */
// src/components/profile/ChangePasswordSection.tsx
import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useMutation } from '@tanstack/react-query';
import { ChevronDown, Lock, Shield } from 'lucide-react';
import toast from 'react-hot-toast';

import { profileAPI } from '../../api/handlers/profile.api';
import { useAuthStore } from '../../store/authStore';
import { changePasswordSchema, ChangePasswordFormData } from '../../utils/validators';
import Input from '../common/Input';
import Button from '../common/Buttons';

const ChangePasswordSection = () => {
  const [isExpanded, setIsExpanded] = useState(false);
  const { setToken } = useAuthStore();

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm<ChangePasswordFormData>({
    resolver: zodResolver(changePasswordSchema),
  });

  const changePasswordMutation = useMutation({
    mutationFn: profileAPI.changePassword,
    onSuccess: (data) => {
      // Update token if backend returns a new one
      if (data.token) {
        setToken(data.token);
      }
      
      toast.success('🔒 Password changed successfully!');
      reset(); // Clear form
      setIsExpanded(false); // Collapse section
    },
    onError: (error: Error) => {
      toast.error(error.message || 'Failed to change password');
    },
  });

  const onSubmit = (data: ChangePasswordFormData) => {
    changePasswordMutation.mutate(data);
  };

  return (
    <div className="border-t border-secondary-200 pt-8 mt-8">
      {/* Header - Always Visible */}
      <button
        type="button"
        onClick={() => setIsExpanded(!isExpanded)}
        className="flex items-center justify-between w-full text-left group"
      >
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 rounded-lg bg-error-100 flex items-center justify-center group-hover:bg-error-200 transition-colors">
            <Shield size={20} className="text-error-600" />
          </div>
          <div>
            <h3 className="text-lg font-semibold text-secondary-900">
              Security Settings
            </h3>
            <p className="text-sm text-secondary-500">
              Update your password to keep your account secure
            </p>
          </div>
        </div>
        <ChevronDown
          size={24}
          className={`text-secondary-400 transition-transform duration-200 ${
            isExpanded ? 'rotate-180' : ''
          }`}
        />
      </button>

      {/* Expandable Content */}
      {isExpanded && (
        <div className="mt-6 bg-secondary-50 rounded-xl p-6 border border-secondary-200">
          <form onSubmit={handleSubmit(onSubmit)} className="space-y-5">
            <div className="flex items-center gap-2 mb-4 text-sm text-secondary-600">
              <Lock size={16} />
              <span>Your password must be at least 6 characters long</span>
            </div>

            <Input
              label="Current Password"
              type="password"
              placeholder="Enter your current password"
              icon={Lock}
              register={register('current_password')}
              error={errors.current_password?.message}
              required
            />

            <Input
              label="New Password"
              type="password"
              placeholder="Enter new password (min. 6 characters)"
              icon={Lock}
              register={register('new_password')}
              error={errors.new_password?.message}
              required
            />

            <Input
              label="Confirm New Password"
              type="password"
              placeholder="Re-enter new password"
              icon={Lock}
              register={register('new_password_confirmation')}
              error={errors.new_password_confirmation?.message}
              required
            />

            <div className="flex gap-3 pt-4">
              <Button
                type="submit"
                isLoading={changePasswordMutation.isPending}
                disabled={changePasswordMutation.isPending}
                fullWidth={false}
                className="flex-1"
              >
                <Lock size={18} />
                {changePasswordMutation.isPending
                  ? 'Changing Password...'
                  : 'Change Password'}
              </Button>

              <Button
                type="button"
                variant="outline"
                onClick={() => {
                  reset();
                  setIsExpanded(false);
                }}
                fullWidth={false}
                className="flex-1"
              >
                Cancel
              </Button>
            </div>
          </form>
        </div>
      )}
    </div>
  );
};

export default ChangePasswordSection;
/* FILE: src/components/supplier/AddOfferModal.tsx */
// FILE PATH: src/components/supplier/AddOfferModal.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { X, DollarSign, Package } from 'lucide-react';
import toast from 'react-hot-toast';

import { MasterProduct, supplierProductsAPI } from '../../api/handlers/supplierProducts.api';
import { addOfferSchema, AddOfferFormData } from '../../utils/validators';
import Input2 from '../common/Input2'; // ✅ Using Input2 instead of Input
import Button from '../common/Buttons';

interface AddOfferModalProps {
  isOpen: boolean;
  onClose: () => void;
  product: MasterProduct | null;
}

const AddOfferModal = ({ isOpen, onClose, product }: AddOfferModalProps) => {
  const queryClient = useQueryClient();

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm<AddOfferFormData>({
    resolver: zodResolver(addOfferSchema),
    defaultValues: {
      availability_status: 'In Stock',
    },
  });

  const addOfferMutation = useMutation({
    mutationFn: supplierProductsAPI.addSupplierOffer,
    onSuccess: () => {
      toast.success('Product added to your offers successfully!');
      queryClient.invalidateQueries({ queryKey: ['supplier-products'] });
      handleClose();
    },
    onError: (error: any) => {
      const message = error.response?.data?.message || 'Failed to add product to offers';
      toast.error(message);
    },
  });

  const onSubmit = (data: AddOfferFormData) => {
    if (!product) return;

    addOfferMutation.mutate({
      master_product_id: product.id,
      price: parseFloat(data.price),
      availability_status: data.availability_status,
    });
  };

  const handleClose = () => {
    reset();
    onClose();
  };

  if (!isOpen || !product) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b border-secondary-100">
          <h2 className="text-2xl font-bold text-secondary-900">Add to Your Offers</h2>
          <button
            onClick={handleClose}
            className="text-secondary-400 hover:text-secondary-600 transition-colors"
          >
            <X size={24} />
          </button>
        </div>

        {/* Product Info */}
        <div className="p-6 bg-secondary-50 border-b border-secondary-100">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center">
              <Package size={24} className="text-primary-600" />
            </div>
            <div>
              <h3 className="font-semibold text-secondary-900">{product.product_name}</h3>
              <p className="text-sm text-secondary-600">
                {product.category.name} • {product.unit_of_measure}
              </p>
            </div>
          </div>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit(onSubmit)} className="p-6 space-y-6">
          {/* Price Input - Using Input2 with icon as component */}
          <Input2
            label={`Price per ${product.unit_of_measure}`}
            type="text"
            placeholder="0.00"
            icon={DollarSign} // ✅ Pass component reference
            error={errors.price?.message}
            {...register('price')}
            required
          />

          {/* Availability Status */}
          <div>
            <label className="block text-sm font-medium text-secondary-700 mb-2">
              Availability Status <span className="text-error-500">*</span>
            </label>
            <select
              {...register('availability_status')}
              className={`
                w-full px-4 py-3 rounded-lg border-2 transition-all
                ${errors.availability_status 
                  ? 'border-error-500 focus:border-error-500 focus:ring-error-500' 
                  : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
                }
                focus:outline-none focus:ring-2 focus:ring-opacity-20
              `}
            >
              <option value="In Stock">In Stock</option>
              <option value="Out of Stock">Out of Stock</option>
              <option value="Limited Stock">Limited Stock</option>
            </select>
            {errors.availability_status && (
              <p className="text-sm text-error-500 mt-1">{errors.availability_status.message}</p>
            )}
          </div>

          {/* Action Buttons */}
          <div className="flex gap-3 pt-4">
            <Button
              type="submit"
              isLoading={addOfferMutation.isPending}
              disabled={addOfferMutation.isPending}
              fullWidth={false}
              className="flex-1"
            >
              {addOfferMutation.isPending ? 'Adding...' : 'Add to Offers'}
            </Button>

            <Button
              type="button"
              variant="outline"
              onClick={handleClose}
              fullWidth={false}
              className="flex-1"
            >
              Cancel
            </Button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default AddOfferModal;
/* FILE: src/components/supplier/DeliveryZonesManagement.tsx */
// src/components/supplier/DeliveryZonesManagement.tsx - COMPLETE WITH JSX
import React, { useState, useEffect, useCallback } from 'react';
import { 
  MapPin, 
  Plus, 
  Edit2, 
  Trash2, 
  Map as MapIcon,
  Grid3X3,
  Loader2,
  AlertCircle,
  Save,
  X,
  Radius,
  Navigation
} from 'lucide-react';
import Autocomplete from 'react-google-autocomplete';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import toast from 'react-hot-toast';

import DeliveryZonesMapView from './DeliveryZonesMapView';
import { zonesAPI } from '../../api/handlers/zones.api';

// ==================== TYPES ====================
interface DeliveryZone {
  address: string;
  lat: number;
  long: number;
  radius: number;
  id?: string;
}

interface ZoneFormData {
  address: string;
  lat: number | null;
  long: number | null;
  radius: number;
}

// ==================== UTILITY FUNCTIONS ====================
const calculateCoverageArea = (radius: number): string => {
  const area = Math.PI * radius * radius;
  return area.toFixed(0);
};

const generateId = () => Math.random().toString(36).substr(2, 9);

// ==================== ZONE CARD COMPONENT ====================
const ZoneCard: React.FC<{
  zone: DeliveryZone;
  onEdit: (zone: DeliveryZone) => void;
  onDelete: (zone: DeliveryZone) => void;
}> = ({ zone, onEdit, onDelete }) => {
  const coverageArea = calculateCoverageArea(zone.radius);
  
  return (
    <div className="bg-white rounded-xl border-2 border-secondary-200 p-6 hover:border-primary-300 hover:shadow-lg transition-all">
      <div className="w-full h-32 bg-secondary-100 rounded-lg mb-4 flex items-center justify-center relative overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-br from-primary-100 to-primary-200 opacity-50"></div>
        <MapPin size={40} className="text-primary-600 relative z-10" />
      </div>
      
      <div className="space-y-3 mb-4">
        <div>
          <p className="text-xs text-secondary-500 mb-1">Address</p>
          <p className="font-semibold text-secondary-900 line-clamp-2">{zone.address}</p>
        </div>
        
        <div className="grid grid-cols-2 gap-3">
          <div>
            <p className="text-xs text-secondary-500 mb-1">Coordinates</p>
            <p className="text-sm font-medium text-secondary-700">
              {zone.lat.toFixed(4)}, {zone.long.toFixed(4)}
            </p>
          </div>
          <div>
            <p className="text-xs text-secondary-500 mb-1">Coverage</p>
            <p className="text-sm font-medium text-primary-600">~{coverageArea} km²</p>
          </div>
        </div>
        
        <div className="inline-flex items-center gap-2 px-3 py-2 bg-primary-50 border border-primary-200 rounded-lg">
          <Radius size={16} className="text-primary-600" />
          <span className="text-sm font-semibold text-primary-700">{zone.radius} km radius</span>
        </div>
      </div>
      
      <div className="flex gap-2 pt-4 border-t border-secondary-200">
        <button
          onClick={() => onEdit(zone)}
          className="flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-secondary-100 hover:bg-secondary-200 text-secondary-700 rounded-lg transition-colors font-medium"
        >
          <Edit2 size={16} />
          Edit
        </button>
        <button
          onClick={() => onDelete(zone)}
          className="flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-error-50 hover:bg-error-100 text-error-600 rounded-lg transition-colors font-medium"
        >
          <Trash2 size={16} />
          Delete
        </button>
      </div>
    </div>
  );
};

// ==================== ZONE MODAL COMPONENT ====================
const ZoneModal: React.FC<{
  isOpen: boolean;
  onClose: () => void;
  onSave: (zone: Omit<DeliveryZone, 'id'>) => void;
  editingZone?: DeliveryZone | null;
}> = ({ isOpen, onClose, onSave, editingZone }) => {
  const [formData, setFormData] = useState<ZoneFormData>({
    address: '',
    lat: null,
    long: null,
    radius: 20
  });
  const [errors, setErrors] = useState<Record<string, string>>({});
  // ✅ NEW: Track if address input should be controlled
  const [addressValue, setAddressValue] = useState('');

  // ✅ FIXED: Reset form when modal opens or editingZone changes
  useEffect(() => {
    if (isOpen) {
      if (editingZone) {
        setFormData({
          address: editingZone.address,
          lat: editingZone.lat,
          long: editingZone.long,
          radius: editingZone.radius
        });
        setAddressValue(editingZone.address);
      } else {
        setFormData({
          address: '',
          lat: null,
          long: null,
          radius: 20
        });
        setAddressValue('');
      }
      setErrors({});
    }
  }, [editingZone, isOpen]);

  const handlePlaceSelected = useCallback((place: any) => {
    console.log('🗺️ Place Selected:', place);
    
    if (place.formatted_address) {
      setFormData(prev => ({ ...prev, address: place.formatted_address }));
      setAddressValue(place.formatted_address); // ✅ Update controlled value
    }
    
    if (place.geometry?.location) {
      const lat = place.geometry.location.lat();
      const lng = place.geometry.location.lng();
      
      console.log('📍 Coordinates:', { lat, lng });
      
      setFormData(prev => ({
        ...prev,
        lat,
        long: lng
      }));
      
      setErrors(prev => {
        const newErrors = { ...prev };
        delete newErrors.location;
        delete newErrors.address;
        return newErrors;
      });
    }
  }, []);

  // ✅ NEW: Handle manual address input changes
  const handleAddressChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const value = e.target.value;
    setAddressValue(value);
    setFormData(prev => ({ ...prev, address: value }));
  };

  const validate = () => {
    const newErrors: Record<string, string> = {};
    
    if (!formData.address) {
      newErrors.address = 'Address is required';
    }
    if (!formData.lat || !formData.long) {
      newErrors.location = 'Please select a valid address from Google suggestions';
    }
    if (formData.radius < 5) {
      newErrors.radius = 'Minimum radius is 5 km';
    }
    if (formData.radius > 200) {
      newErrors.radius = 'Maximum radius is 200 km';
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = () => {
    if (!validate()) return;
    
    console.log('💾 Submitting zone data:', formData); // ✅ Debug log
    
    onSave({
      address: formData.address,
      lat: formData.lat!,
      long: formData.long!,
      radius: formData.radius
    });
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
      <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-white border-b border-secondary-200 px-6 py-4 flex items-center justify-between">
          <div>
            <h2 className="text-2xl font-bold text-secondary-900">
              {editingZone ? 'Edit Delivery Zone' : 'Add Delivery Zone'}
            </h2>
            <p className="text-sm text-secondary-600 mt-1">
              Define your service area with address and radius
            </p>
          </div>
          <button
            onClick={onClose}
            className="p-2 hover:bg-secondary-100 rounded-lg transition-colors"
          >
            <X size={24} className="text-secondary-600" />
          </button>
        </div>

        <div className="p-6 space-y-6">
          <div>
            <label className="block text-sm font-medium text-secondary-700 mb-2">
              Business Address <span className="text-error-500">*</span>
            </label>
            <div className="relative">
              <MapPin className="absolute left-3 top-3.5 text-secondary-400 z-10" size={20} />
              {/* ✅ FIXED: Added key prop to force re-render + value prop for controlled input */}
              <Autocomplete
                key={editingZone?.address || 'new'} // Force re-mount when switching zones
                apiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}
                onPlaceSelected={handlePlaceSelected}
                options={{ 
                  types: ['address'],
                  componentRestrictions: { country: 'au' }
                }}
                defaultValue={addressValue} // Use state value
                onChange={handleAddressChange} // ✅ Handle manual typing
                className={`w-full pl-10 pr-4 py-3 rounded-lg border-2 transition-all ${
                  errors.address || errors.location
                    ? 'border-error-500 focus:border-error-500 focus:ring-error-500'
                    : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
                } focus:outline-none focus:ring-2 focus:ring-opacity-20`}
                placeholder="Start typing your business address..."
              />
            </div>
            {(errors.address || errors.location) && (
              <p className="text-sm text-error-500 mt-1 flex items-center gap-1">
                <AlertCircle size={14} />
                {errors.address || errors.location}
              </p>
            )}
            <p className="text-xs text-secondary-500 mt-2">
              💡 Type your address and select from Google suggestions
            </p>
          </div>

          {formData.lat && formData.long && (
            <div className="bg-success-50 border border-success-200 rounded-lg p-4">
              <p className="text-sm font-medium text-success-900 mb-2 flex items-center gap-2">
                <MapPin size={16} />
                Location Confirmed ✓
              </p>
              <p className="text-xs text-success-700">
                Coordinates: {formData.lat.toFixed(6)}, {formData.long.toFixed(6)}
              </p>
              <p className="text-xs text-success-600 mt-1 line-clamp-2">
                Address: {formData.address}
              </p>
            </div>
          )}

          <div>
            <div className="flex items-center justify-between mb-2">
              <label className="text-sm font-medium text-secondary-700">
                Delivery Radius <span className="text-error-500">*</span>
              </label>
              <span className="text-lg font-bold text-primary-600">
                {formData.radius} km
              </span>
            </div>
            <input
              type="range"
              min="5"
              max="200"
              step="5"
              value={formData.radius}
              onChange={(e) => {
                const newRadius = Number(e.target.value);
                console.log('🎚️ Radius changed to:', newRadius); // ✅ Debug log
                setFormData(prev => ({ ...prev, radius: newRadius }));
              }}
              className="w-full h-2 bg-secondary-200 rounded-lg appearance-none cursor-pointer accent-primary-500"
            />
            <div className="flex justify-between text-xs text-secondary-500 mt-1">
              <span>5 km</span>
              <span>200 km</span>
            </div>
            {errors.radius && (
              <p className="text-sm text-error-500 mt-1 flex items-center gap-1">
                <AlertCircle size={14} />
                {errors.radius}
              </p>
            )}
          </div>

          {formData.lat && formData.long && (
            <div className="bg-primary-50 border border-primary-200 rounded-lg p-4">
              <p className="text-sm font-medium text-primary-900 mb-2">
                📊 Coverage Information
              </p>
              <div className="grid grid-cols-2 gap-3 text-xs">
                <div>
                  <p className="text-primary-600">Coverage Area</p>
                  <p className="font-bold text-primary-900">
                    ~{calculateCoverageArea(formData.radius)} km²
                  </p>
                </div>
                <div>
                  <p className="text-primary-600">Radius</p>
                  <p className="font-bold text-primary-900">{formData.radius} km</p>
                </div>
              </div>
            </div>
          )}
        </div>

        <div className="sticky bottom-0 bg-white border-t border-secondary-200 px-6 py-4 flex gap-3">
          <button
            onClick={onClose}
            className="flex-1 px-6 py-3 border-2 border-secondary-300 text-secondary-700 rounded-lg hover:bg-secondary-50 transition-colors font-medium"
          >
            Cancel
          </button>
          <button
            onClick={handleSubmit}
            className="flex-1 px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors font-medium flex items-center justify-center gap-2"
          >
            <Save size={18} />
            {editingZone ? 'Update Zone' : 'Add Zone'}
          </button>
        </div>
      </div>
    </div>
  );
};

// ==================== MAIN COMPONENT ====================
const DeliveryZonesManagement: React.FC = () => {
  const queryClient = useQueryClient();
  const [activeView, setActiveView] = useState<'card' | 'map'>('card');
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [editingZone, setEditingZone] = useState<DeliveryZone | null>(null);
  const [deleteConfirm, setDeleteConfirm] = useState<DeliveryZone | null>(null);

  // ✅ DEBUG: Check API key
  useEffect(() => {
    const apiKey = import.meta.env.VITE_GOOGLE_MAPS_API_KEY;
    console.log('🔑 Google Maps API Key:', apiKey ? `Loaded (${apiKey.substring(0, 10)}...)` : 'Missing ❌');
  }, []);

  // ✅ Fetch zones using React Query
  const { data, isLoading, error } = useQuery({
    queryKey: ['delivery-zones'],
    queryFn: zonesAPI.getZones,
  });

  const zones: DeliveryZone[] = data?.delivery_zones.map(zone => ({
    ...zone,
    id: generateId()
  })) || [];

  // ✅ Save zones mutation
  const saveZonesMutation = useMutation({
    mutationFn: zonesAPI.saveZones,
    onSuccess: (response) => {
      queryClient.invalidateQueries({ queryKey: ['delivery-zones'] });
      toast.success('✅ ' + response.message);
    },
    onError: (error: any) => {
      toast.error('❌ ' + (error?.message || 'Failed to save zones'));
    },
  });

  const handleAddZone = (newZone: Omit<DeliveryZone, 'id'>) => {
    const allZones = [...zones.map(({ id, ...z }) => z), newZone];
    saveZonesMutation.mutate(allZones, {
      onSuccess: () => {
        setIsModalOpen(false);
        setEditingZone(null);
      }
    });
  };

  const handleEditZone = (updatedZone: Omit<DeliveryZone, 'id'>) => {
    if (!editingZone) return;
    
    // Map through zones and replace the one being edited
    const allZones = zones.map(zone => {
        if (zone.lat === editingZone.lat && zone.long === editingZone.long) {
        // Return the updated zone data (without frontend id)
        return {
            address: updatedZone.address,
            lat: updatedZone.lat,
            long: updatedZone.long,
            radius: updatedZone.radius,
        };
        }
        // Return other zones without their frontend id
        return {
        address: zone.address,
        lat: zone.lat,
        long: zone.long,
        radius: zone.radius,
        };
    });
  
    console.log('🔄 Updating zones:', allZones); // Debug log
    
    saveZonesMutation.mutate(allZones, {
        onSuccess: () => {
        setIsModalOpen(false);
        setEditingZone(null);
        }
    });
};

// ✅ FIXED: Delete Zone Handler
const handleDeleteZone = (zoneToDelete: DeliveryZone) => {
    // Filter out the deleted zone and clean the data
    console.log('🗑️ Deleting zone:', zoneToDelete); // Debug log
    const remainingZones = zones
        .filter(zone => (zone.lat !== zoneToDelete.lat && zone.long !== zoneToDelete.long))
        .map(zone => ({
        address: zone.address,
        lat: zone.lat,
        long: zone.long,
        radius: zone.radius,
        }));
    
    console.log('🗑️ Deleting zone, remaining:', remainingZones); // Debug log
    
    saveZonesMutation.mutate(remainingZones, {
        onSuccess: () => {
        setDeleteConfirm(null);
        }
    });
    };

  const openEditModal = (zone: DeliveryZone) => {
    setEditingZone(zone);
    setIsModalOpen(true);
  };

  const openAddModal = () => {
    setEditingZone(null);
    setIsModalOpen(true);
  };

  const isSaving = saveZonesMutation.isPending;

  return (
    <div className="min-h-screen bg-secondary-50 p-6">
      <div className="max-w-7xl mx-auto space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-secondary-900 flex items-center gap-3">
              <MapPin size={32} className="text-primary-600" />
              Delivery Zones
            </h1>
            <p className="text-secondary-600 mt-2">
              Manage your service areas and delivery coverage
            </p>
          </div>
          <button
            onClick={openAddModal}
            disabled={isSaving}
            className="flex items-center gap-2 px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 disabled:opacity-50 transition-all shadow-lg hover:shadow-xl font-medium"
          >
            <Plus size={20} />
            Add Delivery Zone
          </button>
        </div>

        {/* Stats Card */}
        <div className="bg-white rounded-xl border-2 border-secondary-200 p-6">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-lg bg-primary-100 flex items-center justify-center">
                <MapPin size={24} className="text-primary-600" />
              </div>
              <div>
                <p className="text-sm text-secondary-600">Total Zones</p>
                <p className="text-2xl font-bold text-secondary-900">{zones.length}</p>
              </div>
            </div>
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-lg bg-success-100 flex items-center justify-center">
                <Radius size={24} className="text-success-600" />
              </div>
              <div>
                <p className="text-sm text-secondary-600">Total Coverage</p>
                <p className="text-2xl font-bold text-secondary-900">
                  {zones.reduce((sum, z) => sum + parseFloat(calculateCoverageArea(z.radius)), 0).toFixed(0)} km²
                </p>
              </div>
            </div>
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-lg bg-warning-100 flex items-center justify-center">
                <Navigation size={24} className="text-warning-600" />
              </div>
              <div>
                <p className="text-sm text-secondary-600">Avg. Radius</p>
                <p className="text-2xl font-bold text-secondary-900">
                  {zones.length > 0 ? (zones.reduce((sum, z) => sum + z.radius, 0) / zones.length).toFixed(0) : 0} km
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* View Toggle */}
        <div className="bg-white rounded-xl border-2 border-secondary-200 p-2 inline-flex gap-2">
          <button
            onClick={() => setActiveView('card')}
            className={`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium transition-all ${
              activeView === 'card'
                ? 'bg-primary-500 text-white shadow-lg'
                : 'text-secondary-600 hover:bg-secondary-50'
            }`}
          >
            <Grid3X3 size={20} />
            Card View
          </button>
          <button
            onClick={() => setActiveView('map')}
            className={`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium transition-all ${
              activeView === 'map'
                ? 'bg-primary-500 text-white shadow-lg'
                : 'text-secondary-600 hover:bg-secondary-50'
            }`}
          >
            <MapIcon size={20} />
            Map View
          </button>
        </div>

        {/* Loading State */}
        {isLoading && (
          <div className="flex flex-col items-center justify-center py-20">
            <Loader2 size={48} className="text-primary-600 animate-spin mb-4" />
            <p className="text-secondary-600">Loading delivery zones...</p>
          </div>
        )}

        {/* Error State */}
        {error && (
          <div className="bg-error-50 border border-error-200 rounded-xl p-6 text-center">
            <AlertCircle size={48} className="text-error-500 mx-auto mb-4" />
            <p className="text-error-700 font-medium">Failed to load zones</p>
            <p className="text-error-600 text-sm mt-2">{(error as Error).message}</p>
          </div>
        )}

        {/* Empty State */}
        {!isLoading && !error && zones.length === 0 && (
          <div className="bg-white rounded-xl border-2 border-dashed border-secondary-300 p-12 text-center">
            <div className="w-24 h-24 rounded-full bg-primary-50 flex items-center justify-center mx-auto mb-6">
              <MapPin size={48} className="text-primary-400" />
            </div>
            <h3 className="text-xl font-bold text-secondary-900 mb-2">
              No Delivery Zones Yet
            </h3>
            <p className="text-secondary-600 mb-6 max-w-md mx-auto">
              Start by adding your first delivery zone to define where you can service customers.
            </p>
            <button
              onClick={openAddModal}
              className="inline-flex items-center gap-2 px-8 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-all shadow-lg hover:shadow-xl font-medium"
            >
              <Plus size={20} />
              Add Your First Zone
            </button>
          </div>
        )}

        {/* Card View */}
        {!isLoading && !error && activeView === 'card' && zones.length > 0 && (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {zones.map((zone) => (
              <ZoneCard
                key={zone.id}
                zone={zone}
                onEdit={openEditModal}
                onDelete={(zone) => setDeleteConfirm(zone)}
              />
            ))}
          </div>
        )}

        {/* Map View */}
        {!isLoading && !error && activeView === 'map' && zones.length > 0 && (
          <DeliveryZonesMapView zones={zones} />
        )}

        {/* Add/Edit Modal */}
        <ZoneModal
          isOpen={isModalOpen}
          onClose={() => {
            setIsModalOpen(false);
            setEditingZone(null);
          }}
          onSave={editingZone ? handleEditZone : handleAddZone}
          editingZone={editingZone}
        />

        {/* Delete Confirmation Modal */}
        {deleteConfirm && (
          <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
            <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
              <div className="w-16 h-16 rounded-full bg-error-100 flex items-center justify-center mx-auto mb-4">
                <AlertCircle size={32} className="text-error-600" />
              </div>
              <h3 className="text-xl font-bold text-secondary-900 text-center mb-2">
                Delete Delivery Zone?
              </h3>
              <p className="text-secondary-600 text-center mb-6">
                Are you sure you want to remove this zone? This action cannot be undone.
              </p>
              <div className="bg-secondary-50 rounded-lg p-3 mb-6">
                <p className="text-sm text-secondary-700">
                  <span className="font-semibold">Zone:</span> {deleteConfirm.address}
                </p>
                <p className="text-sm text-secondary-700 mt-1">
                  <span className="font-semibold">Radius:</span> {deleteConfirm.radius} km
                </p>
              </div>
              <div className="flex gap-3">
                <button
                  onClick={() => setDeleteConfirm(null)}
                  className="flex-1 px-4 py-3 border-2 border-secondary-300 text-secondary-700 rounded-lg hover:bg-secondary-50 transition-colors font-medium"
                >
                  Cancel
                </button>
                <button
                  onClick={() => handleDeleteZone(deleteConfirm)}
                  disabled={isSaving}
                  className="flex-1 px-4 py-3 bg-error-500 text-white rounded-lg hover:bg-error-600 disabled:opacity-50 transition-colors font-medium flex items-center justify-center gap-2"
                >
                  {isSaving ? (
                    <>
                      <Loader2 size={18} className="animate-spin" />
                      Deleting...
                    </>
                  ) : (
                    <>
                      <Trash2 size={18} />
                      Delete Zone
                    </>
                  )}
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Saving Overlay */}
        {isSaving && (
          <div className="fixed inset-0 bg-black/30 z-40 flex items-center justify-center">
            <div className="bg-white rounded-xl shadow-2xl p-6 flex items-center gap-4">
              <Loader2 size={32} className="text-primary-600 animate-spin" />
              <span className="text-lg font-medium text-secondary-900">
                Saving changes...
              </span>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default DeliveryZonesManagement;
/* FILE: src/components/supplier/DeliveryZonesMapView.tsx */
// DeliveryZonesMapView.tsx
import React, { useEffect, useRef, useState } from 'react';
import { Loader2, AlertCircle, MapPin } from 'lucide-react';

interface DeliveryZone {
  address: string;
  lat: number;
  long: number;
  radius: number; // in km
  id?: string;
}

interface MapViewProps {
  zones: DeliveryZone[];
}

declare global {
  interface Window {
    google: any;
  }
}

const DeliveryZonesMapView: React.FC<MapViewProps> = ({ zones }) => {
  const mapRef = useRef<HTMLDivElement>(null);
  const [map, setMap] = useState<google.maps.Map | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const markersRef = useRef<google.maps.Marker[]>([]);
  const circlesRef = useRef<google.maps.Circle[]>([]);

  const zoneColors = [
    '#EF4444', '#3B82F6', '#10B981', '#F59E0B',
    '#8B5CF6', '#EC4899', '#14B8A6', '#F97316',
  ];

  // --- Load script once and init when container exists
  useEffect(() => {
    const initWhenReady = () => {
      if (!mapRef.current) {
        requestAnimationFrame(initWhenReady);
        return;
      }
      if (!window.google || !window.google.maps) return;

      try {
        const defaultCenter = { lat: -33.8688, lng: 151.2093 }; // Sydney
        const center = zones.length
          ? { lat: zones[0].lat, lng: zones[0].long }
          : defaultCenter;

        const mapInstance = new window.google.maps.Map(mapRef.current, {
          center,
          zoom: zones.length ? 10 : 5,
          mapTypeControl: true,
          streetViewControl: false,
          fullscreenControl: true,
        });

        setMap(mapInstance);
        setLoading(false);
      } catch (e) {
        setError('Failed to initialize map');
        setLoading(false);
      }
    };

    // already loaded
    if (window.google && window.google.maps) {
      initWhenReady();
      return;
    }

    // avoid duplicate script
    const existing = document.getElementById('google-maps-script') as HTMLScriptElement | null;
    if (existing) {
      existing.addEventListener('load', initWhenReady, { once: true });
      return;
    }

    const apiKey = import.meta.env.VITE_GOOGLE_MAPS_API_KEY;
    if (!apiKey) {
      setError('Missing VITE_GOOGLE_MAPS_API_KEY');
      setLoading(false);
      return;
    }

    const s = document.createElement('script');
    s.id = 'google-maps-script';
    s.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places`;
    s.async = true;
    s.defer = true;
    s.onload = initWhenReady;
    s.onerror = () => {
      setError('Failed to load Google Maps. Check API key or network.');
      setLoading(false);
    };
    document.head.appendChild(s);

    return () => {
      // cleanup markers/circles on unmount
      markersRef.current.forEach(m => m.setMap(null));
      circlesRef.current.forEach(c => c.setMap(null));
    };
  }, []); // eslint-disable-line

  // --- Draw zones whenever data or map changes
  useEffect(() => {
    if (!map || !window.google) return;

    // clear old
    markersRef.current.forEach(m => m.setMap(null));
    circlesRef.current.forEach(c => c.setMap(null));
    markersRef.current = [];
    circlesRef.current = [];

    if (!zones.length) return;

    const bounds = new window.google.maps.LatLngBounds();

    zones.forEach((zone, idx) => {
      const pos = { lat: zone.lat, lng: zone.long };
      const color = zoneColors[idx % zoneColors.length];

      const marker = new window.google.maps.Marker({
        position: pos,
        map,
        title: zone.address,
        label: { text: String(idx + 1), color: 'white', fontWeight: 'bold' },
        icon: {
          path: window.google.maps.SymbolPath.CIRCLE,
          scale: 12,
          fillColor: color,
          fillOpacity: 1,
          strokeColor: 'white',
          strokeWeight: 3,
        },
      });

      const info = new window.google.maps.InfoWindow({
        content: `
          <div style="padding:8px;max-width:260px">
            <h3 style="margin:0 0 6px;font-weight:700;color:#111827">Zone ${idx + 1}</h3>
            <div style="font-size:13px;color:#374151">
              <div><strong>Address:</strong> ${zone.address}</div>
              <div><strong>Radius:</strong> ${zone.radius} km</div>
              <div><strong>Coverage:</strong> ~${(Math.PI * zone.radius * zone.radius).toFixed(0)} km²</div>
            </div>
          </div>
        `,
      });
      marker.addListener('click', () => info.open(map, marker));

      const circle = new window.google.maps.Circle({
        strokeColor: color,
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: color,
        fillOpacity: 0.15,
        map,
        center: pos,
        radius: zone.radius * 1000, // km -> m
      });

      markersRef.current.push(marker);
      circlesRef.current.push(circle);
      bounds.extend(pos);
    });

    if (zones.length > 1) map.fitBounds(bounds);
    else map.setCenter({ lat: zones[0].lat, lng: zones[0].long });
  }, [map, zones]);

  return (
    <div className="bg-white rounded-xl border-2 border-secondary-200 p-6">
      <div className="relative">
        {/* keep container in DOM always */}
        <div
          ref={mapRef}
          className="w-full h-[600px] rounded-lg overflow-hidden border border-secondary-200"
        />
        {loading && (
          <div className="absolute inset-0 flex items-center justify-center bg-white/70">
            <Loader2 className="animate-spin" size={40} />
          </div>
        )}
        {error && (
          <div className="absolute inset-0 flex flex-col items-center justify-center bg-white/90 p-6 text-center">
            <AlertCircle className="text-error-600 mb-2" size={28} />
            <p className="text-error-700 font-medium mb-1">Map Loading Error</p>
            <p className="text-sm text-secondary-600">{error}</p>
            <p className="text-xs text-secondary-500 mt-2">
              Ensure <code>VITE_GOOGLE_MAPS_API_KEY</code> is set.
            </p>
          </div>
        )}
      </div>

      {/* Optional legend */}
      {zones.length > 0 ? (
        <div className="mt-4 p-4 bg-secondary-50 rounded-lg">
          <p className="text-sm font-semibold text-secondary-900 mb-3">Delivery Zones</p>
          <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
            {zones.map((z, i) => (
              <div key={z.id || i} className="flex items-center gap-2">
                <div
                  className="w-4 h-4 rounded-full border-2 border-white shadow-sm"
                  style={{ backgroundColor: zoneColors[i % zoneColors.length] }}
                />
                <div className="flex-1 min-w-0">
                  <p className="text-xs font-medium text-secondary-900 truncate">Zone {i + 1}</p>
                  <p className="text-xs text-secondary-600">{z.radius} km radius</p>
                </div>
              </div>
            ))}
          </div>
        </div>
      ) : (
        <div className="h-32 flex flex-col items-center justify-center text-secondary-600">
          <MapPin className="mb-2 text-secondary-400" size={20} />
          No zones to display
        </div>
      )}
    </div>
  );
};

export default DeliveryZonesMapView;

/* FILE: src/components/supplier/EditOfferModal.tsx */
// FILE PATH: src/components/supplier/EditOfferModal.tsx
import { useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { X, DollarSign, Package } from 'lucide-react';
import toast from 'react-hot-toast';

import { MasterProduct, SupplierOffer, supplierProductsAPI } from '../../api/handlers/supplierProducts.api';
import { updateOfferSchema, UpdateOfferFormData } from '../../utils/validators';
import Input2 from '../common/Input2'; // ✅ Using Input2 instead of Input
import Button from '../common/Buttons';

interface EditOfferModalProps {
  isOpen: boolean;
  onClose: () => void;
  product: MasterProduct | null;
  offer: SupplierOffer | null;
}

const EditOfferModal = ({ isOpen, onClose, product, offer }: EditOfferModalProps) => {
  const queryClient = useQueryClient();

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
    setValue,
  } = useForm<UpdateOfferFormData>({
    resolver: zodResolver(updateOfferSchema),
  });

  // Pre-fill form when offer changes
  useEffect(() => {
    if (offer) {
      setValue('price', offer.price.toString()); // Convert number to string for input
      setValue('availability_status', offer.availability_status as any);
    }
  }, [offer, setValue]);

  const updateOfferMutation = useMutation({
    mutationFn: ({ offerId, payload }: { offerId: number; payload: any }) =>
      supplierProductsAPI.updateSupplierOffer(offerId, payload),
    onSuccess: () => {
      toast.success('Offer updated successfully!');
      queryClient.invalidateQueries({ queryKey: ['supplier-products'] });
      handleClose();
    },
    onError: (error: any) => {
      const message = error.response?.data?.message || 'Failed to update offer';
      toast.error(message);
    },
  });

  const onSubmit = (data: UpdateOfferFormData) => {
    if (!offer) return;

    updateOfferMutation.mutate({
      offerId: offer.id,
      payload: {
        price: parseFloat(data.price),
        availability_status: data.availability_status,
      },
    });
  };

  const handleClose = () => {
    reset();
    onClose();
  };

  if (!isOpen || !product || !offer) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto">
        {/* Header */}
        <div className="flex items-center justify-between p-6 border-b border-secondary-100">
          <h2 className="text-2xl font-bold text-secondary-900">Edit Your Offer</h2>
          <button
            onClick={handleClose}
            className="text-secondary-400 hover:text-secondary-600 transition-colors"
          >
            <X size={24} />
          </button>
        </div>

        {/* Product Info */}
        <div className="p-6 bg-secondary-50 border-b border-secondary-100">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center">
              <Package size={24} className="text-primary-600" />
            </div>
            <div>
              <h3 className="font-semibold text-secondary-900">{product.product_name}</h3>
              <p className="text-sm text-secondary-600">
                {product.category.name} • {product.unit_of_measure}
              </p>
            </div>
          </div>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit(onSubmit)} className="p-6 space-y-6">
          {/* Price Input - Using Input2 with icon as component */}
          <Input2
            label={`Price per ${product.unit_of_measure}`}
            type="text"
            placeholder="0.00"
            icon={DollarSign} // ✅ Pass component reference
            error={errors.price?.message}
            {...register('price')}
            required
          />

          {/* Availability Status */}
          <div>
            <label className="block text-sm font-medium text-secondary-700 mb-2">
              Availability Status <span className="text-error-500">*</span>
            </label>
            <select
              {...register('availability_status')}
              className={`
                w-full px-4 py-3 rounded-lg border-2 transition-all
                ${errors.availability_status 
                  ? 'border-error-500 focus:border-error-500 focus:ring-error-500' 
                  : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
                }
                focus:outline-none focus:ring-2 focus:ring-opacity-20
              `}
            >
              <option value="In Stock">In Stock</option>
              <option value="Out of Stock">Out of Stock</option>
              <option value="Limited Stock">Limited Stock</option>
            </select>
            {errors.availability_status && (
              <p className="text-sm text-error-500 mt-1">{errors.availability_status.message}</p>
            )}
          </div>

          {/* Action Buttons */}
          <div className="flex gap-3 pt-4">
            <Button
              type="submit"
              isLoading={updateOfferMutation.isPending}
              disabled={updateOfferMutation.isPending}
              fullWidth={false}
              className="flex-1"
            >
              {updateOfferMutation.isPending ? 'Updating...' : 'Update Offer'}
            </Button>

            <Button
              type="button"
              variant="outline"
              onClick={handleClose}
              fullWidth={false}
              className="flex-1"
            >
              Cancel
            </Button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default EditOfferModal;
/* FILE: src/components/supplier/ProductCard.tsx */
// FILE PATH: src/components/supplier/ProductCard.tsx
import { Package, Edit, Trash2, Plus, AlertCircle } from 'lucide-react';
import { MasterProduct, SupplierOffer } from '../../api/handlers/supplierProducts.api';
import Button from '../common/Buttons';
import StatusBadge from '../common/StatusBadge';

interface ProductCardProps {
  product: MasterProduct;
  onAddOffer: (product: MasterProduct) => void;
  onEditOffer: (product: MasterProduct, offer: SupplierOffer) => void;
  onRemoveOffer: (offerId: number, productName: string) => void;
}

const ProductCard = ({ product, onAddOffer, onEditOffer, onRemoveOffer }: ProductCardProps) => {
  const imageUrl = product.photo 
    ? `${import.meta.env.VITE_IMAGE_BASE_URL}storage/${product.photo}`
    : null;

  // Find if current supplier has an offer for this product
  const myOffer = product.suppliers.find(s => s.isMe === true);
  const hasOffer = !!myOffer;

  return (
    <div className="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden border border-secondary-100">
      <div className="flex gap-4 p-6">
        {/* Product Image */}
        <div className="flex-shrink-0">
          {imageUrl ? (
            <img 
              src={imageUrl} 
              alt={product.product_name}
              className="w-24 h-24 object-cover rounded-lg border border-secondary-200"
              onError={(e) => {
                e.currentTarget.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2UzZTNlMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ObyBJbWFnZTwvdGV4dD48L3N2Zz4=';
              }}
            />
          ) : (
            <div className="w-24 h-24 bg-secondary-100 rounded-lg flex items-center justify-center">
              <Package size={32} className="text-secondary-400" />
            </div>
          )}
        </div>

        {/* Product Info */}
        <div className="flex-1 min-w-0">
          <div className="flex items-start justify-between gap-4">
            <div className="flex-1">
              <h3 className="text-lg font-semibold text-secondary-900 mb-1">
                {product.product_name}
              </h3>
              <div className="flex items-center gap-3 text-sm text-secondary-600 mb-2">
                <span className="flex items-center gap-1">
                  <Package size={14} />
                  {product.category.name}
                </span>
                <span className="text-secondary-300">•</span>
                <span>{product.unit_of_measure}</span>
              </div>
              
              {product.specifications && (
                <p className="text-sm text-secondary-600 line-clamp-2 mb-3">
                  {product.specifications}
                </p>
              )}

              {/* Offer Status */}
              {hasOffer && myOffer ? (
                <div className="flex items-center gap-3 flex-wrap">
                  <div className="flex items-center gap-2">
                    <span className="text-sm font-medium text-secondary-700">Price:</span>
                    <span className="text-lg font-bold text-primary-600">
                      ${parseFloat(myOffer.price).toFixed(2)}
                    </span>
                    <span className="text-sm text-secondary-500">
                      per {product.unit_of_measure}
                    </span>
                  </div>
                  
                  <StatusBadge 
                    status={myOffer.availability_status === 'In Stock' ? 'active' : 'inactive'}
                    label={myOffer.availability_status}
                  />

                  {myOffer.status === 'Pending' && (
                    <div className="flex items-center gap-1 text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded">
                      <AlertCircle size={14} />
                      Pending Admin Approval
                    </div>
                  )}
                </div>
              ) : (
                <div className="flex items-center gap-2 text-secondary-500">
                  <Plus size={16} />
                  <span className="text-sm font-medium">Not in your offers</span>
                </div>
              )}
            </div>

            {/* Action Buttons */}
            <div className="flex items-center gap-2">
              {hasOffer && myOffer ? (
                <>
                  <Button
                    onClick={() => onEditOffer(product, myOffer)}
                    variant="outline"
                    fullWidth={false}
                    className="!px-3 !py-2"
                  >
                    <Edit size={16} />
                    Edit
                  </Button>
                  <Button
                    onClick={() => onRemoveOffer(myOffer.id, product.product_name)}
                    variant="danger"
                    fullWidth={false}
                    className="!px-3 !py-2"
                  >
                    <Trash2 size={16} />
                    Remove
                  </Button>
                </>
              ) : (
                <Button
                  onClick={() => onAddOffer(product)}
                  variant="primary"
                  fullWidth={false}
                  className="!px-4 !py-2"
                >
                  <Plus size={16} />
                  Add to Offers
                </Button>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ProductCard;
/* FILE: src/components/supplier/RequestProductModal.tsx */
// FILE PATH: src/components/supplier/RequestProductModal.tsx
/**
 * REQUEST PRODUCT MODAL - FIXED VERSION
 * 
 * FIXES:
 * ✅ Price field now uses native input (not Input2 component)
 * ✅ Availability options match validation: "Limited" (not "Limited Stock")
 * ✅ Added debug console logs
 */

import { useState } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { X, Package, Upload, FileText, Layers, DollarSign, CheckCircle } from 'lucide-react';
import toast from 'react-hot-toast';

import { Category, supplierProductsAPI } from '../../api/handlers/supplierProducts.api';
import { requestProductSchema, RequestProductFormData } from '../../utils/validators';
import Input2 from '../common/Input2';
import Button from '../common/Buttons';

interface RequestProductModalProps {
  isOpen: boolean;
  onClose: () => void;
  categories: Category[];
}

const RequestProductModal = ({ isOpen, onClose, categories }: RequestProductModalProps) => {
  const queryClient = useQueryClient();
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [previewUrl, setPreviewUrl] = useState<string | null>(null);

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm<RequestProductFormData>({
    resolver: zodResolver(requestProductSchema),
    defaultValues: {
      availability_status: 'In Stock',
    },
  });

  const requestProductMutation = useMutation({
    mutationFn: supplierProductsAPI.requestMasterProduct,
    onSuccess: () => {
      toast.success('Product request submitted successfully!');
      queryClient.invalidateQueries({ queryKey: ['supplier-products'] });
      handleClose();
    },
    onError: (error: any) => {
      const message = error.response?.data?.message || 'Failed to submit request';
      toast.error(message);
      console.error('Error:', error);
    },
  });

  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      if (!file.type.startsWith('image/')) {
        toast.error('Please select an image file');
        return;
      }
      if (file.size > 5 * 1024 * 1024) {
        toast.error('Image must be less than 5MB');
        return;
      }
      setSelectedFile(file);
      const reader = new FileReader();
      reader.onloadend = () => setPreviewUrl(reader.result as string);
      reader.readAsDataURL(file);
    }
  };

  const removeImage = () => {
    setSelectedFile(null);
    setPreviewUrl(null);
  };

  const onSubmit = (data: RequestProductFormData) => {
    console.log('📝 Form Data:', data);
    
    const payload = {
      product_name: data.product_name,
      product_type: data.product_type,
      category_id: data.category_id,
      specifications: data.specifications || '',
      unit_of_measure: data.unit_of_measure,
      price: data.price,
      availability_status: data.availability_status,
      photo: selectedFile || null,
    };

    console.log('🚀 Sending payload:', payload);
    requestProductMutation.mutate(payload);
  };

  const handleClose = () => {
    reset();
    setSelectedFile(null);
    setPreviewUrl(null);
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        
        {/* Header */}
        <div className="sticky top-0 bg-white z-10 flex items-center justify-between p-6 border-b-2 border-secondary-100">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 bg-primary-100 rounded-xl flex items-center justify-center">
              <Package size={24} className="text-primary-600" />
            </div>
            <div>
              <h2 className="text-2xl font-bold text-secondary-900">Request New Product</h2>
              <p className="text-sm text-secondary-600">Submit for admin approval</p>
            </div>
          </div>
          <button
            onClick={handleClose}
            disabled={requestProductMutation.isPending}
            className="text-secondary-400 hover:text-secondary-600 hover:bg-secondary-100 rounded-lg p-2 transition-colors"
          >
            <X size={24} />
          </button>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit(onSubmit)} className="p-6 space-y-6">
          
          {/* Product Name */}
          <Input2
            label="Product Name"
            type="text"
            placeholder="e.g., Premium Blue Metal"
            icon={Package}
            error={errors.product_name?.message}
            {...register('product_name')}
            required
          />

          {/* Product Type */}
          <Input2
            label="Product Type"
            type="text"
            placeholder="e.g., Construction Material"
            icon={Layers}
            error={errors.product_type?.message}
            {...register('product_type')}
            required
          />

          {/* Category */}
          <div>
            <label className="block text-sm font-medium text-secondary-700 mb-2">
              Category <span className="text-error-500">*</span>
            </label>
            <div className="relative">
              <Layers className="absolute left-3 top-1/2 -translate-y-1/2 text-secondary-400" size={20} />
              <select
                {...register('category_id', { valueAsNumber: true })}
                className={`
                  w-full pl-11 pr-4 py-3 rounded-lg border-2 transition-all
                  ${errors.category_id 
                    ? 'border-error-500 focus:border-error-500 focus:ring-error-500' 
                    : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
                  }
                  focus:outline-none focus:ring-2 focus:ring-opacity-20
                `}
              >
                <option value="">Select category</option>
                {categories.map((cat) => (
                  <option key={cat.id} value={cat.id}>
                    {cat.name}
                  </option>
                ))}
              </select>
            </div>
            {errors.category_id && (
              <p className="text-sm text-error-500 mt-1">{errors.category_id.message}</p>
            )}
          </div>

          {/* Unit of Measure */}
          <Input2
            label="Unit of Measure"
            type="text"
            placeholder="e.g., ton, kg, cubic meter"
            icon={Layers}
            error={errors.unit_of_measure?.message}
            {...register('unit_of_measure')}
            required
          />

          {/* Price - FIXED: Using native input */}
          <div>
            <label className="block text-sm font-medium text-secondary-700 mb-2">
              Price per Unit <span className="text-error-500">*</span>
            </label>
            <div className="relative">
              <DollarSign className="absolute left-3 top-1/2 -translate-y-1/2 text-secondary-400" size={20} />
              <input
                type="number"
                step="0.01"
                min="0"
                placeholder="0.00"
                {...register('price')}
                className={`
                  w-full pl-11 pr-4 py-3 rounded-lg border-2 transition-all
                  ${errors.price 
                    ? 'border-error-500 focus:border-error-500 focus:ring-error-500' 
                    : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
                  }
                  focus:outline-none focus:ring-2 focus:ring-opacity-20
                `}
              />
            </div>
            {errors.price && (
              <p className="text-sm text-error-500 mt-1">{errors.price.message}</p>
            )}
          </div>

          {/* Availability Status - FIXED: Options match validation */}
          <div>
            <label className="block text-sm font-medium text-secondary-700 mb-2">
              Availability Status <span className="text-error-500">*</span>
            </label>
            <div className="relative">
              <CheckCircle className="absolute left-3 top-1/2 -translate-y-1/2 text-secondary-400" size={20} />
              <select
                {...register('availability_status')}
                className={`
                  w-full pl-11 pr-4 py-3 rounded-lg border-2 transition-all
                  ${errors.availability_status 
                    ? 'border-error-500 focus:border-error-500 focus:ring-error-500' 
                    : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'
                  }
                  focus:outline-none focus:ring-2 focus:ring-opacity-20
                `}
              >
                <option value="In Stock">In Stock</option>
                <option value="Out of Stock">Out of Stock</option>
                <option value="Limited">Limited</option>
              </select>
            </div>
            {errors.availability_status && (
              <p className="text-sm text-error-500 mt-1">{errors.availability_status.message}</p>
            )}
          </div>

          {/* Specifications */}
          <div>
            <label className="block text-sm font-medium text-secondary-700 mb-2">
              Specifications
            </label>
            <textarea
              {...register('specifications')}
              rows={4}
              placeholder="Product specifications..."
              className={`
                w-full px-4 py-3 rounded-lg border-2 transition-all resize-none
                ${errors.specifications 
                  ? 'border-error-500 focus:border-error-500' 
                  : 'border-secondary-200 focus:border-primary-500'
                }
                focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20
              `}
            />
          </div>

          {/* Image Upload */}
          <div>
            <label className="block text-sm font-medium text-secondary-700 mb-2">
              Product Image (Optional)
            </label>
            
            {previewUrl ? (
              <div className="relative">
                <img
                  src={previewUrl}
                  alt="Preview"
                  className="w-full h-48 object-cover rounded-lg border-2 border-secondary-200"
                />
                <button
                  type="button"
                  onClick={removeImage}
                  className="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 shadow-lg"
                >
                  <X size={16} />
                </button>
              </div>
            ) : (
              <label className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-secondary-300 rounded-lg cursor-pointer bg-secondary-50 hover:bg-secondary-100">
                <Upload size={32} className="text-secondary-400 mb-2" />
                <span className="text-sm text-secondary-600">Click to upload</span>
                <span className="text-xs text-secondary-500 mt-1">PNG, JPG up to 5MB</span>
                <input
                  type="file"
                  accept="image/*"
                  onChange={handleFileChange}
                  className="hidden"
                />
              </label>
            )}
          </div>

          {/* Info Box */}
          <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
            <div className="flex gap-3">
              <FileText className="text-blue-600 flex-shrink-0 mt-0.5" size={20} />
              <p className="text-sm text-blue-700">
                Once approved, this product will be added to the master inventory.
              </p>
            </div>
          </div>

          {/* Buttons */}
          <div className="flex gap-3 pt-4 border-t-2 border-secondary-100">
            <Button
              type="button"
              onClick={handleClose}
              variant="outline"
              fullWidth
              disabled={requestProductMutation.isPending}
            >
              Cancel
            </Button>
            <Button
              type="submit"
              variant="primary"
              fullWidth
              disabled={requestProductMutation.isPending}
              isLoading={requestProductMutation.isPending}
            >
              {requestProductMutation.isPending ? 'Submitting...' : 'Submit Request'}
            </Button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default RequestProductModal;
/* FILE: src/features/components/ProjectForm.tsx */
// --- src/features/projects/components/ProjectForm.tsx ---
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { projectSchema, ProjectFormValues } from '../projects/validators';
import Input from '../../components/common/Input';
import Button from '../../components/common/Buttons';

type Props = { initial?: Partial<ProjectFormValues>; onSubmit: (v: ProjectFormValues) => void; submitting?: boolean };
export default function ProjectForm({ initial, onSubmit, submitting }: Props) {
  const { register, handleSubmit, formState: { errors } } = useForm<ProjectFormValues>({
    resolver: zodResolver(projectSchema),
    defaultValues: { ...initial },
  });

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-4 max-w-2xl">
      <Input label="Project Name" placeholder="e.g. Site A – Footings" {...register('name')} error={errors.name?.message} />
      <Input label="Site Contact Name" placeholder="Optional" {...register('site_contact_name')} error={errors.site_contact_name?.message} />
      <Input label="Site Contact Phone" placeholder="Optional" {...register('site_contact_phone')} error={errors.site_contact_phone?.message} />
      <div>
        <label className="block text-sm font-medium mb-1">Site Instructions</label>
        <textarea className="w-full border rounded px-3 py-2" rows={4} placeholder="Access notes, safety, gate code" {...register('site_instructions')} />
        {errors.site_instructions && <p className="text-red-600 text-xs mt-1">{errors.site_instructions.message}</p>}
      </div>
      <Button type="submit" disabled={submitting}>{submitting ? 'Saving' : 'Save Project'}</Button>
    </form>
  );
}

/* FILE: src/features/projects/hooks.ts */
// --- src/features/projects/hooks.ts ---
import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query';
import { projectsAPI, ProjectDTO, ProjectCreateInput, ProjectUpdateInput, Paginated } from '../../api/handlers/projects.api';
import { projectKeys } from './queryKeys';

export const useProjects = (params: Record<string, unknown>) =>
  useQuery<Paginated<ProjectDTO>>({ queryKey: projectKeys.list(params), queryFn: () => projectsAPI.list(params), keepPreviousData: true });

export const useProject = (id?: number) =>
  useQuery<ProjectDTO>({ queryKey: id ? projectKeys.detail(id) : ['projects','detail','idle'], queryFn: () => projectsAPI.get(id!), enabled: !!id });

export const useCreateProject = () => {
  const qc = useQueryClient();
  return useMutation({
    mutationFn: (payload: ProjectCreateInput) => projectsAPI.create(payload),
    onSuccess: () => qc.invalidateQueries({ queryKey: projectKeys.all }),
  });
};

export const useUpdateProject = (id: number) => {
  const qc = useQueryClient();
  return useMutation({
    mutationFn: (payload: ProjectCreateInput) => projectsAPI.update({ id, ...payload }),
    onSuccess: () => {
      qc.invalidateQueries({ queryKey: projectKeys.detail(id) });
      qc.invalidateQueries({ queryKey: projectKeys.lists() });
    },
  });
};

export const useDeleteProject = () => {
  const qc = useQueryClient();
  return useMutation({
    mutationFn: (id: number) => projectsAPI.remove(id),
    onSuccess: () => qc.invalidateQueries({ queryKey: projectKeys.lists() }),
  });
};

/* FILE: src/features/projects/queryKeys.ts */
// --- src/features/projects/queryKeys.ts ---
export const projectKeys = {
  all: ['projects'] as const,
  lists: () => [...projectKeys.all, 'list'] as const,
  list: (params: Record<string, unknown>) => [...projectKeys.lists(), params] as const,
  details: () => [...projectKeys.all, 'detail'] as const,
  detail: (id: number) => [...projectKeys.details(), id] as const,
};

/* FILE: src/features/projects/validators.ts */
// --- src/features/projects/validators.ts ---
import { z } from 'zod';

export const projectSchema = z.object({
  name: z.string().min(1, 'Project name is required'),
  site_contact_name: z.string().max(255, 'Max 255 characters').optional().or(z.literal('').transform(() => undefined)),
  site_contact_phone: z.string().max(50, 'Max 50 characters').optional().or(z.literal('').transform(() => undefined)),
  site_instructions: z.string().optional().or(z.literal('').transform(() => undefined)),
});
export type ProjectFormValues = z.infer<typeof projectSchema>;
/* FILE: src/index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Optional: Add Inter font */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
/* FILE: src/main.tsx */
// src/main.tsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
/* FILE: src/pages/admin/AdminSupplierDeliveryZones.tsx */
// src/pages/admin/AdminSupplierDeliveryZones.tsx
import React, { useState, useMemo } from 'react';
import { useQuery } from '@tanstack/react-query';
import {
  Search,
  Grid3X3,
  Map as MapIcon,
  Loader2,
  AlertCircle,
  ChevronLeft,
  ChevronRight,
  Home,
  Users,
  Package,
  ShoppingCart,
  Settings,
  BarChart,
  MapPin,
} from 'lucide-react';

import DashboardLayout from '../../components/layout/DashboardLayout';
import AdminSupplierZonesStats from '../../components/admin/AdminSupplierZonesStats';
import SupplierZoneCard from '../../components/admin/SupplierZoneCard';
import AdminSupplierZonesMapView from '../../components/admin/AdminSupplierZonesMapView';
import { adminSupplierZonesAPI } from '../../api/handlers/adminSupplierZones.api';

// Generate consistent random color per supplier
const generateSupplierColor = (supplierId: number): string => {
  const colors = [
    '#10B981', '#3B82F6', '#8B5CF6', '#F59E0B',
    '#EF4444', '#EC4899', '#14B8A6', '#F97316',
    '#6366F1', '#84CC16', '#F43F5E', '#06B6D4',
    '#8B5CF6', '#F59E0B', '#10B981', '#EF4444',
  ];
  return colors[supplierId % colors.length];
};

const AdminSupplierDeliveryZones = () => {
  const [activeView, setActiveView] = useState<'card' | 'map'>('card');
  const [searchTerm, setSearchTerm] = useState('');
  const [page, setPage] = useState(1);
  const [perPage, setPerPage] = useState(10);

  const menuItems = [
    { label: 'Dashboard', path: '/admin/dashboard', icon: <Home size={20} /> },
    { label: 'Users', path: '/admin/users', icon: <Users size={20} /> },
    { label: 'Products', path: '/admin/master-products', icon: <Package size={20} /> },
    { label: 'Supplier Delivery Zones', path: '/admin/supplier-zones', icon: <MapPin size={20} /> },
    { label: 'Orders', path: '/admin/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Reports', path: '/admin/reports', icon: <BarChart size={20} /> },
    { label: 'Settings', path: '/admin/settings', icon: <Settings size={20} /> },
  ];

  // Fetch suppliers with zones
  const { data, isLoading, error } = useQuery({
    queryKey: ['admin-supplier-zones', page, perPage, searchTerm],
    queryFn: () => adminSupplierZonesAPI.getSuppliersWithZones({
      page,
      per_page: perPage,
      search: searchTerm || undefined,
    }),
    keepPreviousData: true,
  });

  // Generate color map for suppliers
  const supplierColors = useMemo(() => {
    const colorMap = new Map<number, string>();
    data?.data.forEach((supplier) => {
      colorMap.set(supplier.id, generateSupplierColor(supplier.id));
    });
    return colorMap;
  }, [data]);

  const suppliers = data?.data || [];
  const pagination = {
    currentPage: data?.current_page || 1,
    lastPage: data?.last_page || 1,
    total: data?.total || 0,
    from: data?.from || 0,
    to: data?.to || 0,
  };

  const handleSearch = (value: string) => {
    setSearchTerm(value);
    setPage(1); // Reset to first page on search
  };

  const handlePerPageChange = (value: number) => {
    setPerPage(value);
    setPage(1); // Reset to first page
  };

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="min-h-screen bg-secondary-50 p-6">
        <div className="max-w-7xl mx-auto space-y-6">
          {/* Header */}
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-3xl font-bold text-secondary-900 flex items-center gap-3">
                <MapPin size={32} className="text-primary-600" />
                Supplier Delivery Zones
              </h1>
              <p className="text-secondary-600 mt-2">
                View and analyze supplier service areas across the platform
              </p>
            </div>
          </div>

          {/* Stats Card */}
          {!isLoading && !error && (
            <AdminSupplierZonesStats 
              suppliers={suppliers} 
              totalSuppliers={pagination.total} 
            />
          )}

          {/* Search & View Toggle */}
          <div className="bg-white rounded-xl border-2 border-secondary-200 p-4">
            <div className="flex flex-col md:flex-row gap-4 items-stretch md:items-center">
              {/* Search */}
              <div className="flex-1 relative">
                <Search 
                  className="absolute left-3 top-1/2 -translate-y-1/2 text-secondary-400" 
                  size={20} 
                />
                <input
                  type="text"
                  placeholder="Search suppliers by name or email..."
                  value={searchTerm}
                  onChange={(e) => handleSearch(e.target.value)}
                  className="w-full pl-10 pr-4 py-3 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                />
              </div>

              {/* View Toggle */}
              <div className="bg-white rounded-xl border-2 border-secondary-200 p-2 inline-flex gap-2">
                <button
                  onClick={() => setActiveView('card')}
                  className={`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium transition-all ${
                    activeView === 'card'
                      ? 'bg-primary-500 text-white shadow-lg'
                      : 'text-secondary-600 hover:bg-secondary-50'
                  }`}
                >
                  <Grid3X3 size={20} />
                  Card View
                </button>
                <button
                  onClick={() => setActiveView('map')}
                  className={`flex items-center gap-2 px-6 py-2.5 rounded-lg font-medium transition-all ${
                    activeView === 'map'
                      ? 'bg-primary-500 text-white shadow-lg'
                      : 'text-secondary-600 hover:bg-secondary-50'
                  }`}
                >
                  <MapIcon size={20} />
                  Map View
                </button>
              </div>
            </div>
          </div>

          {/* Loading State */}
          {isLoading && (
            <div className="flex flex-col items-center justify-center py-20">
              <Loader2 size={48} className="text-primary-600 animate-spin mb-4" />
              <p className="text-secondary-600">Loading supplier delivery zones...</p>
            </div>
          )}

          {/* Error State */}
          {error && (
            <div className="bg-error-50 border border-error-200 rounded-xl p-6 text-center">
              <AlertCircle size={48} className="text-error-500 mx-auto mb-4" />
              <p className="text-error-700 font-medium">Failed to load supplier zones</p>
              <p className="text-error-600 text-sm mt-2">{(error as Error).message}</p>
            </div>
          )}

          {/* Empty State */}
          {!isLoading && !error && suppliers.length === 0 && (
            <div className="bg-white rounded-xl border-2 border-dashed border-secondary-300 p-12 text-center">
              <div className="w-24 h-24 rounded-full bg-primary-50 flex items-center justify-center mx-auto mb-6">
                <MapPin size={48} className="text-primary-400" />
              </div>
              <h3 className="text-xl font-bold text-secondary-900 mb-2">
                No Suppliers Found
              </h3>
              <p className="text-secondary-600 mb-6 max-w-md mx-auto">
                {searchTerm 
                  ? `No suppliers match "${searchTerm}"`
                  : 'No suppliers with delivery zones found in the system'}
              </p>
            </div>
          )}

          {/* Card View */}
          {!isLoading && !error && activeView === 'card' && suppliers.length > 0 && (
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {suppliers.map((supplier) => (
                <SupplierZoneCard
                  key={supplier.id}
                  supplier={supplier}
                  color={supplierColors.get(supplier.id) || '#3B82F6'}
                />
              ))}
            </div>
          )}

          {/* Map View */}
          {!isLoading && !error && activeView === 'map' && suppliers.length > 0 && (
            <AdminSupplierZonesMapView 
              suppliers={suppliers} 
              supplierColors={supplierColors}
            />
          )}

          {/* Pagination */}
          {!isLoading && !error && suppliers.length > 0 && (
            <div className="bg-white rounded-xl border-2 border-secondary-200 p-4 flex items-center justify-between">
              <div className="flex items-center gap-2">
                <span className="text-sm text-secondary-600">
                  Showing {pagination.from} to {pagination.to} of {pagination.total} suppliers
                </span>
              </div>

              <div className="flex items-center gap-4">
                {/* Per Page Selector */}
                <select
                  value={perPage}
                  onChange={(e) => handlePerPageChange(Number(e.target.value))}
                  className="px-3 py-2 border border-secondary-300 rounded-lg text-sm focus:outline-none focus:border-primary-500"
                >
                  <option value={10}>10 per page</option>
                  <option value={25}>25 per page</option>
                  <option value={50}>50 per page</option>
                  <option value={100}>100 per page</option>
                </select>

                {/* Page Navigation */}
                <div className="flex items-center gap-2">
                  <button
                    onClick={() => setPage(page - 1)}
                    disabled={page === 1}
                    className="p-2 border border-secondary-300 rounded-lg hover:bg-secondary-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    <ChevronLeft size={18} />
                  </button>

                  <span className="text-sm text-secondary-700 px-3">
                    Page {pagination.currentPage} of {pagination.lastPage}
                  </span>

                  <button
                    onClick={() => setPage(page + 1)}
                    disabled={page === pagination.lastPage}
                    className="p-2 border border-secondary-300 rounded-lg hover:bg-secondary-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    <ChevronRight size={18} />
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    </DashboardLayout>
  );
};

export default AdminSupplierDeliveryZones;
/* FILE: src/pages/admin/Dashboard.tsx */
// src/pages/admin/Dashboard.tsx
import { Home, Users, Package, ShoppingCart, Settings, BarChart, MapPin } from 'lucide-react';
import DashboardLayout from '../../components/layout/DashboardLayout';

const AdminDashboard = () => {
  const menuItems = [
    { label: 'Dashboard', path: '/admin/dashboard', icon: <Home size={20} /> },
    { label: 'Users', path: '/admin/users', icon: <Users size={20} /> },
    { label: 'Products', path: '/admin/master-products', icon: <Package size={20} /> },
    { label: 'Supplier Delivery Zones', path: '/admin/supplier-zones', icon: <MapPin size={20} /> },
    { label: 'Orders', path: '/admin/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Reports', path: '/admin/reports', icon: <BarChart size={20} /> },
    { label: 'Settings', path: '/admin/settings', icon: <Settings size={20} /> },
  ];

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="bg-white rounded-xl shadow-card p-8">
        <h1 className="text-3xl font-bold text-secondary-900">Admin Dashboard</h1>
        <p className="text-secondary-600 mt-2">System overview and management</p>
      </div>
    </DashboardLayout>
  );
};

export default AdminDashboard;
/* FILE: src/pages/admin/MasterProducts/AddMasterProduct.tsx */
// FILE PATH: src/pages/admin/MasterProducts/AddMasterProduct.tsx

/**
 * Add Master Product Page
 * 
 * Placeholder page for adding new master products.
 * We'll implement the full form in the next step.
 */

import React from 'react';
import { Link } from 'react-router-dom';

const AddMasterProduct = () => {
  return (
    <div className="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
      <div className="max-w-7xl mx-auto">
        {/* Breadcrumb */}
        <nav className="mb-8">
          <ol className="flex items-center space-x-2 text-sm text-gray-500">
            <li>
              <Link to="/admin/master-products" className="hover:text-blue-600">
                Master Products
              </Link>
            </li>
            <li>
              <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" />
              </svg>
            </li>
            <li className="text-gray-900 font-medium">Add Product</li>
          </ol>
        </nav>

        {/* Page Content */}
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-4">Add</h1>
          <p className="text-gray-600">
            Add new master product form will be implemented here.
          </p>
        </div>
      </div>
    </div>
  );
};

export default AddMasterProduct;
/* FILE: src/pages/admin/MasterProducts/EditMasterProduct.tsx */
// FILE PATH: src/pages/admin/MasterProducts/EditMasterProduct.tsx

/**
 * Edit Master Product Page
 * 
 * Placeholder page for editing existing master products.
 * We'll implement the full form with pre-populated data in the next step.
 */

import React from 'react';
import { Link, useParams } from 'react-router-dom';

const EditMasterProduct = () => {
  const { id } = useParams();

  return (
    <div className="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
      <div className="max-w-7xl mx-auto">
        {/* Breadcrumb */}
        <nav className="mb-8">
          <ol className="flex items-center space-x-2 text-sm text-gray-500">
            <li>
              <Link to="/admin/master-products" className="hover:text-blue-600">
                Master Products
              </Link>
            </li>
            <li>
              <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" />
              </svg>
            </li>
            <li className="text-gray-900 font-medium">Edit Product #{id}</li>
          </ol>
        </nav>

        {/* Page Content */}
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-4">Edit</h1>
          <p className="text-gray-600">
            Edit master product form (ID: {id}) will be implemented here.
          </p>
        </div>
      </div>
    </div>
  );
};

export default EditMasterProduct;
/* FILE: src/pages/admin/MasterProducts/MasterProductsList.tsx */
// FILE PATH: src/pages/admin/MasterProducts/MasterProductsList.tsx
import { useState, useEffect, useMemo } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import toast from 'react-hot-toast';
import { Home, Users, Package, ShoppingCart, BarChart, MapPin, Settings } from 'lucide-react';
import {
  masterProductsAPI,
  MasterProduct,
  MasterProductsFilters
} from '../../../api/handlers/masterProducts.api';
import DashboardLayout from '../../../components/layout/DashboardLayout';
import StatusBadge from '../../../components/common/StatusBadge';
import Pagination from '../../../components/common/Pagination';
import ConfirmModal from '../../../components/common/ConfirmModal';

const PER_PAGE = 10;

// Inline SVG placeholder to prevent image loading errors
const PLACEHOLDER_IMAGE = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2UzZTNlMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTQiIGZpbGw9IiM5OTkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ObyBJbWFnZTwvdGV4dD48L3N2Zz4=';

const MasterProductsList = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();

  const menuItems = useMemo(() => [
    { label: 'Dashboard', path: '/admin/dashboard', icon: <Home size={20} /> },
    { label: 'Users', path: '/admin/users', icon: <Users size={20} /> },
    { label: 'Products', path: '/admin/master-products', icon: <Package size={20} /> },
    { label: 'Supplier Delivery Zones', path: '/admin/supplier-zones', icon: <MapPin size={20} /> },
    { label: 'Orders', path: '/admin/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Reports', path: '/admin/reports', icon: <BarChart size={20} /> },
    { label: 'Settings', path: '/admin/settings', icon: <Settings size={20} /> },
  ], []);

  // State - Simple filter management
  const [filters, setFilters] = useState<MasterProductsFilters>({
    page: 1,
    per_page: PER_PAGE,
  });
  
  const [searchQuery, setSearchQuery] = useState<string>('');
  const [debouncedSearch, setDebouncedSearch] = useState('');

  // Modal
  const [confirmModal, setConfirmModal] = useState<{
    isOpen: boolean;
    productId: number | null;
    currentStatus: boolean | null;
    loading: boolean;
  }>({
    isOpen: false,
    productId: null,
    currentStatus: null,
    loading: false,
  });

  // Debounce search
  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedSearch(searchQuery);
      setFilters(prev => ({ ...prev, page: 1 }));
    }, 500);
    return () => clearTimeout(timer);
  }, [searchQuery]);

  // Build query params
  const queryParams: MasterProductsFilters = {
    ...filters,
    search: debouncedSearch || undefined,
  };

  // Fetch Products using React Query
  const { data: productsData, isLoading, error } = useQuery({
    queryKey: ['masterProducts', queryParams],
    queryFn: () => masterProductsAPI.getAll(queryParams),
    keepPreviousData: true,
  });

  // Toggle Approval Mutation
  const toggleApprovalMutation = useMutation({
    mutationFn: ({ id, status }: { id: number; status: boolean }) => 
      masterProductsAPI.toggleApproval(id, status),
    onSuccess: () => {
      queryClient.invalidateQueries(['masterProducts']);
      toast.success('Product status updated successfully');
      setConfirmModal({ isOpen: false, productId: null, currentStatus: null, loading: false });
    },
    onError: (error: Error) => {
      toast.error(error.message || 'Failed to update product status');
      setConfirmModal(prev => ({ ...prev, loading: false }));
    },
  });

  // Handlers
  const handleFilterChange = (key: keyof MasterProductsFilters, value: any) => {
    setFilters(prev => ({ ...prev, [key]: value, page: 1 }));
  };

  const handleStatusToggle = (productId: number, currentStatus: boolean) => {
    setConfirmModal({ isOpen: true, productId, currentStatus, loading: false });
  };

  const confirmStatusChange = () => {
    const { productId, currentStatus } = confirmModal;
    if (!productId || currentStatus === null) return;

    const newStatus = !currentStatus;
    setConfirmModal(prev => ({ ...prev, loading: true }));
    toggleApprovalMutation.mutate({ id: productId, status: newStatus });
  };

  const handleDelete = (productId: number) => {
    toast('Delete functionality coming soon', { icon: '🚧' });
  };

  // Clear all filters
  const clearFilters = () => {
    setFilters({
      page: 1,
      per_page: PER_PAGE,
    });
    setSearchQuery('');
  };

  // Check if any filters are active
  const hasActiveFilters = searchQuery || filters.category || filters.is_approved !== undefined;

  // Fixed image handler - prevents infinite loop
  const handleImageError = (e: React.SyntheticEvent<HTMLImageElement>) => {
    const target = e.currentTarget;
    // Only set placeholder if not already set to prevent loop
    if (target.src !== PLACEHOLDER_IMAGE) {
      target.src = PLACEHOLDER_IMAGE;
      // Remove onError to prevent further triggers
      target.onerror = null;
    }
  };

  const getImageUrl = (photoPath: string | null): string => {
    if (!photoPath) return PLACEHOLDER_IMAGE;
    const baseUrl = import.meta.env.VITE_API_BASE_URL?.replace('/api', '') || 'http://127.0.0.1:8000';
    return `${baseUrl}/storage/${photoPath}`;
  };

  // Extract data
  const products = productsData?.data || [];
  const pagination = {
    currentPage: productsData?.current_page || 1,
    lastPage: productsData?.last_page || 1,
    total: productsData?.total || 0,
    perPage: PER_PAGE,
  };

  // Calculate stats
  const stats = {
    total: pagination.total,
    approved: products.filter(p => p.is_approved === 1).length,
    pending: products.filter(p => p.is_approved === 0).length,
  };

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
        <div className="max-w-7xl mx-auto">
          {/* Header */}
          <div className="mb-8">
            <div className="flex justify-between items-center">
              <div>
                <h1 className="text-3xl font-bold text-gray-900">Master Products</h1>
                <p className="mt-1 text-sm text-gray-600">
                  Manage all master products and their supplier offers
                </p>
              </div>
              <Link
                to="/admin/master-products/add"
                className="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg shadow-sm transition-colors"
              >
                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m8-8H4" />
                </svg>
                Add Product
              </Link>
            </div>
          </div>

          {/* Stats Cards */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div className="bg-white rounded-lg shadow p-6">
              <div className="flex items-center">
                <div className="flex-shrink-0 bg-blue-100 rounded-md p-3">
                  <svg className="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                  </svg>
                </div>
                <div className="ml-4">
                  <p className="text-sm font-medium text-gray-500">Total Products</p>
                  <p className="text-2xl font-semibold text-gray-900">{stats.total}</p>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-lg shadow p-6">
              <div className="flex items-center">
                <div className="flex-shrink-0 bg-green-100 rounded-md p-3">
                  <svg className="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div className="ml-4">
                  <p className="text-sm font-medium text-gray-500">Approved</p>
                  <p className="text-2xl font-semibold text-gray-900">{stats.approved}</p>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-lg shadow p-6">
              <div className="flex items-center">
                <div className="flex-shrink-0 bg-yellow-100 rounded-md p-3">
                  <svg className="h-6 w-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
                <div className="ml-4">
                  <p className="text-sm font-medium text-gray-500">Pending Approval</p>
                  <p className="text-2xl font-semibold text-gray-900">{stats.pending}</p>
                </div>
              </div>
            </div>
          </div>

          {/* Filters */}
          <div className="bg-white rounded-lg shadow p-4 mb-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              {/* Search */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Search Products
                </label>
                <input
                  type="text"
                  placeholder="Search by name or type..."
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                />
              </div>

              {/* Status Filter */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Status
                </label>
                <select
                  value={filters.is_approved !== undefined ? (filters.is_approved === 1 ? 'approved' : 'pending') : ''}
                  onChange={(e) => handleFilterChange('is_approved', e.target.value ? (e.target.value === 'approved' ? 1 : 0) : undefined)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">All Status</option>
                  <option value="approved">Active</option>
                  <option value="pending">Inactive</option>
                </select>
              </div>

              {/* Category Filter */}
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Category
                </label>
                <select
                  value={filters.category || ''}
                  onChange={(e) => handleFilterChange('category', e.target.value || undefined)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                  <option value="">All Categories</option>
                  <option value="1">Cats</option>
                </select>
              </div>
            </div>

            {/* Clear Filters Button */}
            {hasActiveFilters && (
              <button
                onClick={clearFilters}
                className="mt-4 text-sm text-primary-600 hover:text-primary-700 font-medium"
              >
                Clear all filters
              </button>
            )}
          </div>

          {/* Table */}
          <div className="bg-white rounded-lg shadow overflow-hidden">
            {isLoading ? (
              <div className="flex justify-center items-center py-12">
                <div className="flex flex-col items-center gap-3">
                  <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                  <p className="text-gray-500">Loading products...</p>
                </div>
              </div>
            ) : error ? (
              <div className="flex flex-col items-center justify-center py-12 text-red-500">
                <p className="mb-2">Failed to load products</p>
                <button 
                  onClick={() => queryClient.invalidateQueries(['masterProducts'])}
                  className="text-sm text-blue-600 hover:underline"
                >
                  Try again
                </button>
              </div>
            ) : products.length === 0 ? (
              <div className="flex flex-col items-center justify-center py-12 text-gray-500">
                <svg className="mx-auto h-12 w-12 text-gray-400 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
                <p className="mb-2">No products found</p>
                {hasActiveFilters && (
                  <button 
                    onClick={clearFilters}
                    className="text-sm text-primary-600 hover:underline"
                  >
                    Clear filters
                  </button>
                )}
              </div>
            ) : (
              <>
                <div className="overflow-x-auto">
                  <table className="min-w-full divide-y divide-gray-200">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Product
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Type
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Category
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Added By
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Supplier Offers
                        </th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Status
                        </th>
                        <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                          Actions
                        </th>
                      </tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-gray-200">
                      {products.map((product) => (
                        <tr key={product.id} className="hover:bg-gray-50 transition-colors">
                          {/* Product Info */}
                          <td className="px-6 py-4 whitespace-nowrap">
                            <div className="flex items-center">
                              <div className="flex-shrink-0 h-12 w-12">
                                <img
                                  className="h-12 w-12 rounded-lg object-cover border border-gray-200"
                                  src={getImageUrl(product.photo)}
                                  alt={product.product_name}
                                  onError={handleImageError}
                                />
                              </div>
                              <div className="ml-4">
                                <div className="text-sm font-medium text-gray-900">
                                  {product.product_name}
                                </div>
                                <div className="text-sm text-gray-500">
                                  {product.unit_of_measure}
                                </div>
                              </div>
                            </div>
                          </td>

                          {/* Type */}
                          <td className="px-6 py-4 whitespace-nowrap">
                            <div className="text-sm text-gray-900">{product.product_type}</div>
                          </td>

                          {/* Category */}
                          <td className="px-6 py-4 whitespace-nowrap">
                            <span className="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">
                              {product.category?.name || 'N/A'}
                            </span>
                          </td>

                          {/* Added By */}
                          <td className="px-6 py-4 whitespace-nowrap">
                            <div className="text-sm text-gray-900">{product.added_by?.name}</div>
                            <div className="text-sm text-gray-500">{product.added_by?.email}</div>
                          </td>

                          {/* Supplier Offers Count */}
                          <td className="px-6 py-4 whitespace-nowrap text-center">
                            <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                              {product.supplierOffersCount || 0}
                            </span>
                          </td>

                          {/* Status */}
                          <td className="px-6 py-4 whitespace-nowrap">
                            <StatusBadge
                              isApproved={product.is_approved === 1}
                              onToggle={() => handleStatusToggle(product.id, product.is_approved === 1)}
                            />
                          </td>

                          {/* Actions */}
                          <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <div className="flex justify-end gap-2">
                              <button
                                onClick={() => navigate(`/admin/master-products/view/${product.id}`)}
                                className="text-blue-600 hover:text-blue-900 p-2 hover:bg-blue-50 rounded transition-colors"
                                title="View Details"
                              >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                              </button>
                              <button
                                onClick={() => navigate(`/admin/master-products/edit/${product.id}`)}
                                className="text-green-600 hover:text-green-900 p-2 hover:bg-green-50 rounded transition-colors"
                                title="Edit Product"
                              >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                              </button>
                              <button
                                onClick={() => handleDelete(product.id)}
                                className="text-red-600 hover:text-red-900 p-2 hover:bg-red-50 rounded transition-colors"
                                title="Delete Product (Coming Soon)"
                              >
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                              </button>
                            </div>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>

                {/* Pagination */}
                <Pagination
                  currentPage={pagination.currentPage}
                  lastPage={pagination.lastPage}
                  total={pagination.total}
                  perPage={pagination.perPage}
                  onPageChange={(next) => setFilters(prev => ({ ...prev, page: next }))}
                  loading={isLoading}
                />
              </>
            )}
          </div>

          {/* Confirmation Modal */}
          <ConfirmModal
            isOpen={confirmModal.isOpen}
            onClose={() => setConfirmModal({ isOpen: false, productId: null, currentStatus: null, loading: false })}
            onConfirm={confirmStatusChange}
            title={`${confirmModal.currentStatus ? 'Deactivate' : 'Activate'} Product`}
            message={`Are you sure you want to ${confirmModal.currentStatus ? 'deactivate' : 'activate'} this product? This will change its approval status.`}
            confirmText={confirmModal.currentStatus ? 'Deactivate' : 'Activate'}
            cancelText="Cancel"
            isDanger={confirmModal.currentStatus === true}
            loading={confirmModal.loading || toggleApprovalMutation.isLoading}
          />
        </div>
      </div>
    </DashboardLayout>
  );
};

export default MasterProductsList;
/* FILE: src/pages/admin/MasterProducts/ViewMasterProduct.tsx */
// FILE PATH: src/pages/admin/MasterProducts/ViewMasterProduct.tsx

/**
 * View Master Product Page
 * 
 * Placeholder page for viewing master product details.
 * We'll implement the full details view in the next step.
 */

import React from 'react';
import { Link, useParams } from 'react-router-dom';

const ViewMasterProduct = () => {
  const { id } = useParams();

  return (
    <div className="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
      <div className="max-w-7xl mx-auto">
        {/* Breadcrumb */}
        <nav className="mb-8">
          <ol className="flex items-center space-x-2 text-sm text-gray-500">
            <li>
              <Link to="/admin/master-products" className="hover:text-blue-600">
                Master Products
              </Link>
            </li>
            <li>
              <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" />
              </svg>
            </li>
            <li className="text-gray-900 font-medium">View Product #{id}</li>
          </ol>
        </nav>

        {/* Page Content */}
        <div className="bg-white rounded-lg shadow-lg p-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-4">View</h1>
          <p className="text-gray-600">
            Master product details (ID: {id}) will be displayed here.
          </p>
        </div>
      </div>
    </div>
  );
};

export default ViewMasterProduct;
/* FILE: src/pages/admin/UserCreate.tsx */
// src/pages/admin/UserCreate.tsx
import { useState, useCallback } from 'react';
import { useNavigate } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { 
  ArrowLeft,
  Save,
  User as UserIcon,
  Mail,
  Phone,
  Building2,
  MapPin,
  Truck,
  Home,
  Users,
  Package,
  ShoppingCart,
  Settings,
  BarChart,
  CreditCard,
  Lock
} from 'lucide-react';
import toast from 'react-hot-toast';
import Autocomplete from 'react-google-autocomplete';

import DashboardLayout from '../../components/layout/DashboardLayout';
import Button from '../../components/common/Buttons';
import Input from '../../components/common/Input';
import ImageUpload from '../../components/common/ImageUpload';
import { usersAPI, companiesAPI } from '../../api/handlers/users.api';

// Validation Schema
const userCreateSchema = z.object({
  name: z.string().min(1, 'Name is required'),
  email: z.string().email('Invalid email address'),
  password: z.string().min(6, 'Password must be at least 6 characters'),
  role: z.enum(['admin', 'client', 'supplier']),
  contact_name: z.string().optional(),
  contact_number: z.string().optional(),
  company_name: z.string().optional(),
  location: z.string().optional(),
  delivery_radius: z.number().optional(),
  shipping_address: z.string().optional(),
  billing_address: z.string().optional(),
  lat: z.number().optional(),
  long: z.number().optional(),
  notes: z.string().optional(),
});

type UserCreateFormData = z.infer<typeof userCreateSchema>;

const UserCreate = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();

  const [profileImage, setProfileImage] = useState<File | null>(null);
  const [locationCoords, setLocationCoords] = useState<{ lat: number; lng: number } | null>(null);

  const menuItems = [
    { label: 'Dashboard', path: '/admin/dashboard', icon: <Home size={20} /> },
    { label: 'Users', path: '/admin/users', icon: <Users size={20} /> },
    { label: 'Products', path: '/admin/master-products', icon: <Package size={20} /> },
    { label: 'Supplier Delivery Zones', path: '/admin/supplier-zones', icon: <MapPin size={20} /> },
    { label: 'Orders', path: '/admin/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Reports', path: '/admin/reports', icon: <BarChart size={20} /> },
    { label: 'Settings', path: '/admin/settings', icon: <Settings size={20} /> },
  ];

  const {
    register,
    handleSubmit,
    formState: { errors },
    setValue,
    watch,
  } = useForm<UserCreateFormData>({
    resolver: zodResolver(userCreateSchema),
    defaultValues: {
      role: 'client',
    },
  });

  const watchedRole = watch('role');

  // Fetch Companies
  const { data: companies = [] } = useQuery({
    queryKey: ['companies'],
    queryFn: companiesAPI.getAll,
  });

  // Create User Mutation
  const createUserMutation = useMutation({
    mutationFn: (formData: FormData) => usersAPI.createUser(formData),
    onSuccess: (data) => {
      queryClient.invalidateQueries(['users']);
      toast.success('✅ User created successfully!');
      navigate('/admin/users');
    },
    onError: (error: any) => {
      toast.error(error?.message || 'Failed to create user');
    },
  });

  const handleShippingAddressSelect = useCallback((place: any) => {
    if (place.formatted_address) {
      setValue('shipping_address', place.formatted_address);
    }
    if (place.geometry?.location) {
      const lat = place.geometry.location.lat();
      const lng = place.geometry.location.lng();
      setLocationCoords({ lat, lng });
      setValue('lat', lat);
      setValue('long', lng);
      toast.success(`📍 Location set: ${lat.toFixed(4)}, ${lng.toFixed(4)}`);
    }
  }, [setValue]);

  const handleSupplierLocationSelect = useCallback((place: any) => {
    if (place.formatted_address) {
      setValue('location', place.formatted_address);
    }
  }, [setValue]);

  const onSubmit = (data: UserCreateFormData) => {
    const formData = new FormData();

    // Append all fields
    Object.entries(data).forEach(([key, value]) => {
      if (value !== undefined && value !== '') {
        if (typeof value === 'number') {
          formData.append(key, String(value));
        } else {
          formData.append(key, value);
        }
      }
    });

    // Append profile image
    if (profileImage) {
      formData.append('profile_image', profileImage);
    }

    // Append coordinates for clients
    if (data.role === 'client' && locationCoords) {
      formData.append('lat', String(locationCoords.lat));
      formData.append('long', String(locationCoords.lng));
    }

    createUserMutation.mutate(formData);
  };

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="max-w-4xl mx-auto space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <button
            onClick={() => navigate('/admin/users')}
            className="flex items-center gap-2 text-secondary-600 hover:text-primary-600 transition-colors"
          >
            <ArrowLeft size={20} />
            Back to Users
          </button>
        </div>

        {/* Form Card */}
        <div className="bg-white rounded-2xl shadow-card p-8">
          <h1 className="text-3xl font-bold text-secondary-900 mb-2">Create New User</h1>
          <p className="text-secondary-600 mb-8">Add a new user to the system</p>

          <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
            {/* Profile Image */}
            <ImageUpload
              label="Profile Image (Optional)"
              onChange={setProfileImage}
            />

            {/* Basic Information */}
            <div className="space-y-5">
              <h3 className="text-lg font-semibold text-secondary-900 border-b pb-3">
                Basic Information
              </h3>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <Input
                  label="Full Name"
                  type="text"
                  placeholder="John Doe"
                  icon={UserIcon}
                  register={register('name')}
                  error={errors.name?.message}
                  required
                />

                <Input
                  label="Email Address"
                  type="email"
                  placeholder="john@example.com"
                  icon={Mail}
                  register={register('email')}
                  error={errors.email?.message}
                  required
                />
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Role <span className="text-error-500">*</span>
                  </label>
                  <select
                    {...register('role')}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                  >
                    <option value="admin">Admin</option>
                    <option value="client">Client</option>
                    <option value="supplier">Supplier</option>
                  </select>
                  {errors.role && (
                    <p className="text-sm text-error-500 mt-1">{errors.role.message}</p>
                  )}
                </div>

                <Input
                  label="Password"
                  type="password"
                  placeholder="Minimum 6 characters"
                  icon={Lock}
                  register={register('password')}
                  error={errors.password?.message}
                  required
                />
              </div>
            </div>

            {/* Contact Details */}
            <div className="space-y-5">
              <h3 className="text-lg font-semibold text-secondary-900 border-b pb-3">
                Contact Information
              </h3>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <Input
                  label="Contact Person"
                  type="text"
                  placeholder="Jane Smith"
                  icon={UserIcon}
                  register={register('contact_name')}
                  error={errors.contact_name?.message}
                />

                <Input
                  label="Contact Number"
                  type="tel"
                  placeholder="+92 300 1234567"
                  icon={Phone}
                  register={register('contact_number')}
                  error={errors.contact_number?.message}
                />
              </div>

              <Input
                label="Company Name"
                type="text"
                placeholder="ABC Construction Ltd"
                icon={Building2}
                register={register('company_name')}
                error={errors.company_name?.message}
              />
            </div>

            {/* Client-Specific Fields */}
            {watchedRole === 'client' && (
              <div className="space-y-5 border-t pt-6">
                <h3 className="text-lg font-semibold text-secondary-900 border-b pb-3 flex items-center gap-2">
                  <MapPin size={20} className="text-primary-600" />
                  Address Information (Client)
                </h3>

                <div className="space-y-2">
                  <label className="block text-sm font-medium text-secondary-700">
                    Shipping Address
                  </label>
                  <div className="relative">
                    <MapPin className="absolute left-3 top-3.5 text-secondary-400 z-10" size={20} />
                    <Autocomplete
                      apiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}
                      onPlaceSelected={handleShippingAddressSelect}
                      options={{ types: ['address'], componentRestrictions: { country: 'au' } }}
                      className="w-full pl-10 pr-4 py-3 rounded-lg border-2 border-secondary-200 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                      placeholder="Start typing address..."
                    />
                  </div>
                  {errors.shipping_address && (
                    <p className="text-sm text-error-500">{errors.shipping_address.message}</p>
                  )}
                  {locationCoords && (
                    <div className="bg-success-50 border border-success-200 rounded-lg p-3">
                      <p className="text-xs text-success-700 font-medium flex items-center gap-2">
                        <MapPin size={14} />
                        Location: {locationCoords.lat.toFixed(6)}, {locationCoords.lng.toFixed(6)}
                      </p>
                    </div>
                  )}
                </div>

                <Input
                  label="Billing Address"
                  type="text"
                  placeholder="Same as shipping or different"
                  icon={CreditCard}
                  register={register('billing_address')}
                  error={errors.billing_address?.message}
                />
              </div>
            )}

            {/* Supplier-Specific Fields */}
            {watchedRole === 'supplier' && (
              <div className="space-y-5 border-t pt-6">
                <h3 className="text-lg font-semibold text-secondary-900 border-b pb-3 flex items-center gap-2">
                  <Truck size={20} className="text-success-600" />
                  Business Information (Supplier)
                </h3>

                <div className="space-y-2">
                  <label className="block text-sm font-medium text-secondary-700">
                    Business Location
                  </label>
                  <div className="relative">
                    <MapPin className="absolute left-3 top-3.5 text-secondary-400 z-10" size={20} />
                    <Autocomplete
                      apiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}
                      onPlaceSelected={handleSupplierLocationSelect}
                      options={{ types: ['address'], componentRestrictions: { country: 'au' } }}
                      className="w-full pl-10 pr-4 py-3 rounded-lg border-2 border-secondary-200 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                      placeholder="Start typing business address..."
                    />
                  </div>
                  {errors.location && (
                    <p className="text-sm text-error-500">{errors.location.message}</p>
                  )}
                </div>

                <Input
                  label="Delivery Radius (km)"
                  type="number"
                  placeholder="50"
                  icon={Truck}
                  register={register('delivery_radius', { valueAsNumber: true })}
                  error={errors.delivery_radius?.message}
                />
              </div>
            )}

            {/* Notes */}
            <div className="space-y-2">
              <label className="block text-sm font-medium text-secondary-700">
                Notes (Optional)
              </label>
              <textarea
                {...register('notes')}
                rows={4}
                placeholder="Add any additional notes about this user..."
                className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
              />
              {errors.notes && (
                <p className="text-sm text-error-500">{errors.notes.message}</p>
              )}
            </div>

            {/* Action Buttons */}
            <div className="flex gap-4 pt-6 border-t border-secondary-200">
              <Button
                type="submit"
                isLoading={createUserMutation.isPending}
                disabled={createUserMutation.isPending}
                fullWidth={false}
                className="flex-1"
              >
                <Save size={20} />
                {createUserMutation.isPending ? 'Creating User...' : 'Create User'}
              </Button>

              <Button
                type="button"
                variant="outline"
                onClick={() => navigate('/admin/users')}
                fullWidth={false}
                className="flex-1"
              >
                Cancel
              </Button>
            </div>
          </form>
        </div>
      </div>
    </DashboardLayout>
  );
};

export default UserCreate;
/* FILE: src/pages/admin/UserDetail.tsx */
// src/pages/admin/UserDetail.tsx
import { useParams, useNavigate } from 'react-router-dom';
import { useQuery } from '@tanstack/react-query';
import { 
  ArrowLeft,
  Edit2,
  Mail,
  Phone,
  Building2,
  MapPin,
  User as UserIcon,
  Calendar,
  Shield,
  Package,
  Truck,
  Home,
  Users,
  ShoppingCart,
  Settings,
  BarChart,
  CreditCard
} from 'lucide-react';
import DashboardLayout from '../../components/layout/DashboardLayout';
import Button from '../../components/common/Buttons';
import { usersAPI } from '../../api/handlers/users.api';

// Role Badge Component
const RoleBadge = ({ role }: { role: 'admin' | 'client' | 'supplier' }) => {
  const styles = {
    admin: 'bg-error-100 text-error-700 border-error-200',
    client: 'bg-primary-100 text-primary-700 border-primary-200',
    supplier: 'bg-success-100 text-success-700 border-success-200',
  };

  const icons = {
    admin: '👑',
    client: '👤',
    supplier: '🏢',
  };

  return (
    <span className={`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border ${styles[role]}`}>
      <span className="text-lg">{icons[role]}</span>
      {role.charAt(0).toUpperCase() + role.slice(1)}
    </span>
  );
};

// Info Row Component
const InfoRow = ({ icon: Icon, label, value }: any) => (
  <div className="flex items-start gap-4 py-4 border-b border-secondary-100 last:border-0">
    <div className="w-10 h-10 rounded-lg bg-primary-50 flex items-center justify-center flex-shrink-0">
      <Icon size={20} className="text-primary-600" />
    </div>
    <div className="flex-1">
      <p className="text-sm text-secondary-500 mb-1">{label}</p>
      <p className="text-base font-medium text-secondary-900">{value || 'N/A'}</p>
    </div>
  </div>
);

const UserDetail = () => {
  const { id } = useParams();
  const navigate = useNavigate();

  const menuItems = [
    { label: 'Dashboard', path: '/admin/dashboard', icon: <Home size={20} /> },
    { label: 'Users', path: '/admin/users', icon: <Users size={20} /> },
    { label: 'Products', path: '/admin/master-products', icon: <Package size={20} /> },
    { label: 'Supplier Delivery Zones', path: '/admin/supplier-zones', icon: <MapPin size={20} /> },
    { label: 'Orders', path: '/admin/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Reports', path: '/admin/reports', icon: <BarChart size={20} /> },
    { label: 'Settings', path: '/admin/settings', icon: <Settings size={20} /> },
  ];

  // Fetch User Details
  const { data: user, isLoading, error } = useQuery({
    queryKey: ['user', id],
    queryFn: () => usersAPI.getUser(Number(id)),
    enabled: !!id,
  });

  if (isLoading) {
    return (
      <DashboardLayout menuItems={menuItems}>
        <div className="flex items-center justify-center py-12">
          <div className="w-10 h-10 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin" />
        </div>
      </DashboardLayout>
    );
  }

  if (error || !user) {
    return (
      <DashboardLayout menuItems={menuItems}>
        <div className="text-center py-12">
          <p className="text-error-500 mb-4">Failed to load user details</p>
          <Button onClick={() => navigate('/admin/users')} variant="outline" fullWidth={false}>
            <ArrowLeft size={20} />
            Back to Users
          </Button>
        </div>
      </DashboardLayout>
    );
  }

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="max-w-5xl mx-auto space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <button
            onClick={() => navigate('/admin/users')}
            className="flex items-center gap-2 text-secondary-600 hover:text-primary-600 transition-colors"
          >
            <ArrowLeft size={20} />
            Back to Users
          </button>
          <Button
            onClick={() => navigate(`/admin/users/${id}/edit`)}
            variant="primary"
            fullWidth={false}
          >
            <Edit2 size={20} />
            Edit User
          </Button>
        </div>

        {/* Profile Card */}
        <div className="bg-white rounded-2xl shadow-card overflow-hidden">
          {/* Header Section with Profile Image */}
          <div className="bg-gradient-to-r from-primary-500 to-primary-600 px-8 py-12">
            <div className="flex items-center gap-6">
              <div className="w-24 h-24 rounded-full bg-white flex items-center justify-center shadow-lg">
                {user.profile_image ? (
                  <img
                    src={`${import.meta.env.VITE_IMAGE_BASE_URL}${user.profile_image}`}
                    alt={user.name}
                    className="w-full h-full rounded-full object-cover"
                  />
                ) : (
                  <span className="text-4xl font-bold text-primary-600">
                    {user.name.charAt(0).toUpperCase()}
                  </span>
                )}
              </div>
              <div className="flex-1">
                <h1 className="text-3xl font-bold text-white mb-2">{user.name}</h1>
                <div className="flex items-center gap-4">
                  <RoleBadge role={user.role} />
                  {user.client_public_id && (
                    <span className="px-3 py-1 bg-white/20 text-white rounded-lg text-sm font-medium">
                      ID: {user.client_public_id}
                    </span>
                  )}
                </div>
              </div>
            </div>
          </div>

          {/* Contact Information */}
          <div className="p-8">
            <h2 className="text-xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
              <UserIcon size={24} className="text-primary-600" />
              Contact Information
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="space-y-4">
                <InfoRow icon={Mail} label="Email Address" value={user.email} />
                <InfoRow icon={Phone} label="Contact Number" value={user.contact_number} />
                <InfoRow icon={UserIcon} label="Contact Person" value={user.contact_name} />
              </div>
              <div className="space-y-4">
                <InfoRow icon={Building2} label="Company" value={user.company?.name} />
                <InfoRow icon={Calendar} label="Joined Date" value={new Date(user.created_at).toLocaleDateString()} />
                <InfoRow 
                  icon={Shield} 
                  label="Status" 
                  value={
                    <span className={`px-3 py-1 rounded-full text-xs font-medium ${
                      user.isDeleted 
                        ? 'bg-error-100 text-error-700' 
                        : 'bg-success-100 text-success-700'
                    }`}>
                      {user.isDeleted ? 'Deleted' : 'Active'}
                    </span>
                  } 
                />
              </div>
            </div>
          </div>

          {/* Client-Specific Information */}
          {user.role === 'client' && (
            <div className="border-t border-secondary-200 p-8">
              <h2 className="text-xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
                <MapPin size={24} className="text-primary-600" />
                Address Information
              </h2>
              <div className="space-y-4">
                <InfoRow icon={Home} label="Shipping Address" value={user.shipping_address} />
                <InfoRow icon={CreditCard} label="Billing Address" value={user.billing_address} />
                {user.lat && user.long && (
                  <InfoRow 
                    icon={MapPin} 
                    label="Coordinates" 
                    value={`${user.lat.toFixed(6)}, ${user.long.toFixed(6)}`} 
                  />
                )}
              </div>
            </div>
          )}

          {/* Supplier-Specific Information */}
          {user.role === 'supplier' && (
            <div className="border-t border-secondary-200 p-8">
              <h2 className="text-xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
                <Truck size={24} className="text-primary-600" />
                Business Information
              </h2>
              <div className="space-y-4">
                <InfoRow icon={MapPin} label="Business Location" value={user.location} />
                <InfoRow 
                  icon={Truck} 
                  label="Delivery Radius" 
                  value={user.delivery_radius ? `${user.delivery_radius} km` : 'N/A'} 
                />
              </div>
            </div>
          )}

          {/* Notes Section (if exists) */}
          {user.notes && (
            <div className="border-t border-secondary-200 p-8 bg-secondary-50">
              <h2 className="text-xl font-bold text-secondary-900 mb-4">Notes</h2>
              <p className="text-secondary-700 whitespace-pre-wrap">{user.notes}</p>
            </div>
          )}
        </div>
      </div>
    </DashboardLayout>
  );
};

export default UserDetail;
/* FILE: src/pages/admin/UserEdit.tsx */
// src/pages/admin/UserEdit.tsx - WORKING VERSION
import { useState, useEffect, useCallback } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { 
  ArrowLeft,
  Save,
  User as UserIcon,
  Mail,
  Phone,
  Building2,
  MapPin,
  Truck,
  Home,
  Users,
  Package,
  ShoppingCart,
  Settings,
  BarChart,
  CreditCard,
  Loader2
} from 'lucide-react';
import toast from 'react-hot-toast';
import Autocomplete from 'react-google-autocomplete';

// ✅ IMPORT YOUR ACTUAL API HANDLERS
import { usersAPI, companiesAPI } from '../../api/handlers/users.api';
import DashboardLayout from '../../components/layout/DashboardLayout';

// Validation Schema
const userEditSchema = z.object({
  name: z.string().min(1, 'Name is required'),
  email: z.string().email('Invalid email address'),
  password: z.string().min(6, 'Password must be at least 6 characters').optional().or(z.literal('')),
  role: z.enum(['admin', 'client', 'supplier']),
  contact_name: z.string().optional(),
  contact_number: z.string().optional(),
  company_name: z.string().optional(),
  location: z.string().optional(),
  delivery_radius: z.number().optional(),
  shipping_address: z.string().optional(),
  billing_address: z.string().optional(),
  lat: z.number().optional(),
  long: z.number().optional(),
  notes: z.string().optional(),
});

type UserEditFormData = z.infer<typeof userEditSchema>;

const UserEdit = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const queryClient = useQueryClient();

  const [profileImage, setProfileImage] = useState<File | null>(null);
  const [currentImageUrl, setCurrentImageUrl] = useState<string | null>(null);
  const [locationCoords, setLocationCoords] = useState<{ lat: number; lng: number } | null>(null);

  const menuItems = [
    { label: 'Dashboard', path: '/admin/dashboard', icon: <Home size={20} /> },
    { label: 'Users', path: '/admin/users', icon: <Users size={20} /> },
    { label: 'Products', path: '/admin/master-products', icon: <Package size={20} /> },
    { label: 'Supplier Delivery Zones', path: '/admin/supplier-zones', icon: <MapPin size={20} /> },
    { label: 'Orders', path: '/admin/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Reports', path: '/admin/reports', icon: <BarChart size={20} /> },
    { label: 'Settings', path: '/admin/settings', icon: <Settings size={20} /> },
  ];

  const {
    register,
    handleSubmit,
    formState: { errors },
    setValue,
    watch,
    reset,
  } = useForm<UserEditFormData>({
    resolver: zodResolver(userEditSchema),
  });

  const watchedRole = watch('role');

  // ✅ FIXED: Fetch User Data using your actual API
  const { data: user, isLoading, isError, error } = useQuery({
    queryKey: ['user', id],
    queryFn: () => usersAPI.getUser(Number(id)),
    enabled: !!id,
    retry: 1, // Only retry once
  });

  // ✅ Debug: Log the response
  useEffect(() => {
    if (user) {
      console.log('✅ User data loaded:', user);
    }
    if (error) {
      console.error('❌ Error loading user:', error);
    }
  }, [user, error]);

  // ✅ FIXED: Use useEffect to populate form when user data loads
  useEffect(() => {
    if (user) {
      console.log('📥 Populating form with user data');
      
      // Reset form with user data
      reset({
        name: user.name || '',
        email: user.email || '',
        role: user.role || 'client',
        contact_name: user.contact_name || '',
        contact_number: user.contact_number || '',
        company_name: user.company?.name || '', // ✅ Get from nested company object
        location: user.location || '',
        delivery_radius: user.delivery_radius || undefined,
        shipping_address: user.shipping_address || '',
        billing_address: user.billing_address || '',
        notes: user.notes || '',
      });

      // Set location coordinates
      if (user.lat && user.long) {
        setLocationCoords({ lat: user.lat, lng: user.long });
      }

      // Set profile image URL
      if (user.profile_image) {
        const imageUrl = `${import.meta.env.VITE_IMAGE_BASE_URL}${user.profile_image}`;
        setCurrentImageUrl(imageUrl);
        console.log('🖼️ Profile image URL:', imageUrl);
      }
    }
  }, [user, reset]);

  // Fetch Companies
  const { data: companies = [] } = useQuery({
    queryKey: ['companies'],
    queryFn: companiesAPI.getAll,
  });

  // Update User Mutation
  const updateUserMutation = useMutation({
    mutationFn: (formData: FormData) => usersAPI.updateUser(Number(id), formData),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['user', id] });
      queryClient.invalidateQueries({ queryKey: ['users'] });
      toast.success('✅ User updated successfully!');
      navigate(`/admin/users/${id}`);
    },
    onError: (error: any) => {
      console.error('❌ Update error:', error);
      toast.error(error?.message || 'Failed to update user');
    },
  });

  const handleShippingAddressSelect = useCallback((place: any) => {
    if (place.formatted_address) {
      setValue('shipping_address', place.formatted_address);
    }
    if (place.geometry?.location) {
      const lat = place.geometry.location.lat();
      const lng = place.geometry.location.lng();
      setLocationCoords({ lat, lng });
      setValue('lat', lat);
      setValue('long', lng);
      toast.success(`📍 Location updated: ${lat.toFixed(4)}, ${lng.toFixed(4)}`);
    }
  }, [setValue]);

  const handleSupplierLocationSelect = useCallback((place: any) => {
    if (place.formatted_address) {
      setValue('location', place.formatted_address);
    }
  }, [setValue]);

  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      if (!file.type.startsWith('image/')) {
        toast.error('Please select an image file');
        return;
      }
      if (file.size > 2 * 1024 * 1024) {
        toast.error('Image size should be less than 2MB');
        return;
      }
      setProfileImage(file);
      const reader = new FileReader();
      reader.onloadend = () => setCurrentImageUrl(reader.result as string);
      reader.readAsDataURL(file);
    }
  };

  const onSubmit = (data: UserEditFormData) => {
    console.log('📤 Submitting form data:', data);
    
    const formData = new FormData();

    // Append all fields
    Object.entries(data).forEach(([key, value]) => {
      if (value !== undefined && value !== '' && value !== null) {
        if (typeof value === 'number') {
          formData.append(key, String(value));
        } else {
          formData.append(key, value);
        }
      }
    });

    // Append profile image if changed
    if (profileImage) {
      formData.append('profile_image', profileImage);
      console.log('🖼️ Including new profile image');
    }

    // Append coordinates for clients
    if (data.role === 'client' && locationCoords) {
      formData.append('lat', String(locationCoords.lat));
      formData.append('long', String(locationCoords.lng));
      console.log('📍 Including coordinates:', locationCoords);
    }

    updateUserMutation.mutate(formData);
  };

  // Loading State
  if (isLoading) {
    return (
      <DashboardLayout menuItems={menuItems}>
        <div className="flex items-center justify-center py-12">
          <div className="text-center">
            <Loader2 className="w-12 h-12 animate-spin text-primary-600 mx-auto mb-4" />
            <p className="text-secondary-600">Loading user data...</p>
          </div>
        </div>
      </DashboardLayout>
    );
  }

  // Error State
  if (isError || !user) {
    return (
      <DashboardLayout menuItems={menuItems}>
        <div className="text-center py-12">
          <p className="text-error-500 mb-4 text-xl">❌ Failed to load user data</p>
          <p className="text-secondary-600 mb-4">
            {error instanceof Error ? error.message : 'Unknown error occurred'}
          </p>
          <button
            onClick={() => navigate('/admin/users')}
            className="px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors inline-flex items-center gap-2"
          >
            <ArrowLeft size={20} />
            Back to Users
          </button>
        </div>
      </DashboardLayout>
    );
  }

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="max-w-4xl mx-auto space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <button
            onClick={() => navigate(`/admin/users/${id}`)}
            className="flex items-center gap-2 text-secondary-600 hover:text-primary-600 transition-colors"
          >
            <ArrowLeft size={20} />
            Back to User Details
          </button>
        </div>

        {/* Form Card */}
        <div className="bg-white rounded-2xl shadow-card p-8">
          <div className="mb-8">
            <h1 className="text-3xl font-bold text-secondary-900">Edit User</h1>
            <p className="text-secondary-600 mt-2">Update user information and settings</p>
          </div>

          <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
            {/* Profile Image */}
            <div className="space-y-2">
              <label className="block text-sm font-medium text-secondary-700">
                Profile Photo
              </label>
              <div className="flex items-center gap-6">
                <div className="relative">
                  {currentImageUrl ? (
                    <img
                      src={currentImageUrl}
                      alt="Profile"
                      className="w-24 h-24 rounded-full object-cover border-4 border-secondary-200"
                    />
                  ) : (
                    <div className="w-24 h-24 rounded-full bg-secondary-200 flex items-center justify-center">
                      <UserIcon size={40} className="text-secondary-400" />
                    </div>
                  )}
                </div>
                <div>
                  <label className="cursor-pointer inline-block px-4 py-2 bg-primary-50 text-primary-600 rounded-lg hover:bg-primary-100 transition-colors">
                    <input
                      type="file"
                      accept="image/*"
                      onChange={handleImageChange}
                      className="hidden"
                    />
                    Change Photo
                  </label>
                  <p className="text-xs text-secondary-500 mt-2">PNG, JPG, GIF up to 2MB</p>
                </div>
              </div>
            </div>

            {/* Basic Information */}
            <div className="space-y-5">
              <h3 className="text-lg font-semibold text-secondary-900 border-b pb-3">
                Basic Information
              </h3>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Full Name <span className="text-error-500">*</span>
                  </label>
                  <input
                    type="text"
                    {...register('name')}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                  />
                  {errors.name && (
                    <p className="text-sm text-error-500 mt-1">{errors.name.message}</p>
                  )}
                </div>

                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Email <span className="text-error-500">*</span>
                  </label>
                  <input
                    type="email"
                    {...register('email')}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                  />
                  {errors.email && (
                    <p className="text-sm text-error-500 mt-1">{errors.email.message}</p>
                  )}
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Role <span className="text-error-500">*</span>
                  </label>
                  <select
                    {...register('role')}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                  >
                    <option value="admin">Admin</option>
                    <option value="client">Client</option>
                    <option value="supplier">Supplier</option>
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Password (leave blank to keep current)
                  </label>
                  <input
                    type="password"
                    {...register('password')}
                    placeholder="Enter new password"
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                  />
                  {errors.password && (
                    <p className="text-sm text-error-500 mt-1">{errors.password.message}</p>
                  )}
                </div>
              </div>
            </div>

            {/* Contact Information */}
            <div className="space-y-5">
              <h3 className="text-lg font-semibold text-secondary-900 border-b pb-3">
                Contact Information
              </h3>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Contact Person
                  </label>
                  <input
                    type="text"
                    {...register('contact_name')}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Contact Number
                  </label>
                  <input
                    type="tel"
                    {...register('contact_number')}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500"
                  />
                </div>
              </div>

              <div>
                <label className="block text-sm font-medium text-secondary-700 mb-2">
                  Company Name
                </label>
                <input
                  type="text"
                  {...register('company_name')}
                  className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500"
                />
              </div>
            </div>

            {/* Client-Specific Fields */}
            {watchedRole === 'client' && (
              <div className="space-y-5 border-t pt-6">
                <h3 className="text-lg font-semibold text-secondary-900 pb-3">
                  Address Information (Client)
                </h3>

                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Shipping Address
                  </label>
                  <Autocomplete
                    apiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}
                    onPlaceSelected={handleShippingAddressSelect}
                    options={{ types: ['address'], componentRestrictions: { country: 'au' } }}
                    defaultValue={user?.shipping_address || ''}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:border-primary-500"
                    placeholder="Start typing address..."
                  />
                  {locationCoords && (
                    <p className="text-xs text-success-600 mt-2">
                      📍 Location: {locationCoords.lat.toFixed(6)}, {locationCoords.lng.toFixed(6)}
                    </p>
                  )}
                </div>

                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Billing Address
                  </label>
                  <input
                    type="text"
                    {...register('billing_address')}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500"
                  />
                </div>
              </div>
            )}

            {/* Supplier-Specific Fields */}
            {watchedRole === 'supplier' && (
              <div className="space-y-5 border-t pt-6">
                <h3 className="text-lg font-semibold text-secondary-900 pb-3">
                  Business Information (Supplier)
                </h3>

                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Business Location
                  </label>
                  <Autocomplete
                    apiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}
                    onPlaceSelected={handleSupplierLocationSelect}
                    options={{ types: ['address'], componentRestrictions: { country: 'au' } }}
                    defaultValue={user?.location || ''}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:border-primary-500"
                    placeholder="Start typing business address..."
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium text-secondary-700 mb-2">
                    Delivery Radius (km)
                  </label>
                  <input
                    type="number"
                    {...register('delivery_radius', { valueAsNumber: true })}
                    className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500"
                  />
                </div>
              </div>
            )}

            {/* Notes */}
            <div>
              <label className="block text-sm font-medium text-secondary-700 mb-2">
                Notes (Optional)
              </label>
              <textarea
                {...register('notes')}
                rows={4}
                className="w-full px-4 py-3 rounded-lg border-2 border-secondary-200 focus:outline-none focus:border-primary-500"
                placeholder="Add any additional notes..."
              />
            </div>

            {/* Action Buttons */}
            <div className="flex gap-4 pt-6 border-t border-secondary-200">
              <button
                type="submit"
                disabled={updateUserMutation.isPending}
                className="flex-1 flex items-center justify-center gap-2 px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm hover:shadow-md"
              >
                {updateUserMutation.isPending ? (
                  <>
                    <Loader2 className="w-5 h-5 animate-spin" />
                    Saving...
                  </>
                ) : (
                  <>
                    <Save size={20} />
                    Save Changes
                  </>
                )}
              </button>

              <button
                type="button"
                onClick={() => navigate(`/admin/users/${id}`)}
                className="flex-1 px-6 py-3 border-2 border-secondary-300 text-secondary-700 rounded-lg hover:bg-secondary-50 transition-colors"
              >
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </DashboardLayout>
  );
};

export default UserEdit;
/* FILE: src/pages/admin/UserManagement.tsx */
// src/pages/admin/UserManagement.tsx
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { 
  Search, 
  Eye, 
  Edit2, 
  Trash2, 
  RotateCcw,
  ChevronLeft,
  ChevronRight,
  UserPlus,
  Building2,
  Mail,
  Phone,
  MapPin,
  Home,
  Users,
  Package,
  ShoppingCart,
  Settings,
  BarChart
} from 'lucide-react';
import toast from 'react-hot-toast';

import DashboardLayout from '../../components/layout/DashboardLayout';
import Button from '../../components/common/Buttons';
import { usersAPI, companiesAPI, UserFilters } from '../../api/handlers/users.api';

// Role Badge Component
const RoleBadge = ({ role }: { role: 'admin' | 'client' | 'supplier' }) => {
  const styles = {
    admin: 'bg-error-100 text-error-700 border-error-200',
    client: 'bg-primary-100 text-primary-700 border-primary-200',
    supplier: 'bg-success-100 text-success-700 border-success-200',
  };

  const icons = {
    admin: '👑',
    client: '👤',
    supplier: '🏢',
  };

  return (
    <span className={`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium border ${styles[role]}`}>
      <span>{icons[role]}</span>
      {role.charAt(0).toUpperCase() + role.slice(1)}
    </span>
  );
};

const UserManagement = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();

  // State
  const [activeTab, setActiveTab] = useState<'active' | 'deleted'>('active');
  const [filters, setFilters] = useState<UserFilters>({
    role: '',
    company_id: '',
    page: 1,
    per_page: 10,
  });
  const [searchTerm, setSearchTerm] = useState('');
  const [debouncedSearch, setDebouncedSearch] = useState('');

  // Debounce search input
  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedSearch(searchTerm);
      setFilters(prev => ({ ...prev, page: 1 }));
    }, 500);
    return () => clearTimeout(timer);
  }, [searchTerm]);

  // Menu items for DashboardLayout
  const menuItems = [
    { label: 'Dashboard', path: '/admin/dashboard', icon: <Home size={20} /> },
    { label: 'Users', path: '/admin/users', icon: <Users size={20} /> },
    { label: 'Products', path: '/admin/master-products', icon: <Package size={20} /> },
    { label: 'Supplier Delivery Zones', path: '/admin/supplier-zones', icon: <MapPin size={20} /> },
    { label: 'Orders', path: '/admin/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Reports', path: '/admin/reports', icon: <BarChart size={20} /> },
    { label: 'Settings', path: '/admin/settings', icon: <Settings size={20} /> },
  ];

  // Fetch Companies
  const { data: companies = [] } = useQuery({
    queryKey: ['companies'],
    queryFn: companiesAPI.getAll,
  });

  // Build query params
  const queryParams: UserFilters = {
    ...filters,
    isDeleted: activeTab === 'deleted',
    contact_name: debouncedSearch || undefined,
  };

  // Fetch Users
  const { data: usersData, isLoading, error } = useQuery({
    queryKey: ['users', queryParams],
    queryFn: () => usersAPI.getUsers(queryParams),
    keepPreviousData: true,
  });

  // Delete/Restore Mutation
  const deleteRestoreMutation = useMutation({
    mutationFn: usersAPI.deleteRestoreUser,
    onSuccess: (data) => {
      queryClient.invalidateQueries(['users']);
      toast.success(data.message || 'User status updated successfully');
    },
    onError: (error: Error) => {
      toast.error(error.message || 'Failed to update user status');
    },
  });

  // Handlers
  const handleFilterChange = (key: keyof UserFilters, value: any) => {
    setFilters(prev => ({ ...prev, [key]: value, page: 1 }));
  };

  const handleTabChange = (tab: 'active' | 'deleted') => {
    setActiveTab(tab);
    setFilters(prev => ({ ...prev, page: 1 }));
  };

  // In UserManagement.tsx (line ~180)
const handleDeleteRestore = (userId: number, isDeleted: boolean) => {
  const action = isDeleted ? 'restore' : 'delete';
  if (window.confirm(`Are you sure you want to ${action} this user?`)) {
    deleteRestoreMutation.mutate(userId);
  }
};

  const clearFilters = () => {
    setFilters({
      role: '',
      company_id: '',
      page: 1,
      per_page: 10,
    });
    setSearchTerm('');
  };

  const users = usersData?.data || [];
  const pagination = {
    currentPage: usersData?.current_page || 1,
    lastPage: usersData?.last_page || 1,
    total: usersData?.total || 0,
    from: usersData?.from || 0,
    to: usersData?.to || 0,
  };

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-secondary-900">User Management</h1>
            <p className="text-secondary-600 mt-1">Manage system users and permissions</p>
          </div>
          <Button
            onClick={() => navigate('/admin/users/create')}
            variant="primary"
            fullWidth={false}
          >
            <UserPlus size={20} />
            Add User
          </Button>
        </div>

        {/* Card Container */}
        <div className="bg-white rounded-2xl shadow-card overflow-hidden">
          {/* Tabs */}
          <div className="border-b border-secondary-200">
            <div className="flex gap-1 p-1">
              <button
                onClick={() => handleTabChange('active')}
                className={`flex-1 px-4 py-3 rounded-lg font-medium transition-all ${
                  activeTab === 'active'
                    ? 'bg-primary-50 text-primary-600 shadow-sm'
                    : 'text-secondary-600 hover:bg-secondary-50'
                }`}
              >
                Active Users
                {activeTab === 'active' && pagination.total > 0 && (
                  <span className="ml-2 px-2 py-0.5 bg-primary-100 text-primary-700 rounded-full text-xs">
                    {pagination.total}
                  </span>
                )}
              </button>
              <button
                onClick={() => handleTabChange('deleted')}
                className={`flex-1 px-4 py-3 rounded-lg font-medium transition-all ${
                  activeTab === 'deleted'
                    ? 'bg-primary-50 text-primary-600 shadow-sm'
                    : 'text-secondary-600 hover:bg-secondary-50'
                }`}
              >
                Deleted Users
                {activeTab === 'deleted' && pagination.total > 0 && (
                  <span className="ml-2 px-2 py-0.5 bg-secondary-100 text-secondary-700 rounded-full text-xs">
                    {pagination.total}
                  </span>
                )}
              </button>
            </div>
          </div>

          {/* Filters */}
          <div className="border-b border-secondary-200 p-6">
            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
              {/* Search */}
              <div className="md:col-span-2">
                <div className="relative">
                  <Search 
                    className="absolute left-3 top-1/2 -translate-y-1/2 text-secondary-400" 
                    size={20} 
                  />
                  <input
                    type="text"
                    placeholder="Search by name, contact..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    className="w-full pl-10 pr-4 py-3 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                  />
                </div>
              </div>

              {/* Role Filter */}
              <select
                value={filters.role}
                onChange={(e) => handleFilterChange('role', e.target.value)}
                className="px-4 py-3 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
              >
                <option value="">All Roles</option>
                <option value="admin">Admin</option>
                <option value="client">Client</option>
                <option value="supplier">Supplier</option>
              </select>

              {/* Company Filter */}
              <select
                value={filters.company_id}
                onChange={(e) => handleFilterChange('company_id', e.target.value)}
                className="px-4 py-3 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
              >
                <option value="">All Companies</option>
                {companies.map((company: any) => (
                  <option key={company.id} value={company.id}>
                    {company.name}
                  </option>
                ))}
              </select>
            </div>

            {/* Clear Filters Button */}
            {(filters.role || filters.company_id || searchTerm) && (
              <button
                onClick={clearFilters}
                className="mt-4 text-sm text-primary-600 hover:text-primary-700 font-medium"
              >
                Clear all filters
              </button>
            )}
          </div>

          {/* Table */}
          <div className="overflow-x-auto">
            {isLoading ? (
              <div className="flex items-center justify-center py-12">
                <div className="flex flex-col items-center gap-3">
                  <div className="w-10 h-10 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin" />
                  <p className="text-secondary-500">Loading users...</p>
                </div>
              </div>
            ) : error ? (
              <div className="flex flex-col items-center justify-center py-12 text-error-500">
                <p className="mb-2">Failed to load users</p>
                <button 
                  onClick={() => queryClient.invalidateQueries(['users'])}
                  className="text-sm text-primary-600 hover:underline"
                >
                  Try again
                </button>
              </div>
            ) : users.length === 0 ? (
              <div className="flex flex-col items-center justify-center py-12 text-secondary-500">
                <p className="mb-2">No users found</p>
                {(filters.role || filters.company_id || searchTerm) && (
                  <button 
                    onClick={clearFilters}
                    className="text-sm text-primary-600 hover:underline"
                  >
                    Clear filters
                  </button>
                )}
              </div>
            ) : (
              <table className="w-full">
                <thead className="bg-secondary-50 border-b border-secondary-200">
                  <tr>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      User
                    </th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      Role
                    </th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      Company
                    </th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      Contact
                    </th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      Location
                    </th>
                    <th className="px-6 py-4 text-right text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-secondary-100">
                  {users.map((user) => (
                    <tr key={user.id} className="hover:bg-secondary-50 transition-colors">
                      {/* User Info */}
                      <td className="px-6 py-4">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0">
                            {user.profile_image ? (
                              <img
                                src={`${import.meta.env.VITE_IMAGE_BASE_URL}${user.profile_image}`}
                                alt={user.name}
                                className="w-full h-full rounded-full object-cover"
                              />
                            ) : (
                              <span className="text-primary-600 font-semibold text-sm">
                                {user.name.charAt(0).toUpperCase()}
                              </span>
                            )}
                          </div>
                          <div>
                            <p className="font-medium text-secondary-900">{user.name}</p>
                            <p className="text-sm text-secondary-500 flex items-center gap-1">
                              <Mail size={12} />
                              {user.email}
                            </p>
                          </div>
                        </div>
                      </td>

                      {/* Role */}
                      <td className="px-6 py-4">
                        <RoleBadge role={user.role} />
                      </td>

                      {/* Company */}
                      <td className="px-6 py-4">
                        {user.company ? (
                          <div className="flex items-center gap-2 text-sm text-secondary-700">
                            <Building2 size={14} className="text-secondary-400" />
                            {user.company.name}
                          </div>
                        ) : (
                          <span className="text-secondary-400 text-sm">N/A</span>
                        )}
                      </td>

                      {/* Contact */}
                      <td className="px-6 py-4">
                        <div className="text-sm">
                          <p className="text-secondary-900">{user.contact_name || 'N/A'}</p>
                          {user.contact_number && (
                            <p className="text-secondary-500 flex items-center gap-1 mt-1">
                              <Phone size={12} />
                              {user.contact_number}
                            </p>
                          )}
                        </div>
                      </td>

                      {/* Location */}
                      <td className="px-6 py-4">
                        {user.location ? (
                          <div className="flex items-center gap-1 text-sm text-secondary-700">
                            <MapPin size={14} className="text-secondary-400" />
                            <span className="truncate max-w-[150px]">{user.location}</span>
                          </div>
                        ) : (
                          <span className="text-secondary-400 text-sm">N/A</span>
                        )}
                      </td>

                      {/* Actions */}
                      <td className="px-6 py-4">
                        <div className="flex items-center justify-end gap-2">
                          <button
                            onClick={() => navigate(`/admin/users/${user.id}`)}
                            className="p-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors"
                            title="View Details"
                          >
                            <Eye size={18} />
                          </button>
                          <button
                            onClick={() => navigate(`/admin/users/${user.id}/edit`)}
                            className="p-2 text-secondary-600 hover:bg-secondary-100 rounded-lg transition-colors"
                            title="Edit User"
                          >
                            <Edit2 size={18} />
                          </button>
                          <button
                            onClick={() => handleDeleteRestore(user.id, user.isDeleted)}
                            disabled={deleteRestoreMutation.isLoading}
                            className={`p-2 rounded-lg transition-colors disabled:opacity-50 ${
                              user.isDeleted
                                ? 'text-success-600 hover:bg-success-50'
                                : 'text-error-600 hover:bg-error-50'
                            }`}
                            title={user.isDeleted ? 'Restore User' : 'Delete User'}
                          >
                            {user.isDeleted ? <RotateCcw size={18} /> : <Trash2 size={18} />}
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            )}
          </div>

          {/* Pagination */}
          {!isLoading && users.length > 0 && (
            <div className="flex items-center justify-between px-6 py-4 border-t border-secondary-200">
              <div className="flex items-center gap-2">
                <span className="text-sm text-secondary-600">
                  Showing {pagination.from} to {pagination.to} of {pagination.total} users
                </span>
              </div>

              <div className="flex items-center gap-4">
                {/* Per Page Selector */}
                <select
                  value={filters.per_page}
                  onChange={(e) => handleFilterChange('per_page', Number(e.target.value))}
                  className="px-3 py-2 border border-secondary-300 rounded-lg text-sm focus:outline-none focus:border-primary-500"
                >
                  <option value={10}>10 per page</option>
                  <option value={25}>25 per page</option>
                  <option value={50}>50 per page</option>
                  <option value={100}>100 per page</option>
                </select>

                {/* Page Navigation */}
                <div className="flex items-center gap-2">
                  <button
                    onClick={() => handleFilterChange('page', pagination.currentPage - 1)}
                    disabled={pagination.currentPage === 1}
                    className="p-2 border border-secondary-300 rounded-lg hover:bg-secondary-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    <ChevronLeft size={18} />
                  </button>
                  
                  <span className="text-sm text-secondary-700 px-3">
                    Page {pagination.currentPage} of {pagination.lastPage}
                  </span>

                  <button
                    onClick={() => handleFilterChange('page', pagination.currentPage + 1)}
                    disabled={pagination.currentPage === pagination.lastPage}
                    className="p-2 border border-secondary-300 rounded-lg hover:bg-secondary-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    <ChevronRight size={18} />
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    </DashboardLayout>
  );
};

export default UserManagement;
/* FILE: src/pages/client/Dashboard.tsx */
// src/pages/client/Dashboard.tsx
import { Home, Package, ShoppingCart, FolderOpen, Settings,FolderKanban  } from 'lucide-react';
import DashboardLayout from '../../components/layout/DashboardLayout';

const ClientDashboard = () => {
  const menuItems = [
    { label: 'Dashboard', path: '/client/dashboard', icon: <Home size={20} /> },
    { label: 'Projects', path: '/client/projects', icon: <FolderOpen size={20} /> },
    { label: 'Orders', path: '/client/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Products', path: '/client/products', icon: <Package size={20} /> },
    { label: 'Settings', path: '/client/settings', icon: <Settings size={20} /> },
  ];

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="bg-white rounded-xl shadow-card p-8">
        <h1 className="text-3xl font-bold text-secondary-900">Client Dashboard</h1>
        <p className="text-secondary-600 mt-2">Welcome to your client portal</p>
      </div>
    </DashboardLayout>
  );
};

export default ClientDashboard;
/* FILE: src/pages/client/projects/ProjectCreate.tsx */
// src/pages/client/projects/ProjectCreate.tsx
import { useNavigate } from 'react-router-dom';
import { Home, FolderOpen, ShoppingCart, Package, Settings, ArrowLeft } from 'lucide-react';
import toast from 'react-hot-toast';

import { useCreateProject } from '../../../features/projects/hooks';
import ProjectForm from '../../../features/components/ProjectForm';
import DashboardLayout from '../../../components/layout/DashboardLayout';

export default function ProjectCreate() {
  const navigate = useNavigate();
  const mut = useCreateProject();

  const menuItems = [
    { label: 'Dashboard', path: '/client/dashboard', icon: <Home size={20} /> },
    { label: 'Projects', path: '/client/projects', icon: <FolderOpen size={20} /> },
    { label: 'Orders', path: '/client/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Products', path: '/client/products', icon: <Package size={20} /> },
    { label: 'Settings', path: '/client/settings', icon: <Settings size={20} /> },
  ];

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="max-w-4xl mx-auto space-y-6">
        {/* Header with Back Button */}
        <div className="flex items-center justify-between">
          <button
            onClick={() => navigate('/client/projects')}
            className="flex items-center gap-2 text-secondary-600 hover:text-primary-600 transition-colors"
          >
            <ArrowLeft size={20} />
            Back to Projects
          </button>
        </div>

        {/* Form Card */}
        <div className="bg-white rounded-2xl shadow-card p-8">
          <div className="mb-8">
            <h1 className="text-3xl font-bold text-secondary-900">Create New Project</h1>
            <p className="text-secondary-600 mt-2">Add a new construction project</p>
          </div>

          <ProjectForm
            onSubmit={(v) => mut.mutate(v, {
              onSuccess: () => {
                toast.success('✅ Project created successfully!');
                // ✅ FIX: Navigate to projects list instead of '..'
                navigate('/client/projects');
              },
              onError: (e: any) => {
                toast.error(e?.message || 'Failed to create project');
              },
            })}
            submitting={mut.isPending}
          />
        </div>
      </div>
    </DashboardLayout>
  );
}
/* FILE: src/pages/client/projects/ProjectDetail.tsx */
// src/pages/client/projects/ProjectDetail.tsx
import { useParams, useNavigate } from 'react-router-dom';
import { 
  Home, 
  FolderOpen, 
  ShoppingCart, 
  Package, 
  Settings, 
  ArrowLeft,
  Edit2,
  Trash2,
  User,
  Phone,
  FileText,
  Calendar,
  Loader2
} from 'lucide-react';
import toast from 'react-hot-toast';

import { useProject, useDeleteProject } from '../../../features/projects/hooks';
import DashboardLayout from '../../../components/layout/DashboardLayout';
import Button from '../../../components/common/Buttons';

// Helper function to format date
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  return `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()} at ${date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}`;
};

export default function ProjectDetail() {
  const { id } = useParams();
  const navigate = useNavigate();
  const pid = Number(id);
  const { data, isLoading } = useProject(pid);
  const deleteMutation = useDeleteProject();

  const menuItems = [
    { label: 'Dashboard', path: '/client/dashboard', icon: <Home size={20} /> },
    { label: 'Projects', path: '/client/projects', icon: <FolderOpen size={20} /> },
    { label: 'Orders', path: '/client/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Products', path: '/client/products', icon: <Package size={20} /> },
    { label: 'Settings', path: '/client/settings', icon: <Settings size={20} /> },
  ];

  const handleDelete = () => {
    if (window.confirm(`Are you sure you want to delete "${data?.name}"? This action cannot be undone.`)) {
      deleteMutation.mutate(pid, {
        onSuccess: () => {
          toast.success('✅ Project deleted successfully');
          navigate('/client/projects');
        },
        onError: (error: any) => {
          toast.error(error?.message || 'Failed to delete project');
        },
      });
    }
  };

  if (isLoading) {
    return (
      <DashboardLayout menuItems={menuItems}>
        <div className="flex items-center justify-center py-12">
          <div className="text-center">
            <Loader2 className="w-12 h-12 animate-spin text-primary-600 mx-auto mb-4" />
            <p className="text-secondary-600">Loading project details...</p>
          </div>
        </div>
      </DashboardLayout>
    );
  }

  if (!data) {
    return (
      <DashboardLayout menuItems={menuItems}>
        <div className="text-center py-12">
          <p className="text-error-500 mb-4 text-xl">❌ Project not found</p>
          <button
            onClick={() => navigate('/client/projects')}
            className="px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors inline-flex items-center gap-2"
          >
            <ArrowLeft size={20} />
            Back to Projects
          </button>
        </div>
      </DashboardLayout>
    );
  }

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="max-w-5xl mx-auto space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <button
            onClick={() => navigate('/client/projects')}
            className="flex items-center gap-2 text-secondary-600 hover:text-primary-600 transition-colors"
          >
            <ArrowLeft size={20} />
            Back to Projects
          </button>

          <div className="flex gap-3">
            <Button
              onClick={() => navigate(`/client/projects/${id}/edit`)}
              variant="outline"
              fullWidth={false}
            >
              <Edit2 size={18} />
              Edit Project
            </Button>
            <Button
              onClick={handleDelete}
              variant="outline"
              fullWidth={false}
              className="text-error-600 border-error-600 hover:bg-error-50"
              disabled={deleteMutation.isLoading}
            >
              <Trash2 size={18} />
              {deleteMutation.isLoading ? 'Deleting...' : 'Delete'}
            </Button>
          </div>
        </div>

        {/* Project Card */}
        <div className="bg-white rounded-2xl shadow-card overflow-hidden">
          {/* Header Section */}
          <div className="bg-gradient-to-r from-primary-500 to-primary-600 px-8 py-12">
            <div className="flex items-center gap-6">
              <div className="w-20 h-20 rounded-full bg-white flex items-center justify-center shadow-lg">
                <FolderOpen size={40} className="text-primary-600" />
              </div>
              <div className="flex-1">
                <h1 className="text-3xl font-bold text-white mb-2">{data.name}</h1>
                <div className="flex items-center gap-4 text-white/90">
                  <span className="flex items-center gap-1">
                    <Calendar size={16} />
                    Created {formatDate(data.created_at)}
                  </span>
                </div>
              </div>
            </div>
          </div>

          {/* Details Section */}
          <div className="p-8 space-y-8">
            {/* Site Contact Information */}
            <div>
              <h2 className="text-xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
                <User size={24} className="text-primary-600" />
                Site Contact Information
              </h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="flex items-start gap-4 py-4 border-b border-secondary-100">
                  <div className="w-10 h-10 rounded-lg bg-primary-50 flex items-center justify-center flex-shrink-0">
                    <User size={20} className="text-primary-600" />
                  </div>
                  <div className="flex-1">
                    <p className="text-sm text-secondary-500 mb-1">Contact Name</p>
                    <p className="text-base font-medium text-secondary-900">
                      {data.site_contact_name || 'Not specified'}
                    </p>
                  </div>
                </div>

                <div className="flex items-start gap-4 py-4 border-b border-secondary-100">
                  <div className="w-10 h-10 rounded-lg bg-primary-50 flex items-center justify-center flex-shrink-0">
                    <Phone size={20} className="text-primary-600" />
                  </div>
                  <div className="flex-1">
                    <p className="text-sm text-secondary-500 mb-1">Contact Phone</p>
                    <p className="text-base font-medium text-secondary-900">
                      {data.site_contact_phone || 'Not specified'}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            {/* Site Instructions */}
            <div className="border-t border-secondary-200 pt-8">
              <h2 className="text-xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
                <FileText size={24} className="text-primary-600" />
                Site Instructions
              </h2>
              {data.site_instructions ? (
                <div className="bg-secondary-50 rounded-xl p-6 border border-secondary-200">
                  <p className="text-secondary-700 whitespace-pre-wrap leading-relaxed">
                    {data.site_instructions}
                  </p>
                </div>
              ) : (
                <div className="bg-secondary-50 rounded-xl p-6 border border-secondary-200 text-center">
                  <p className="text-secondary-500">No site instructions provided</p>
                </div>
              )}
            </div>

            {/* Metadata */}
            <div className="border-t border-secondary-200 pt-8">
              <h2 className="text-xl font-bold text-secondary-900 mb-6 flex items-center gap-2">
                <Calendar size={24} className="text-primary-600" />
                Project Timeline
              </h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="bg-secondary-50 rounded-xl p-4 border border-secondary-200">
                  <p className="text-sm text-secondary-500 mb-1">Created</p>
                  <p className="text-base font-medium text-secondary-900">
                    {formatDate(data.created_at)}
                  </p>
                </div>
                <div className="bg-secondary-50 rounded-xl p-4 border border-secondary-200">
                  <p className="text-sm text-secondary-500 mb-1">Last Updated</p>
                  <p className="text-base font-medium text-secondary-900">
                    {formatDate(data.updated_at)}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Future: Orders Section */}
        <div className="bg-white rounded-2xl shadow-card p-8">
          <h2 className="text-xl font-bold text-secondary-900 mb-4">Project Orders</h2>
          <div className="text-center py-8 bg-secondary-50 rounded-xl border-2 border-dashed border-secondary-200">
            <ShoppingCart size={48} className="text-secondary-400 mx-auto mb-3" />
            <p className="text-secondary-600">No orders yet for this project</p>
            <Button
              onClick={() => toast.info('Order creation coming soon!')}
              variant="outline"
              fullWidth={false}
              className="mt-4"
            >
              Create Order
            </Button>
          </div>
        </div>
      </div>
    </DashboardLayout>
  );
}
/* FILE: src/pages/client/projects/ProjectEdit.tsx */
// src/pages/client/projects/ProjectEdit.tsx
import { useNavigate, useParams } from 'react-router-dom';
import { Home, FolderOpen, ShoppingCart, Package, Settings, ArrowLeft, Loader2 } from 'lucide-react';
import toast from 'react-hot-toast';

import { useProject, useUpdateProject } from '../../../features/projects/hooks';
import ProjectForm from '../../../features/components/ProjectForm';
import DashboardLayout from '../../../components/layout/DashboardLayout';

export default function ProjectEdit() {
  const { id } = useParams();
  const pid = Number(id);
  const { data, isLoading } = useProject(pid);
  const navigate = useNavigate();
  const mut = useUpdateProject(pid);

  const menuItems = [
    { label: 'Dashboard', path: '/client/dashboard', icon: <Home size={20} /> },
    { label: 'Projects', path: '/client/projects', icon: <FolderOpen size={20} /> },
    { label: 'Orders', path: '/client/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Products', path: '/client/products', icon: <Package size={20} /> },
    { label: 'Settings', path: '/client/settings', icon: <Settings size={20} /> },
  ];

  if (isLoading) {
    return (
      <DashboardLayout menuItems={menuItems}>
        <div className="flex items-center justify-center py-12">
          <div className="text-center">
            <Loader2 className="w-12 h-12 animate-spin text-primary-600 mx-auto mb-4" />
            <p className="text-secondary-600">Loading project details...</p>
          </div>
        </div>
      </DashboardLayout>
    );
  }

  if (!data) {
    return (
      <DashboardLayout menuItems={menuItems}>
        <div className="text-center py-12">
          <p className="text-error-500 mb-4 text-xl">❌ Project not found</p>
          <button
            onClick={() => navigate('/client/projects')}
            className="px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors inline-flex items-center gap-2"
          >
            <ArrowLeft size={20} />
            Back to Projects
          </button>
        </div>
      </DashboardLayout>
    );
  }

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="max-w-4xl mx-auto space-y-6">
        {/* Header with Back Button */}
        <div className="flex items-center justify-between">
          <button
            onClick={() => navigate(`/client/projects/`)}
            className="flex items-center gap-2 text-secondary-600 hover:text-primary-600 transition-colors"
          >
            <ArrowLeft size={20} />
            Back to Project Details
          </button>
        </div>

        {/* Form Card */}
        <div className="bg-white rounded-2xl shadow-card p-8">
          <div className="mb-8">
            <h1 className="text-3xl font-bold text-secondary-900">Edit Project</h1>
            <p className="text-secondary-600 mt-2">Update project information</p>
          </div>

          <ProjectForm
            initial={{
              name: data.name,
              site_contact_name: data.site_contact_name || undefined,
              site_contact_phone: data.site_contact_phone || undefined,
              site_instructions: data.site_instructions || undefined
            }}
            onSubmit={(v) => mut.mutate(v, {
              onSuccess: () => {
                toast.success('✅ Project updated successfully!');
                // ✅ Navigate back to detail view
                navigate(`/client/projects/${id}`);
              },
              onError: (e: any) => {
                toast.error(e?.message || 'Failed to update project');
              },
            })}
            submitting={mut.isPending}
          />
        </div>
      </div>
    </DashboardLayout>
  );
}
/* FILE: src/pages/client/projects/ProjectsList.tsx */
// src/pages/client/projects/ProjectsList.tsx
import { useState, useEffect } from 'react';
import { useNavigate, useSearchParams } from 'react-router-dom';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { 
  Search, 
  Eye, 
  Edit2, 
  Trash2,
  ChevronLeft,
  ChevronRight,
  Plus,
  Calendar,
  User,
  Phone,
  Filter,
  X,
  Loader2,
  Home,
  FolderOpen,
  ShoppingCart,
  Package,
  Settings
} from 'lucide-react';
import toast from 'react-hot-toast';

import DashboardLayout from '../../../components/layout/DashboardLayout';
import Button from '../../../components/common/Buttons';
import { projectsAPI } from '../../../api/handlers/projects.api';

// Helper function to format date
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  return `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
};

const ProjectsList = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();
  const [searchParams, setSearchParams] = useSearchParams();

  // Menu items
  const menuItems = [
    { label: 'Dashboard', path: '/client/dashboard', icon: <Home size={20} /> },
    { label: 'Projects', path: '/client/projects', icon: <FolderOpen size={20} /> },
    { label: 'Orders', path: '/client/orders', icon: <ShoppingCart size={20} /> },
    { label: 'Products', path: '/client/products', icon: <Package size={20} /> },
    { label: 'Settings', path: '/client/settings', icon: <Settings size={20} /> },
  ];

  // State
  const [showFilters, setShowFilters] = useState(false);
  const [localSearch, setLocalSearch] = useState(searchParams.get('search') || '');
  
  // Filters from URL
  const page = Number(searchParams.get('page')) || 1;
  const per_page = Number(searchParams.get('per_page')) || 10;
  const search = searchParams.get('search') || '';
  const sort = searchParams.get('sort') || 'created_at';
  const dir = searchParams.get('dir') || 'desc';
  const date_from = searchParams.get('date_from') || '';
  const date_to = searchParams.get('date_to') || '';

  // Debounce search
  useEffect(() => {
    const timer = setTimeout(() => {
      if (localSearch !== search) {
        updateParams({ search: localSearch, page: '1' });
      }
    }, 500);
    return () => clearTimeout(timer);
  }, [localSearch]);

  // Fetch projects
  const { data, isLoading, error } = useQuery({
    queryKey: ['projects', { page, per_page, search, sort, dir, date_from, date_to }],
    queryFn: () => projectsAPI.list({ page, per_page, search, sort, dir, date_from, date_to }),
    keepPreviousData: true,
  });

  // Delete mutation
  const deleteMutation = useMutation({
    mutationFn: projectsAPI.remove,
    onSuccess: () => {
      queryClient.invalidateQueries(['projects']);
      toast.success('✅ Project deleted successfully');
    },
    onError: (error: any) => {
      toast.error(error.message || 'Failed to delete project');
    },
  });

  // Helper to update URL params
  const updateParams = (newParams: Record<string, string>) => {
    const current = Object.fromEntries(searchParams);
    const updated = { ...current, ...newParams };
    
    // Remove empty params
    Object.keys(updated).forEach(key => {
      if (!updated[key]) delete updated[key];
    });
    
    setSearchParams(updated);
  };

  // Clear all filters
  const clearFilters = () => {
    setLocalSearch('');
    setSearchParams({ page: '1', per_page: String(per_page) });
  };

  // Handle delete
  const handleDelete = (id: number, name: string) => {
    if (window.confirm(`Are you sure you want to delete "${name}"?`)) {
      deleteMutation.mutate(id);
    }
  };

  const projects = data?.data || [];
  console.log('Projects data:', data);
  const pagination = {
    currentPage: data?.page || 1,
    lastPage: Math.ceil((data?.total || 0) / per_page),
    total: data?.total || 0,
    from: ((page - 1) * per_page) + 1,
    to: Math.min(page * per_page, data?.total || 0),
  };

  const hasActiveFilters = search || date_from || date_to || sort !== 'created_at' || dir !== 'desc';

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-secondary-900">Projects</h1>
            <p className="text-secondary-600 mt-1">Manage your construction projects</p>
          </div>
          <Button
            onClick={() => navigate('/client/projects/create')}
            variant="primary"
            fullWidth={false}
          >
            <Plus size={20} />
            New Project
          </Button>
        </div>

        {/* Main Card */}
        <div className="bg-white rounded-2xl shadow-card overflow-hidden">
          {/* Filters Bar */}
          <div className="border-b border-secondary-200 p-6">
            <div className="flex items-center gap-4 mb-4">
              {/* Search */}
              <div className="flex-1 relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-secondary-400" size={20} />
                <input
                  type="text"
                  placeholder="Search projects..."
                  value={localSearch}
                  onChange={(e) => setLocalSearch(e.target.value)}
                  className="w-full pl-10 pr-4 py-3 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500 focus:ring-2 focus:ring-primary-500 focus:ring-opacity-20"
                />
              </div>

              {/* Sort */}
              <select
                value={`${sort}-${dir}`}
                onChange={(e) => {
                  const [newSort, newDir] = e.target.value.split('-');
                  updateParams({ sort: newSort, dir: newDir, page: '1' });
                }}
                className="px-4 py-3 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500"
              >
                <option value="created_at-desc">Newest First</option>
                <option value="created_at-asc">Oldest First</option>
                <option value="name-asc">Name (A-Z)</option>
                <option value="name-desc">Name (Z-A)</option>
              </select>

              {/* Filter Toggle */}
              <button
                onClick={() => setShowFilters(!showFilters)}
                className={`px-4 py-3 rounded-lg border-2 flex items-center gap-2 transition-all ${
                  showFilters || hasActiveFilters
                    ? 'bg-primary-50 border-primary-500 text-primary-600'
                    : 'border-secondary-200 text-secondary-600 hover:bg-secondary-50'
                }`}
              >
                <Filter size={20} />
                Filters
                {hasActiveFilters && (
                  <span className="w-2 h-2 bg-primary-500 rounded-full"></span>
                )}
              </button>
            </div>

            {/* Expandable Filters */}
            {showFilters && (
              <div className="pt-4 border-t border-secondary-200 space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {/* Date From */}
                  <div>
                    <label className="block text-sm font-medium text-secondary-700 mb-2">
                      From Date
                    </label>
                    <input
                      type="date"
                      value={date_from}
                      onChange={(e) => updateParams({ date_from: e.target.value, page: '1' })}
                      className="w-full px-4 py-2 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500"
                    />
                  </div>

                  {/* Date To */}
                  <div>
                    <label className="block text-sm font-medium text-secondary-700 mb-2">
                      To Date
                    </label>
                    <input
                      type="date"
                      value={date_to}
                      onChange={(e) => updateParams({ date_to: e.target.value, page: '1' })}
                      className="w-full px-4 py-2 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500"
                    />
                  </div>
                </div>

                {/* Clear Filters */}
                {hasActiveFilters && (
                  <button
                    onClick={clearFilters}
                    className="text-sm text-primary-600 hover:text-primary-700 font-medium flex items-center gap-1"
                  >
                    <X size={16} />
                    Clear all filters
                  </button>
                )}
              </div>
            )}
          </div>

          {/* Table */}
          <div className="overflow-x-auto">
            {isLoading ? (
              <div className="flex items-center justify-center py-12">
                <div className="flex flex-col items-center gap-3">
                  <Loader2 className="w-10 h-10 animate-spin text-primary-600" />
                  <p className="text-secondary-500">Loading projects...</p>
                </div>
              </div>
            ) : error ? (
              <div className="flex flex-col items-center justify-center py-12 text-error-500">
                <p className="mb-2">Failed to load projects</p>
                <button 
                  onClick={() => queryClient.invalidateQueries(['projects'])}
                  className="text-sm text-primary-600 hover:underline"
                >
                  Try again
                </button>
              </div>
            ) : projects.length === 0 ? (
              <div className="flex flex-col items-center justify-center py-12 text-secondary-500">
                <p className="mb-2">No projects found</p>
                {hasActiveFilters ? (
                  <button 
                    onClick={clearFilters}
                    className="text-sm text-primary-600 hover:underline"
                  >
                    Clear filters
                  </button>
                ) : (
                  <Button
                    onClick={() => navigate('/client/projects/create')}
                    variant="outline"
                    fullWidth={false}
                    className="mt-4"
                  >
                    <Plus size={18} />
                    Create Your First Project
                  </Button>
                )}
              </div>
            ) : (
              <table className="w-full">
                <thead className="bg-secondary-50 border-b border-secondary-200">
                  <tr>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      Project Name
                    </th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      Site Contact
                    </th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      Created
                    </th>
                    <th className="px-6 py-4 text-right text-xs font-semibold text-secondary-600 uppercase tracking-wider">
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-secondary-100">
                  {projects.map((project: any) => (
                    <tr key={project.id} className="hover:bg-secondary-50 transition-colors">
                      {/* Project Name */}
                      <td className="px-6 py-4">
                        <div>
                          <p className="font-medium text-secondary-900">{project.name}</p>
                          {project.site_instructions && (
                            <p className="text-sm text-secondary-500 mt-1 line-clamp-1">
                              {project.site_instructions}
                            </p>
                          )}
                        </div>
                      </td>

                      {/* Site Contact */}
                      <td className="px-6 py-4">
                        {project.site_contact_name || project.site_contact_phone ? (
                          <div className="text-sm">
                            {project.site_contact_name && (
                              <p className="text-secondary-900 flex items-center gap-1">
                                <User size={14} className="text-secondary-400" />
                                {project.site_contact_name}
                              </p>
                            )}
                            {project.site_contact_phone && (
                              <p className="text-secondary-500 flex items-center gap-1 mt-1">
                                <Phone size={14} className="text-secondary-400" />
                                {project.site_contact_phone}
                              </p>
                            )}
                          </div>
                        ) : (
                          <span className="text-secondary-400 text-sm">No contact</span>
                        )}
                      </td>

                      {/* Created Date */}
                      <td className="px-6 py-4">
                        <div className="flex items-center gap-1 text-sm text-secondary-700">
                          <Calendar size={14} className="text-secondary-400" />
                          {formatDate(project.created_at)}
                        </div>
                      </td>

                      {/* Actions */}
                      <td className="px-6 py-4">
                        <div className="flex items-center justify-end gap-2">
                          <button
                            onClick={() => navigate(`/client/projects/${project.id}`)}
                            className="p-2 text-primary-600 hover:bg-primary-50 rounded-lg transition-colors"
                            title="View Details"
                          >
                            <Eye size={18} />
                          </button>
                          <button
                            onClick={() => navigate(`/client/projects/${project.id}/edit`)}
                            className="p-2 text-secondary-600 hover:bg-secondary-100 rounded-lg transition-colors"
                            title="Edit Project"
                          >
                            <Edit2 size={18} />
                          </button>
                          <button
                            onClick={() => handleDelete(project.id, project.name)}
                            disabled={deleteMutation.isLoading}
                            className="p-2 text-error-600 hover:bg-error-50 rounded-lg transition-colors disabled:opacity-50"
                            title="Delete Project"
                          >
                            <Trash2 size={18} />
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            )}
          </div>

          {/* Pagination */}
          {!isLoading && projects.length > 0 && (
            <div className="flex items-center justify-between px-6 py-4 border-t border-secondary-200">
              <div className="flex items-center gap-2">
                <span className="text-sm text-secondary-600">
                  Showing {pagination.from} to {pagination.to} of {pagination.total} projects
                </span>
              </div>

              <div className="flex items-center gap-4">
                {/* Per Page */}
                <select
                  value={per_page}
                  onChange={(e) => updateParams({ per_page: e.target.value, page: '1' })}
                  className="px-3 py-2 border border-secondary-300 rounded-lg text-sm focus:outline-none focus:border-primary-500"
                >
                  <option value={10}>10 per page</option>
                  <option value={25}>25 per page</option>
                  <option value={50}>50 per page</option>
                  <option value={100}>100 per page</option>
                </select>

                {/* Page Navigation */}
                <div className="flex items-center gap-2">
                  <button
                    onClick={() => updateParams({ page: String(page - 1) })}
                    disabled={page === 1}
                    className="p-2 border border-secondary-300 rounded-lg hover:bg-secondary-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    <ChevronLeft size={18} />
                  </button>
                  
                  <span className="text-sm text-secondary-700 px-3">
                    Page {pagination.currentPage} of {pagination.lastPage}
                  </span>

                  <button
                    onClick={() => updateParams({ page: String(page + 1) })}
                    disabled={page === pagination.lastPage}
                    className="p-2 border border-secondary-300 rounded-lg hover:bg-secondary-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    <ChevronRight size={18} />
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    </DashboardLayout>
  );
};

export default ProjectsList;
/* FILE: src/pages/public/Login.tsx */
// src/pages/public/Login.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useNavigate, Link } from 'react-router-dom';
import { useMutation } from '@tanstack/react-query';
import { Mail, Lock, ArrowRight } from 'lucide-react';
import toast from 'react-hot-toast';

import { authAPI } from '../../api/handlers/auth.api';
import { useAuthStore } from '../../store/authStore';
import { loginSchema, LoginFormData } from '../../utils/validators';
import Input from '../../components/common/Input';
import Button from '../../components/common/Buttons'; // Changed from Buttons

const Login = () => {
  const navigate = useNavigate();
  const { login } = useAuthStore();

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<LoginFormData>({
    resolver: zodResolver(loginSchema),
  });

  const loginMutation = useMutation({
  mutationFn: authAPI.login,
  retry: false,
  onSuccess: (data: any) => {
    login(data.user, data.token);
    toast.success(`Welcome back, ${data.user.name}!`);
    const map: Record<string,string> = {
      admin: '/admin/dashboard',
      client: '/client/dashboard',
      supplier: '/supplier/dashboard',
    };
    navigate(map[data.user.role] || '/login');
  },
  onError: (error: any) => {
    toast.error(error?.message || 'Invalid credentials');
  },
});

  const onSubmit = (data: LoginFormData) => {
    loginMutation.mutate(data);
  };

  return (
    <div className="min-h-screen flex">
      {/* Left Side - Branding */}
      <div className="hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary-500 via-primary-600 to-primary-700 p-12 flex-col justify-between relative overflow-hidden">
        {/* Decorative circles */}
        <div className="absolute top-20 left-20 w-72 h-72 bg-white/10 rounded-full blur-3xl"></div>
        <div className="absolute bottom-20 right-20 w-96 h-96 bg-white/10 rounded-full blur-3xl"></div>
        
        <div className="relative z-10">
          <img
            src="https://demowebportals.com/material_connect/public/assets/img/logo-text.png"
            alt="Material Connect"
            className="h-10 mb-8 brightness-0 invert"
          />
          <h1 className="text-5xl font-bold text-white mb-6 leading-tight">
            Welcome to<br />Material Connect
          </h1>
          <p className="text-xl text-white/90 leading-relaxed">
            Streamline your construction material procurement with intelligent supplier matching and automated ordering.
          </p>
        </div>

        <div className="relative z-10 space-y-6">
          <div className="flex items-start gap-4">
            <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0">
              <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
              </svg>
            </div>
            <div>
              <h3 className="text-white font-semibold text-lg">Smart Supplier Matching</h3>
              <p className="text-white/80">AI-powered location-based supplier selection</p>
            </div>
          </div>
          <div className="flex items-start gap-4">
            <div className="w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0">
              <svg className="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
            </div>
            <div>
              <h3 className="text-white font-semibold text-lg">Real-time Tracking</h3>
              <p className="text-white/80">Monitor orders from placement to delivery</p>
            </div>
          </div>
        </div>
      </div>

      {/* Right Side - Login Form */}
      <div className="flex-1 flex items-center justify-center p-8 bg-secondary-50">
        <div className="w-full max-w-md">
          {/* Mobile Logo */}
          <div className="lg:hidden text-center mb-8">
            <img
              src="https://demowebportals.com/material_connect/public/assets/img/logo-text.png"
              alt="Material Connect"
              className="h-10 mx-auto mb-4"
            />
          </div>

          <div className="bg-white rounded-2xl shadow-xl p-8 border border-secondary-100">
            <div className="mb-8">
              <h2 className="text-3xl font-bold text-secondary-900 mb-2">Sign In</h2>
              <p className="text-secondary-600">Access your Material Connect account</p>
            </div>

            <form onSubmit={handleSubmit(onSubmit)} className="space-y-5">
              <Input
                label="Email Address"
                type="email"
                placeholder="you@company.com"
                icon={Mail}
                register={register('email')}
                error={errors.email?.message}
                required
              />

              <Input
                label="Password"
                type="password"
                placeholder="Enter your password"
                icon={Lock}
                register={register('password')}
                error={errors.password?.message}
                required
              />

              <div className="flex items-center justify-between text-sm">
                <label className="flex items-center gap-2 cursor-pointer">
                  <input type="checkbox" className="w-4 h-4 text-primary-500 rounded border-secondary-300 focus:ring-primary-500" />
                  <span className="text-secondary-600">Remember me</span>
                </label>
                <a href="#" className="text-primary-600 hover:text-primary-700 font-medium">
                  Forgot password?
                </a>
              </div>

              <Button
                type="submit"
                isLoading={loginMutation.isPending}
                disabled={loginMutation.isPending}
              >
                {loginMutation.isPending ? 'Signing in...' : (
                  <>
                    Sign In
                    <ArrowRight size={20} />
                  </>
                )}
              </Button>
            </form>

            <div className="mt-8 pt-6 border-t border-secondary-200">
              <p className="text-center text-sm text-secondary-600 mb-4">
                New to Material Connect?
              </p>
              <div className="grid grid-cols-2 gap-3">
                <Link
                  to="/register/client"
                  className="px-4 py-3 text-sm font-medium text-center text-primary-600 bg-primary-50 rounded-lg hover:bg-primary-100 transition-all hover:scale-105"
                >
                  Register as Client
                </Link>
                <Link
                  to="/register/supplier"
                  className="px-4 py-3 text-sm font-medium text-center text-primary-600 bg-primary-50 rounded-lg hover:bg-primary-100 transition-all hover:scale-105"
                >
                  Register as Supplier
                </Link>
              </div>
            </div>
          </div>

          <p className="text-center text-xs text-secondary-500 mt-6">
            By signing in, you agree to our{' '}
            <a href="#" className="text-primary-600 hover:underline">Terms of Service</a>
            {' '}and{' '}
            <a href="#" className="text-primary-600 hover:underline">Privacy Policy</a>
          </p>
        </div>
      </div>
    </div>
  );
};

export default Login;
/* FILE: src/pages/public/RegisterClient.tsx */
// src/pages/public/RegisterClient.tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useNavigate, Link } from 'react-router-dom';
import { useMutation } from '@tanstack/react-query';
import { 
  Mail, 
  Lock, 
  User, 
  Phone, 
  Building2, 
  UserPlus,
  ArrowLeft,
  Upload,
  X,
  Check,
  MapPin,
  CreditCard
} from 'lucide-react';
import toast from 'react-hot-toast';
import Autocomplete from 'react-google-autocomplete';

import { authAPI } from '../../api/handlers/auth.api';
import { useAuthStore } from '../../store/authStore';
import { clientRegistrationSchema, ClientRegistrationFormData } from '../../utils/validators';
import Input from '../../components/common/Input';
import Button from '../../components/common/Buttons';
import { useState } from 'react';

const RegisterClient = () => {
  const navigate = useNavigate();
  const { login } = useAuthStore();
  const [profileImage, setProfileImage] = useState<File | null>(null);
  const [preview, setPreview] = useState<string | null>(null);
  const [currentStep, setCurrentStep] = useState(1);

  const {
    register,
    handleSubmit,
    formState: { errors },
    setError,
    setValue,
    trigger,
  } = useForm<ClientRegistrationFormData>({
    resolver: zodResolver(clientRegistrationSchema),
  });

  const registerMutation = useMutation({
    mutationFn: authAPI.registerClient,
    onSuccess: (data: any) => {
      login(data.user, data.token);
      toast.success('🎉 Registration successful! Welcome to Material Connect');
      navigate('/client/dashboard');
    },
    onError: (error: any) => {
      if (error.errors && typeof error.errors === 'object') {
        Object.keys(error.errors).forEach((field) => {
          const messages = error.errors[field];
          const message = Array.isArray(messages) ? messages[0] : messages;
          setError(field as any, { type: 'manual', message });
        });
        toast.error('Please fix the errors in the form');
      } else {
        toast.error(error.message || 'Registration failed');
      }
    },
  });

  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      if (!file.type.startsWith('image/')) {
        toast.error('Please select an image file');
        return;
      }
      if (file.size > 2 * 1024 * 1024) {
        toast.error('Image size should be less than 2MB');
        return;
      }
      setProfileImage(file);
      const reader = new FileReader();
      reader.onloadend = () => setPreview(reader.result as string);
      reader.readAsDataURL(file);
    }
  };

  const clearImage = () => {
    setProfileImage(null);
    setPreview(null);
  };

  const nextStep = async () => {
    const fields = steps[currentStep - 1].fields as Array<keyof ClientRegistrationFormData>;
    const isValid = await trigger(fields);
    if (isValid) {
      setCurrentStep(currentStep + 1);
    }
  };

  const onSubmit = (data: ClientRegistrationFormData) => {
  const submitData = {
    ...data,
    profile_image: profileImage || undefined,
  };
  
  console.log('📤 Submitting client data:', submitData);
  registerMutation.mutate(submitData);
};

  const steps = [
    { number: 1, title: 'Personal Info', fields: ['name', 'email', 'password'] },
    { number: 2, title: 'Contact Details', fields: ['contact_name', 'contact_number', 'company_name'] },
    { number: 3, title: 'Addresses', fields: ['shipping_address', 'billing_address'] },
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-secondary-50 to-primary-50/30 py-12 px-4">
      <div className="max-w-4xl mx-auto">
        {/* Header */}
        <div className="text-center mb-8">
          <Link
            to="/login"
            className="inline-flex items-center gap-2 text-secondary-600 hover:text-primary-600 mb-6 transition-colors"
          >
            <ArrowLeft size={20} />
            Back to Login
          </Link>
          <img
            src="https://demowebportals.com/material_connect/public/assets/img/logo-text.png"
            alt="Material Connect"
            className="h-12 mx-auto mb-4"
          />
          <h1 className="text-4xl font-bold text-secondary-900 mb-2">Create Client Account</h1>
          <p className="text-lg text-secondary-600">Join Material Connect to manage your construction projects</p>
        </div>

        {/* Progress Steps */}
        <div className="mb-8">
          <div className="flex items-center justify-center gap-4">
            {steps.map((step, index) => (
              <div key={step.number} className="flex items-center">
                <div className="flex flex-col items-center">
                  <div className={`
                    w-12 h-12 rounded-full flex items-center justify-center font-semibold transition-all
                    ${currentStep >= step.number 
                      ? 'bg-primary-500 text-white shadow-lg shadow-primary-500/50' 
                      : 'bg-white text-secondary-400 border-2 border-secondary-200'
                    }
                  `}>
                    {currentStep > step.number ? <Check size={20} /> : step.number}
                  </div>
                  <span className={`text-sm mt-2 font-medium ${currentStep >= step.number ? 'text-primary-600' : 'text-secondary-400'}`}>
                    {step.title}
                  </span>
                </div>
                {index < steps.length - 1 && (
                  <div className={`w-16 h-1 mx-4 rounded-full ${currentStep > step.number ? 'bg-primary-500' : 'bg-secondary-200'}`} />
                )}
              </div>
            ))}
          </div>
        </div>

        {/* Form Card */}
        <div className="bg-white rounded-3xl shadow-2xl p-8 border border-secondary-100">
          <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
            <input type="hidden" {...register('lat', { valueAsNumber: true })} />
  <input type="hidden" {...register('long', { valueAsNumber: true })} />
            {/* Profile Image Upload */}
            {currentStep === 1 && (
              <div className="flex justify-center">
                <div className="relative">
                  {preview ? (
                    <div className="relative">
                      <img 
                        src={preview} 
                        alt="Preview" 
                        className="w-32 h-32 rounded-full object-cover border-4 border-primary-100 shadow-xl"
                      />
                      <button
                        type="button"
                        onClick={clearImage}
                        className="absolute -top-2 -right-2 p-2 bg-error-500 text-white rounded-full hover:bg-error-600 transition-colors shadow-lg"
                      >
                        <X size={16} />
                      </button>
                    </div>
                  ) : (
                    <label className="cursor-pointer group">
                      <input
                        type="file"
                        accept="image/*"
                        onChange={handleImageChange}
                        className="hidden"
                      />
                      <div className="w-32 h-32 rounded-full border-4 border-dashed border-secondary-300 bg-secondary-50 flex flex-col items-center justify-center hover:border-primary-500 hover:bg-primary-50 transition-all group-hover:scale-105">
                        <Upload size={32} className="text-secondary-400 group-hover:text-primary-500 mb-2" />
                        <span className="text-xs text-secondary-500 group-hover:text-primary-600 font-medium">Upload Photo</span>
                      </div>
                    </label>
                  )}
                </div>
              </div>
            )}

            {/* Step 1: Personal Information */}
            {currentStep === 1 && (
              <div className="space-y-5">
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
                    <User size={20} className="text-primary-600" />
                  </div>
                  <h3 className="text-xl font-bold text-secondary-900">Personal Information</h3>
                </div>

                <Input
                  label="Full Name"
                  type="text"
                  placeholder="John Doe"
                  icon={User}
                  register={register('name')}
                  error={errors.name?.message}
                  required
                />

                <Input
                  label="Email Address"
                  type="email"
                  placeholder="john@company.com"
                  icon={Mail}
                  register={register('email')}
                  error={errors.email?.message}
                  required
                />

                <Input
                  label="Password"
                  type="password"
                  placeholder="Minimum 6 characters"
                  icon={Lock}
                  register={register('password')}
                  error={errors.password?.message}
                  required
                />
              </div>
            )}

            {/* Step 2: Contact Information */}
            {currentStep === 2 && (
              <div className="space-y-5">
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
                    <Phone size={20} className="text-primary-600" />
                  </div>
                  <h3 className="text-xl font-bold text-secondary-900">Contact Information</h3>
                </div>

                <Input
                  label="Contact Person Name"
                  type="text"
                  placeholder="Jane Smith"
                  icon={User}
                  register={register('contact_name')}
                  error={errors.contact_name?.message}
                  required
                />

                <Input
                  label="Contact Number"
                  type="tel"
                  placeholder="+92 300 1234567"
                  icon={Phone}
                  register={register('contact_number')}
                  error={errors.contact_number?.message}
                  required
                />

                <Input
                  label="Company Name (Optional)"
                  type="text"
                  placeholder="ABC Construction Ltd."
                  icon={Building2}
                  register={register('company_name')}
                  error={errors.company_name?.message}
                />
              </div>
            )}

            {/* Step 3: Address Information with Google Autocomplete */}
            {currentStep === 3 && (
              <div className="space-y-5">
                <div className="flex items-center gap-3 mb-6">
                  <div className="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
                    <MapPin size={20} className="text-primary-600" />
                  </div>
                  <h3 className="text-xl font-bold text-secondary-900">Address Information</h3>
                </div>

                {/* Shipping Address + coords */}
                <div className="space-y-2">
                  <label className="block text-sm font-medium text-secondary-700">
                    Shipping Address <span className="text-error-500">*</span>
                  </label>
                  <div className="relative">
                    <MapPin className="absolute left-3 top-3.5 text-secondary-400 z-10" size={20} />
                    <Autocomplete
                      apiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}
                      onPlaceSelected={(place: any) => {
                        if (place.formatted_address) {
                          setValue('shipping_address', place.formatted_address);
                          trigger('shipping_address');
                        }
                        if (place.geometry?.location) {
                          const lat = place.geometry.location.lat();
                          const lng = place.geometry.location.lng();
                          setValue('lat', lat);
                          setValue('long', lng);
                          trigger(['lat', 'long']);
                        }
                      }}
                      options={{ types: ['address'], componentRestrictions: { country: 'pk' } }}
                      className={`
                        w-full pl-10 pr-4 py-3 rounded-lg border-2 transition-all
                        ${errors.shipping_address
                          ? 'border-error-500 focus:border-error-500 focus:ring-error-500'
                          : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'}
                        focus:outline-none focus:ring-2 focus:ring-opacity-20
                      `}
                      placeholder="Start typing your address..."
                      {...register('shipping_address')}
                    />
                  </div>
                  {errors.shipping_address && (
                    <p className="text-sm text-error-500">{errors.shipping_address.message}</p>
                  )}
                </div>

                {/* Billing Address input (plain text or use another Autocomplete if you prefer) */}
                <div className="space-y-2">
                  <label className="block text-sm font-medium text-secondary-700">
                    Billing Address <span className="text-error-500">*</span>
                  </label>
                  <Input
                    label=""            // hidden label, we already show above
                    type="text"
                    placeholder="Same as shipping or enter a different address"
                    icon={CreditCard}
                    register={register('billing_address')}
                    error={errors.billing_address?.message}
                    required
                  />
                </div>
              </div>
            )}

            {/* Navigation Buttons */}
            <div className="flex gap-4 pt-6 border-t border-secondary-200">
              {currentStep > 1 && (
                <Button
                  type="button"
                  variant="outline"
                  onClick={() => setCurrentStep(currentStep - 1)}
                  fullWidth={false}
                  className="flex-1"
                >
                  <ArrowLeft size={20} />
                  Previous
                </Button>
              )}
              
              {currentStep < 3 ? (
                <Button
                  type="button"
                  onClick={nextStep}
                  fullWidth={currentStep === 1}
                  className={currentStep > 1 ? 'flex-1' : ''}
                >
                  Continue
                  <Check size={20} />
                </Button>
              ) : (
                <Button
                  type="submit"
                  isLoading={registerMutation.isPending}
                  disabled={registerMutation.isPending}
                  className="flex-1"
                >
                  <UserPlus size={20} />
                  {registerMutation.isPending ? 'Creating Account...' : 'Create Account'}
                </Button>
              )}
            </div>

            {/* Login Link */}
            <p className="text-center text-sm text-secondary-600 pt-4">
              Already have an account?{' '}
              <Link to="/login" className="text-primary-600 hover:text-primary-700 font-semibold">
                Sign In
              </Link>
            </p>
          </form>
        </div>
      </div>
    </div>
  );
};

export default RegisterClient;
/* FILE: src/pages/public/RegisterSupplier.tsx */
// src/pages/public/RegisterSupplier.tsx
import { useForm, Controller } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useNavigate, Link } from 'react-router-dom';
import { useMutation } from '@tanstack/react-query';
import { 
  Mail, 
  Lock, 
  User, 
  Phone, 
  Building2, 
  MapPin, 
  Truck,
  UserPlus,
  ArrowLeft
} from 'lucide-react';
import toast from 'react-hot-toast';
import Autocomplete from 'react-google-autocomplete';
import { useState, useCallback } from 'react';

import { authAPI } from '../../api/handlers/auth.api';
import { useAuthStore } from '../../store/authStore';
import { supplierRegistrationSchema, SupplierRegistrationFormData } from '../../utils/validators';
import Input from '../../components/common/Input';
import Button from '../../components/common/Buttons';
import ImageUpload from '../../components/common/ImageUpload';
import LocationPicker from '../../components/common/LocationPickerSimple';

const RegisterSupplier = () => {
  const navigate = useNavigate();
  const { login } = useAuthStore();
  const [profileImage, setProfileImage] = useState<File | null>(null);

  const {
    register,
    handleSubmit,
    control,
    formState: { errors },
    setError,
    setValue,
    watch,
  } = useForm<SupplierRegistrationFormData>({
    resolver: zodResolver(supplierRegistrationSchema),
  });

  // Watch lat and long values for real-time updates
  const watchLat = watch('lat');
  const watchLong = watch('long');

  const registerMutation = useMutation({
    mutationFn: authAPI.registerSupplier,
    onSuccess: (data: any) => {
      login(data.user, data.token);
      toast.success('🎉 Registration successful! Welcome to Material Connect');
      navigate('/supplier/dashboard');
    },
    onError: (error: any) => {
      if (error.errors && typeof error.errors === 'object') {
        Object.keys(error.errors).forEach((field) => {
          const messages = error.errors[field];
          const message = Array.isArray(messages) ? messages[0] : messages;
          setError(field as any, {
            type: 'manual',
            message: message,
          });
        });
        toast.error('Please fix the errors in the form');
      } else {
        toast.error(error.message || 'Registration failed');
      }
    },
  });

  // ✅ FIXED: Pass data directly to API (FormData creation happens in API handler)
  const onSubmit = (data: SupplierRegistrationFormData) => {
    const submitData = {
      ...data,
      profile_image: profileImage || undefined,
    };
    
    console.log('📤 Submitting data:', submitData);
    registerMutation.mutate(submitData);
  };

  // Wrap in useCallback to prevent infinite re-renders
  const handleLocationSelect = useCallback((location: { lat: number; lng: number }) => {
    setValue('lat', location.lat);
    setValue('long', location.lng);
  }, [setValue]);

  // Wrap Autocomplete handler in useCallback
  const handlePlaceSelected = useCallback((place: any) => {
    console.log('📍 Selected Place:', place);
    
    if (place.formatted_address) {
      setValue('location', place.formatted_address);
    }
    
    if (place.geometry && place.geometry.location) {
      const lat = place.geometry.location.lat();
      const lng = place.geometry.location.lng();
      
      console.log('📍 Coordinates:', { lat, lng });
      
      setValue('lat', lat);
      setValue('long', lng);
      
      toast.success(`📍 Location set: ${lat.toFixed(4)}, ${lng.toFixed(4)}`);
    }
  }, [setValue]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary-50 via-white to-secondary-50 py-12 px-4">
      <div className="max-w-2xl mx-auto">
        {/* Back Button */}
        <Link
          to="/login"
          className="inline-flex items-center gap-2 text-secondary-600 hover:text-primary-600 mb-6 transition-colors"
        >
          <ArrowLeft size={20} />
          Back to Login
        </Link>

        {/* Header */}
        <div className="text-center mb-8">
          <img
            src="https://demowebportals.com/material_connect/public/assets/img/logo-text.png"
            alt="Material Connect"
            className="h-12 mx-auto mb-4"
          />
          <h1 className="text-3xl font-bold text-secondary-900">Create Supplier Account</h1>
          <p className="text-secondary-600 mt-2">Join our network and start supplying materials</p>
        </div>

        {/* Registration Form */}
        <div className="bg-white rounded-2xl shadow-card p-8">
          <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
            {/* Profile Image */}
            <ImageUpload
              label="Profile Image (Optional)"
              onChange={setProfileImage}
              error={errors.profile_image?.message}
            />

            {/* Personal Information Section */}
            <div className="space-y-4">
              <h3 className="text-lg font-semibold text-secondary-900 border-b pb-2">
                Personal Information
              </h3>

              <Input
                label="Full Name"
                type="text"
                placeholder="John Doe"
                icon={User}
                register={register('name')}
                error={errors.name?.message}
                required
              />

              <Input
                label="Email Address"
                type="email"
                placeholder="supplier@example.com"
                icon={Mail}
                register={register('email')}
                error={errors.email?.message}
                required
              />

              <Input
                label="Password"
                type="password"
                placeholder="••••••••"
                icon={Lock}
                register={register('password')}
                error={errors.password?.message}
                required
              />
            </div>

            {/* Business Information Section */}
            <div className="space-y-4">
              <h3 className="text-lg font-semibold text-secondary-900 border-b pb-2">
                Business Information
              </h3>

              <Input
                label="Company Name"
                type="text"
                placeholder="ABC Materials Supplier"
                icon={Building2}
                register={register('company_name')}
                error={errors.company_name?.message}
                required
              />

              <Input
                label="Contact Person Name"
                type="text"
                placeholder="Jane Smith"
                icon={User}
                register={register('contact_name')}
                error={errors.contact_name?.message}
                required
              />

              <Input
                label="Contact Number"
                type="tel"
                placeholder="+61 400 123 456" 
                icon={Phone}
                register={register('contact_number')}
                error={errors.contact_number?.message}
                required
              />
            </div>

            {/* Location (Google Autocomplete) */}
            <div className="space-y-4">
              <h3 className="text-lg font-semibold text-secondary-900 border-b pb-2">
                Business Location
              </h3>

              {/* hidden field bound to RHF */}
              <input type="hidden" {...register('location')} />

              <label className="block text-sm font-medium text-secondary-700">
                Location <span className="text-error-500">*</span>
              </label>
              <div className="relative">
                <MapPin className="absolute left-3 top-3.5 text-secondary-400 z-10" size={20} />
                <Autocomplete
                  apiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}
                  onPlaceSelected={(place: any) => {
                    const addr = place?.formatted_address ?? '';
                    setValue('location', addr, { shouldValidate: true, shouldDirty: true });
                  }}
                  options={{ types: ['address'], componentRestrictions: { country: 'au' } }}
                  className={`
                    w-full pl-10 pr-4 py-3 rounded-lg border-2 transition-all
                    ${errors.location
                      ? 'border-error-500 focus:border-error-500 focus:ring-error-500'
                      : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'}
                    focus:outline-none focus:ring-2 focus:ring-opacity-20
                  `}
                  placeholder="Start typing your business address..."
                />
              </div>
              {errors.location && <p className="text-sm text-error-500">{errors.location.message}</p>}
            </div>

            {/* Submit Button */}
            <Button
              type="submit"
              isLoading={registerMutation.isPending}
              disabled={registerMutation.isPending}
            >
              <UserPlus size={20} />
              {registerMutation.isPending ? 'Creating Account...' : 'Create Supplier Account'}
            </Button>

            {/* Login Link */}
            <p className="text-center text-sm text-secondary-600">
              Already have an account?{' '}
              <Link to="/login" className="text-primary-600 hover:text-primary-700 font-medium">
                Sign In
              </Link>
            </p>
          </form>
        </div>
      </div>
    </div>
  );
};

export default RegisterSupplier;
/* FILE: src/pages/shared/ProfileSettings.tsx */
// src/pages/shared/ProfileSettings.tsx
import { useState, useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useMutation, useQuery } from '@tanstack/react-query';
import { 
  User, 
  Mail, 
  Phone, 
  Building2, 
  MapPin, 
  Save,
  Camera,
  X,
  Truck,
  Home,
  Package,
  ShoppingCart,
  FolderOpen,
  Settings,
  BarChart,
  Users,
  DollarSign
} from 'lucide-react';
import toast from 'react-hot-toast';
import Autocomplete from 'react-google-autocomplete';

import { profileAPI } from '../../api/handlers/profile.api';
import { useAuthStore } from '../../store/authStore';
import { profileUpdateSchema, ProfileUpdateFormData } from '../../utils/validators';
import Input from '../../components/common/Input';
import Button from '../../components/common/Buttons';
import ChangePasswordSection from '../../components/profile/ChangePasswordSection';
import DashboardLayout from '../../components/layout/DashboardLayout';

const ProfileSettings = () => {
  const { user, updateUser } = useAuthStore();
  const [previewImage, setPreviewImage] = useState<string | null>(
    user?.profile_image ? `${import.meta.env.VITE_IMAGE_BASE_URL}${user.profile_image}` : null
  );
  const [imageFile, setImageFile] = useState<File | null>(null);
  const [locationCoords, setLocationCoords] = useState<{ lat: number; lng: number } | null>(
    user?.lat && user?.long ? { lat: user.lat, lng: user.long } : null
  );

  const {
    register,
    handleSubmit,
    formState: { errors, dirtyFields },
    setValue,
    watch,
    reset,
  } = useForm<ProfileUpdateFormData>({
    resolver: zodResolver(profileUpdateSchema),
  });

  // Refetch user data on mount to ensure fresh data
  const { refetch } = useQuery({
    queryKey: ['currentUser'],
    queryFn: profileAPI.getCurrentUser,
    onSuccess: (data: any) => {
      updateUser(data.user);
    },
  });

  // ✅ Update form values whenever user data changes (including company)
  useEffect(() => {
    if (user) {
      reset({
        name: user.name || '',
        email: user.email || '',
        contact_name: user.contact_name || '',
        contact_number: user.contact_number || '',
        company_name: user.company?.name || '',
        shipping_address: user.shipping_address || '',
        billing_address: user.billing_address || '',
        location: user.location || '',
        delivery_radius: user.delivery_radius || undefined,
      });

      // Update location coords if available
      if (user.lat && user.long) {
        setLocationCoords({ lat: user.lat, lng: user.long });
      }

      // Update preview image if available
      if (user.profile_image) {
        setPreviewImage(`${import.meta.env.VITE_IMAGE_BASE_URL}${user.profile_image}`);
      }
    }
  }, [user, reset]);

  const updateProfileMutation = useMutation({
    mutationFn: profileAPI.updateProfile,
    onSuccess: (data) => {
      updateUser(data.user);
      toast.success('✅ Profile updated successfully!');
      
      // Update preview image if new one was uploaded
      if (data.user.profile_image) {
        setPreviewImage(`${import.meta.env.VITE_IMAGE_BASE_URL}${data.user.profile_image}`);
      }
      
      // ✅ Reset form with updated values including company name
      reset({
        name: data.user.name,
        email: data.user.email,
        contact_name: data.user.contact_name,
        contact_number: data.user.contact_number,
        company_name: data.user.company?.name || '', // ✅ Fixed: Get from company
        shipping_address: data.user.shipping_address,
        billing_address: data.user.billing_address,
        location: data.user.location,
        delivery_radius: data.user.delivery_radius,
      });
      
      setImageFile(null);
    },
    onError: (error: Error) => {
      toast.error(error.message || 'Failed to update profile');
    },
  });

  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (file) {
      // Validate file type
      if (!file.type.startsWith('image/')) {
        toast.error('Please select an image file');
        return;
      }

      // Validate file size (max 2MB)
      if (file.size > 2 * 1024 * 1024) {
        toast.error('Image size should be less than 2MB');
        return;
      }

      setImageFile(file);
      const reader = new FileReader();
      reader.onloadend = () => {
        setPreviewImage(reader.result as string);
      };
      reader.readAsDataURL(file);
    }
  };

  const clearImage = () => {
    setPreviewImage(user?.profile_image ? `${import.meta.env.VITE_IMAGE_BASE_URL}${user.profile_image}` : null);
    setImageFile(null);
  };

  const handleShippingAddressSelect = (place: any) => {
    if (place.formatted_address) {
      setValue('shipping_address', place.formatted_address, { shouldDirty: true });
    }

    if (place.geometry?.location) {
      const lat = place.geometry.location.lat();
      const lng = place.geometry.location.lng();

      setLocationCoords({ lat, lng });
      setValue('lat', lat, { shouldDirty: true });
      setValue('long', lng, { shouldDirty: true });

      toast.success(`📍 Location updated: ${lat.toFixed(4)}, ${lng.toFixed(4)}`);
    }
  };

  const handleSupplierLocationSelect = (place: any) => {
    if (place.formatted_address) {
      setValue('location', place.formatted_address, { shouldDirty: true });
    }
  };

  const onSubmit = (data: ProfileUpdateFormData) => {
    // Build payload with only dirty fields
    const changedData: any = {};

    Object.keys(dirtyFields).forEach((key) => {
      const typedKey = key as keyof ProfileUpdateFormData;
      changedData[key] = data[typedKey];
    });

    // Add image if changed
    if (imageFile) {
      changedData.profile_image = imageFile;
    }

    // Validate: if shipping_address changed for client, lat/lng must be included
    if (
      user?.role === 'client' &&
      dirtyFields.shipping_address &&
      (!changedData.lat || !changedData.long)
    ) {
      toast.error('Please select a valid address with location coordinates');
      return;
    }

    // Check if there are any changes
    if (Object.keys(changedData).length === 0) {
      toast.info('No changes detected');
      return;
    }

    updateProfileMutation.mutate(changedData);
  };

  // ✅ Define menu items based on user role
  const getMenuItems = () => {
    if (user?.role === 'client') {
      return [
        { label: 'Dashboard', path: '/client/dashboard', icon: <Home size={20} /> },
        { label: 'Projects', path: '/client/projects', icon: <FolderOpen size={20} /> },
        { label: 'Orders', path: '/client/orders', icon: <ShoppingCart size={20} /> },
        { label: 'Products', path: '/client/products', icon: <Package size={20} /> },
        { label: 'Profile', path: '/client/profile', icon: <User size={20} /> },
        { label: 'Settings', path: '/client/settings', icon: <Settings size={20} /> },
      ];
    } else if (user?.role === 'supplier') {
      return [
        { label: 'Dashboard', path: '/supplier/dashboard', icon: <Home size={20} /> },
        { label: 'My Products', path: '/supplier/products', icon: <Package size={20} /> },
        { label: 'Orders', path: '/supplier/orders', icon: <DollarSign size={20} /> },
        { label: 'Delivery Zones', path: '/supplier/zones', icon: <MapPin size={20} /> },
        { label: 'Profile', path: '/supplier/profile', icon: <User size={20} /> },
        { label: 'Settings', path: '/supplier/settings', icon: <Settings size={20} /> },
      ];
    } else if (user?.role === 'admin') {
      return [
        { label: 'Dashboard', path: '/admin/dashboard', icon: <Home size={20} /> },
        { label: 'Users', path: '/admin/users', icon: <Users size={20} /> },
        { label: 'Products', path: '/admin/master-products', icon: <Package size={20} /> },
        { label: 'Supplier Delivery Zones', path: '/admin/supplier-zones', icon: <MapPin size={20} /> },
        { label: 'Orders', path: '/admin/orders', icon: <ShoppingCart size={20} /> },
        { label: 'Reports', path: '/admin/reports', icon: <BarChart size={20} /> },
        { label: 'Settings', path: '/admin/settings', icon: <Settings size={20} /> },
      ];
    }
    return [];
  };

  return (
    <DashboardLayout menuItems={getMenuItems()}>
      <div className="max-w-4xl mx-auto">{/* Header */}
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-secondary-900">Profile Settings</h1>
          <p className="text-secondary-600 mt-2">
            Manage your account information and preferences
          </p>
        </div>

        {/* Main Form Card */}
        <div className="bg-white rounded-2xl shadow-card p-8 mb-6">
          <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
            {/* Profile Image Section */}
            <div>
              <label className="block text-sm font-medium text-secondary-700 mb-4">
                Profile Photo
              </label>
              <div className="flex items-center gap-6">
                {/* Image Preview */}
                <div className="relative">
                  {previewImage ? (
                    <div className="relative w-24 h-24 rounded-full overflow-hidden border-4 border-secondary-200">
                      <img
                        src={previewImage}
                        alt="Profile"
                        className="w-full h-full object-cover"
                      />
                      {imageFile && (
                        <button
                          type="button"
                          onClick={clearImage}
                          className="absolute -top-2 -right-2 p-1.5 bg-error-500 text-white rounded-full hover:bg-error-600 transition-colors shadow-lg"
                        >
                          <X size={14} />
                        </button>
                      )}
                    </div>
                  ) : (
                    <div className="w-24 h-24 rounded-full border-4 border-dashed border-secondary-300 bg-secondary-50 flex items-center justify-center">
                      <User size={32} className="text-secondary-400" />
                    </div>
                  )}
                </div>

                {/* Upload Button */}
                <div className="flex-1">
                  <label className="cursor-pointer">
                    <input
                      type="file"
                      accept="image/*"
                      onChange={handleImageChange}
                      className="hidden"
                    />
                    <div className="inline-flex items-center gap-2 px-4 py-2.5 bg-primary-50 text-primary-600 rounded-lg hover:bg-primary-100 transition-all font-medium">
                      <Camera size={18} />
                      {previewImage ? 'Change Photo' : 'Upload Photo'}
                    </div>
                  </label>
                  <p className="text-xs text-secondary-500 mt-2">
                    PNG, JPG, GIF up to 2MB
                  </p>
                </div>
              </div>
            </div>

            {/* Personal Information */}
            <div className="space-y-5">
              <div className="flex items-center gap-3 pb-3 border-b border-secondary-200">
                <div className="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
                  <User size={20} className="text-primary-600" />
                </div>
                <h3 className="text-lg font-semibold text-secondary-900">
                  Personal Information
                </h3>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <Input
                  label="Full Name"
                  type="text"
                  placeholder="John Doe"
                  icon={User}
                  register={register('name')}
                  error={errors.name?.message}
                />

                <Input
                  label="Email Address"
                  type="email"
                  placeholder="john@example.com"
                  icon={Mail}
                  register={register('email')}
                  error={errors.email?.message}
                />
              </div>
            </div>

            {/* Contact Details */}
            <div className="space-y-5">
              <div className="flex items-center gap-3 pb-3 border-b border-secondary-200">
                <div className="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
                  <Phone size={20} className="text-primary-600" />
                </div>
                <h3 className="text-lg font-semibold text-secondary-900">
                  Contact Details
                </h3>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                <Input
                  label="Contact Person"
                  type="text"
                  placeholder="Jane Smith"
                  icon={User}
                  register={register('contact_name')}
                  error={errors.contact_name?.message}
                />

                <Input
                  label="Contact Number"
                  type="tel"
                  placeholder="+92 300 1234567"
                  icon={Phone}
                  register={register('contact_number')}
                  error={errors.contact_number?.message}
                />
              </div>

              <Input
                label="Company Name"
                type="text"
                placeholder="ABC Construction Ltd."
                icon={Building2}
                register={register('company_name')}
                error={errors.company_name?.message}
              />
            </div>

            {/* Client-Specific: Address Information */}
            {user?.role === 'client' && (
              <div className="space-y-5">
                <div className="flex items-center gap-3 pb-3 border-b border-secondary-200">
                  <div className="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
                    <MapPin size={20} className="text-primary-600" />
                  </div>
                  <h3 className="text-lg font-semibold text-secondary-900">
                    Address Information
                  </h3>
                </div>

                {/* Shipping Address with Google Autocomplete */}
                <div className="space-y-2">
                  <label className="block text-sm font-medium text-secondary-700">
                    Shipping Address
                  </label>
                  <div className="relative">
                    <MapPin className="absolute left-3 top-3.5 text-secondary-400 z-10" size={20} />
                    <Autocomplete
                      apiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}
                      onPlaceSelected={handleShippingAddressSelect}
                      options={{ types: ['address'], componentRestrictions: { country: 'au' } }}
                      defaultValue={user?.shipping_address || ''}
                      className={`
                        w-full pl-10 pr-4 py-3 rounded-lg border-2 transition-all
                        ${errors.shipping_address
                          ? 'border-error-500 focus:border-error-500 focus:ring-error-500'
                          : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'}
                        focus:outline-none focus:ring-2 focus:ring-opacity-20
                      `}
                      placeholder="Start typing your address..."
                    />
                  </div>
                  {errors.shipping_address && (
                    <p className="text-sm text-error-500">{errors.shipping_address.message}</p>
                  )}

                  {/* Location Coordinates Display */}
                  {locationCoords && (
                    <div className="bg-success-50 border border-success-200 rounded-lg p-3 mt-2">
                      <p className="text-xs text-success-700 font-medium flex items-center gap-2">
                        <MapPin size={14} />
                        Selected Location: {locationCoords.lat.toFixed(6)}, {locationCoords.lng.toFixed(6)}
                      </p>
                    </div>
                  )}
                </div>

                <Input
                  label="Billing Address"
                  type="text"
                  placeholder="Same as shipping or different address"
                  icon={Building2}
                  register={register('billing_address')}
                  error={errors.billing_address?.message}
                />
              </div>
            )}

            {/* Supplier-Specific: Business Location */}
            {user?.role === 'supplier' && (
              <div className="space-y-5">
                <div className="flex items-center gap-3 pb-3 border-b border-secondary-200">
                  <div className="w-10 h-10 rounded-lg bg-primary-100 flex items-center justify-center">
                    <MapPin size={20} className="text-primary-600" />
                  </div>
                  <h3 className="text-lg font-semibold text-secondary-900">
                    Business Location
                  </h3>
                </div>

                <div className="space-y-2">
                  <label className="block text-sm font-medium text-secondary-700">
                    Business Location
                  </label>
                  <div className="relative">
                    <MapPin className="absolute left-3 top-3.5 text-secondary-400 z-10" size={20} />
                    <Autocomplete
                      apiKey={import.meta.env.VITE_GOOGLE_MAPS_API_KEY}
                      onPlaceSelected={handleSupplierLocationSelect}
                      options={{ types: ['address'], componentRestrictions: { country: 'au' } }}
                      defaultValue={user?.location || ''}
                      className={`
                        w-full pl-10 pr-4 py-3 rounded-lg border-2 transition-all
                        ${errors.location
                          ? 'border-error-500 focus:border-error-500 focus:ring-error-500'
                          : 'border-secondary-200 focus:border-primary-500 focus:ring-primary-500'}
                        focus:outline-none focus:ring-2 focus:ring-opacity-20
                      `}
                      placeholder="Start typing your business address..."
                    />
                  </div>
                  {errors.location && (
                    <p className="text-sm text-error-500">{errors.location.message}</p>
                  )}
                </div>

                <Input
                  label="Delivery Radius (km)"
                  type="number"
                  placeholder="50"
                  icon={Truck}
                  register={register('delivery_radius', { valueAsNumber: true })}
                  error={errors.delivery_radius?.message}
                />
              </div>
            )}

            {/* Submit Button */}
            <div className="flex gap-4 pt-6 border-t border-secondary-200">
              <Button
                type="submit"
                isLoading={updateProfileMutation.isPending}
                disabled={updateProfileMutation.isPending}
                fullWidth={false}
                className="flex-1"
              >
                <Save size={20} />
                {updateProfileMutation.isPending ? 'Saving Changes...' : 'Save Changes'}
              </Button>

              <Button
                type="button"
                variant="outline"
                onClick={() => {
                  reset();
                  clearImage();
                  setLocationCoords(
                    user?.lat && user?.long ? { lat: user.lat, lng: user.long } : null
                  );
                }}
                fullWidth={false}
                className="flex-1"
              >
                Cancel
              </Button>
            </div>
          </form>
        </div>

        {/* Change Password Section - Separate Card */}
        <div className="bg-white rounded-2xl shadow-card p-8">
          <ChangePasswordSection />
        </div>
      </div>
    </DashboardLayout>
  );
};

export default ProfileSettings;
/* FILE: src/pages/supplier/Dashboard.tsx */
// src/pages/supplier/Dashboard.tsx
import { Home, Package, DollarSign, MapPin, Settings, User } from 'lucide-react';
import DashboardLayout from '../../components/layout/DashboardLayout';

const SupplierDashboard = () => {
  const menuItems = [
    { label: 'Dashboard', path: '/supplier/dashboard', icon: <Home size={20} /> },
    { label: 'My Products', path: '/supplier/products', icon: <Package size={20} /> },
    { label: 'Orders', path: '/supplier/orders', icon: <DollarSign size={20} /> },
    { label: 'Delivery Zones', path: '/supplier/zones', icon: <MapPin size={20} /> }, // 👈 ADD THIS
    { label: 'Profile', path: '/supplier/profile', icon: <User size={20} /> },
    { label: 'Settings', path: '/supplier/settings', icon: <Settings size={20} /> },
  ];

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="bg-white rounded-xl shadow-card p-8">
        <h1 className="text-3xl font-bold text-secondary-900">Supplier Dashboard</h1>
        <p className="text-secondary-600 mt-2">Manage your products and orders</p>
      </div>
    </DashboardLayout>
  );
};

export default SupplierDashboard;
/* FILE: src/pages/supplier/DeliveryZones.tsx */
// src/pages/supplier/DeliveryZones.tsx
import { Home, Package, DollarSign, MapPin, Settings, User } from 'lucide-react';
import DashboardLayout from '../../components/layout/DashboardLayout';
import DeliveryZonesManagement from '../../components/supplier/DeliveryZonesManagement';

const DeliveryZonesPage = () => {
  const menuItems = [
    { label: 'Dashboard', path: '/supplier/dashboard', icon: <Home size={20} /> },
    { label: 'My Products', path: '/supplier/products', icon: <Package size={20} /> },
    { label: 'Orders', path: '/supplier/orders', icon: <DollarSign size={20} /> },
    { label: 'Delivery Zones', path: '/supplier/zones', icon: <MapPin size={20} /> },
    { label: 'Profile', path: '/supplier/profile', icon: <User size={20} /> },
    { label: 'Settings', path: '/supplier/settings', icon: <Settings size={20} /> },
  ];

  return (
    <DashboardLayout menuItems={menuItems}>
      <DeliveryZonesManagement />
    </DashboardLayout>
  );
};

export default DeliveryZonesPage;
/* FILE: src/pages/supplier/ProductManagement.tsx */
// FILE PATH: src/pages/supplier/ProductManagement.tsx
import { useState, useMemo, useEffect } from 'react';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { 
  Home, 
  Package, 
  DollarSign, 
  MapPin, 
  Settings, 
  User,
  Search,
  Plus,
  Filter,
  Loader2,
  AlertCircle,
  X
} from 'lucide-react';
import toast from 'react-hot-toast';

import { 
  supplierProductsAPI, 
  MasterProduct, 
  SupplierOffer 
} from '../../api/handlers/supplierProducts.api';
import DashboardLayout from '../../components/layout/DashboardLayout';
import ProductCard from '../../components/supplier/ProductCard';
import AddOfferModal from '../../components/supplier/AddOfferModal';
import EditOfferModal from '../../components/supplier/EditOfferModal';
import RequestProductModal from '../../components/supplier/RequestProductModal';
import Pagination from '../../components/common/Pagination';
import Button from '../../components/common/Buttons';
import ConfirmModal from '../../components/common/ConfirmModal';

const PER_PAGE = 10;

const ProductManagement = () => {
  const queryClient = useQueryClient();

  // State
  const [page, setPage] = useState(1);
  const [searchQuery, setSearchQuery] = useState('');
  const [localSearch, setLocalSearch] = useState('');
  const [selectedCategory, setSelectedCategory] = useState<number | undefined>();
  const [statusFilter, setStatusFilter] = useState<'all' | 'my_offers' | 'not_added'>('all');
  
  // Modal states
  const [showAddModal, setShowAddModal] = useState(false);
  const [showEditModal, setShowEditModal] = useState(false);
  const [showRequestModal, setShowRequestModal] = useState(false);
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  
  // Selected items
  const [selectedProduct, setSelectedProduct] = useState<MasterProduct | null>(null);
  const [selectedOffer, setSelectedOffer] = useState<SupplierOffer | null>(null);
  const [deleteTarget, setDeleteTarget] = useState<{ id: number; name: string } | null>(null);

  // Debounce search
  useEffect(() => {
    const timer = setTimeout(() => {
      setSearchQuery(localSearch);
      setPage(1);
    }, 500);
    return () => clearTimeout(timer);
  }, [localSearch]);

  // Fetch products
  const { data: productsData, isLoading: isLoadingProducts } = useQuery({
    queryKey: ['supplier-products', page, searchQuery, selectedCategory],
    queryFn: () => supplierProductsAPI.getProducts({
      page,
      per_page: PER_PAGE,
      search: searchQuery || undefined,
      category_id: selectedCategory,
    }),
  });

  // Fetch categories
  const { data: categoriesData } = useQuery({
    queryKey: ['categories'],
    queryFn: supplierProductsAPI.getCategories,
  });

  // Delete mutation
  const deleteMutation = useMutation({
    mutationFn: supplierProductsAPI.deleteSupplierOffer,
    onSuccess: () => {
      toast.success('Product removed from your offers');
      queryClient.invalidateQueries({ queryKey: ['supplier-products'] });
      setShowDeleteModal(false);
      setDeleteTarget(null);
    },
    onError: (error: any) => {
      toast.error(error.response?.data?.message || 'Failed to remove product');
    },
  });

  // Menu items
  const menuItems = [
    { label: 'Dashboard', path: '/supplier/dashboard', icon: <Home size={20} /> },
    { label: 'My Products', path: '/supplier/products', icon: <Package size={20} /> },
    { label: 'Orders', path: '/supplier/orders', icon: <DollarSign size={20} /> },
    { label: 'Delivery Zones', path: '/supplier/zones', icon: <MapPin size={20} /> },
    { label: 'Profile', path: '/supplier/profile', icon: <User size={20} /> },
    { label: 'Settings', path: '/supplier/settings', icon: <Settings size={20} /> },
  ];

  // Filter products
  const filteredProducts = useMemo(() => {
    if (!productsData?.data) return [];
    
    let filtered = productsData.data;

    if (statusFilter === 'my_offers') {
      filtered = filtered.filter(p => p.suppliers.some(s => s.isMe));
    } else if (statusFilter === 'not_added') {
      filtered = filtered.filter(p => !p.suppliers.some(s => s.isMe));
    }

    return filtered;
  }, [productsData?.data, statusFilter]);

  // Calculate stats
  const stats = useMemo(() => {
    const total = filteredProducts.length;
    const myOffers = filteredProducts.filter(p => p.suppliers.some(s => s.isMe)).length;
    const notAdded = filteredProducts.filter(p => !p.suppliers.some(s => s.isMe)).length;

    return { total, myOffers, notAdded };
  }, [filteredProducts]);

  // Modal handlers
  const handleAddOffer = (product: MasterProduct) => {
    setSelectedProduct(product);
    setShowAddModal(true);
  };

  const handleEditOffer = (product: MasterProduct, offer: SupplierOffer) => {
    setSelectedProduct(product);
    setSelectedOffer(offer);
    setShowEditModal(true);
  };

  const handleRemoveOffer = (offerId: number, productName: string) => {
    setDeleteTarget({ id: offerId, name: productName });
    setShowDeleteModal(true);
  };

  const confirmDelete = () => {
    if (deleteTarget) {
      deleteMutation.mutate(deleteTarget.id);
    }
  };

  const clearFilters = () => {
    setLocalSearch('');
    setSearchQuery('');
    setSelectedCategory(undefined);
    setStatusFilter('all');
    setPage(1);
  };

  const hasFilters = searchQuery || selectedCategory || statusFilter !== 'all';

  // ✅ FIX: Proper pagination data with fallbacks
  const pagination = {
    currentPage: productsData?.current_page || 1,
    lastPage: productsData?.last_page || 1,
    total: productsData?.total || 0,
    perPage: productsData?.per_page || PER_PAGE,
    from: productsData?.from || 0,
    to: productsData?.to || 0,
  };

  return (
    <DashboardLayout menuItems={menuItems}>
      <div className="space-y-6">
        {/* Header */}
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-secondary-900">Product Management</h1>
            <p className="text-secondary-600 mt-1">
              Manage your product offers and request new products
            </p>
          </div>
          <Button
            onClick={() => setShowRequestModal(true)}
            variant="primary"
            fullWidth={false}
          >
            <Plus size={20} />
            Request Product
          </Button>
        </div>

        {/* Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div className="bg-white rounded-xl shadow-sm p-6 border border-secondary-100">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-secondary-600 mb-1">Total Products</p>
                <p className="text-3xl font-bold text-secondary-900">{stats.total}</p>
              </div>
              <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                <Package size={24} className="text-blue-600" />
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm p-6 border border-secondary-100">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-secondary-600 mb-1">My Offers</p>
                <p className="text-3xl font-bold text-success-600">{stats.myOffers}</p>
              </div>
              <div className="w-12 h-12 bg-success-100 rounded-lg flex items-center justify-center">
                <Package size={24} className="text-success-600" />
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm p-6 border border-secondary-100">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-secondary-600 mb-1">Not Added</p>
                <p className="text-3xl font-bold text-secondary-500">{stats.notAdded}</p>
              </div>
              <div className="w-12 h-12 bg-secondary-100 rounded-lg flex items-center justify-center">
                <Package size={24} className="text-secondary-500" />
              </div>
            </div>
          </div>
        </div>

        {/* Filters */}
        <div className="bg-white rounded-xl shadow-sm p-6">
          <div className="flex flex-col gap-4">
            {/* Search and Category */}
            <div className="flex flex-col md:flex-row gap-4">
              {/* Search */}
              <div className="flex-1 relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-secondary-400" size={20} />
                <input
                  type="text"
                  placeholder="Search products..."
                  value={localSearch}
                  onChange={(e) => setLocalSearch(e.target.value)}
                  className="w-full pl-10 pr-4 py-3 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500"
                />
              </div>

              {/* Category Filter */}
              <select
                value={selectedCategory || ''}
                onChange={(e) => {
                  setSelectedCategory(e.target.value ? Number(e.target.value) : undefined);
                  setPage(1);
                }}
                className="px-4 py-3 border-2 border-secondary-200 rounded-lg focus:outline-none focus:border-primary-500"
              >
                <option value="">All Categories</option>
                {categoriesData?.data.map((cat) => (
                  <option key={cat.id} value={cat.id}>
                    {cat.name}
                  </option>
                ))}
              </select>
            </div>

            {/* Status Filters */}
            <div className="flex flex-wrap gap-3">
              <button
                onClick={() => { setStatusFilter('all'); setPage(1); }}
                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                  statusFilter === 'all'
                    ? 'bg-primary-500 text-white'
                    : 'bg-secondary-100 text-secondary-700 hover:bg-secondary-200'
                }`}
              >
                All Products
              </button>
              <button
                onClick={() => { setStatusFilter('my_offers'); setPage(1); }}
                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                  statusFilter === 'my_offers'
                    ? 'bg-success-500 text-white'
                    : 'bg-secondary-100 text-secondary-700 hover:bg-secondary-200'
                }`}
              >
                My Offers
              </button>
              <button
                onClick={() => { setStatusFilter('not_added'); setPage(1); }}
                className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                  statusFilter === 'not_added'
                    ? 'bg-error-500 text-white'
                    : 'bg-secondary-100 text-secondary-700 hover:bg-secondary-200'
                }`}
              >
                Not Added
              </button>
              
              {hasFilters && (
                <button
                  onClick={clearFilters}
                  className="px-4 py-2 rounded-lg font-medium bg-secondary-100 text-secondary-700 hover:bg-secondary-200 transition-colors flex items-center gap-2"
                >
                  <X size={16} />
                  Clear Filters
                </button>
              )}
            </div>
          </div>
        </div>

        {/* Products Grid */}
        <div className="bg-white rounded-xl shadow-sm p-6">
          {isLoadingProducts ? (
            <div className="flex items-center justify-center py-12">
              <Loader2 className="animate-spin text-primary-500" size={32} />
            </div>
          ) : filteredProducts.length === 0 ? (
            <div className="text-center py-12">
              <AlertCircle className="mx-auto text-secondary-400 mb-4" size={48} />
              <p className="text-secondary-600 text-lg">No products found</p>
              <p className="text-secondary-500 text-sm mt-2">
                Try adjusting your filters or search term
              </p>
            </div>
          ) : (
            <>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {filteredProducts.map((product) => (
                  <ProductCard
                    key={product.id}
                    product={product}
                    onAddOffer={handleAddOffer}
                    onEditOffer={handleEditOffer}
                    onRemoveOffer={handleRemoveOffer}
                  />
                ))}
              </div>

              {/* Pagination */}
              {pagination.total > 0 && (
                <div className="mt-6">
                  <Pagination
                    currentPage={pagination.currentPage}
                    lastPage={pagination.lastPage}
                    total={pagination.total}
                    perPage={pagination.perPage}
                    onPageChange={(newPage) => setPage(newPage)}
                    loading={isLoadingProducts}
                  />
                </div>
              )}
            </>
          )}
        </div>
      </div>

      {/* Modals */}
      <AddOfferModal
        isOpen={showAddModal}
        onClose={() => {
          setShowAddModal(false);
          setSelectedProduct(null);
        }}
        product={selectedProduct}
      />

      <EditOfferModal
        isOpen={showEditModal}
        onClose={() => {
          setShowEditModal(false);
          setSelectedProduct(null);
          setSelectedOffer(null);
        }}
        product={selectedProduct}
        offer={selectedOffer}
      />

      <RequestProductModal
        isOpen={showRequestModal}
        onClose={() => setShowRequestModal(false)}
        categories={categoriesData?.data || []}
      />

      <ConfirmModal
        isOpen={showDeleteModal}
        onClose={() => {
          setShowDeleteModal(false);
          setDeleteTarget(null);
        }}
        onConfirm={confirmDelete}
        title="Remove Product from Offers"
        message={`Are you sure you want to remove "${deleteTarget?.name}" from your offers? This action cannot be undone.`}
        confirmText="Remove"
        isLoading={deleteMutation.isPending}
      />
    </DashboardLayout>
  );
};

export default ProductManagement;
/* FILE: src/routes/index.tsx */
// src/routes/index.tsx
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import ProtectedRoute from './ProtectedRoute';

// Import pages
import Login from '../pages/public/Login';
import RegisterClient from '../pages/public/RegisterClient';
import RegisterSupplier from '../pages/public/RegisterSupplier';

import ClientDashboard from '../pages/client/Dashboard';
import SupplierDashboard from '../pages/supplier/Dashboard';
import AdminDashboard from '../pages/admin/Dashboard';

// Admin - User Management
import UserManagement from '../pages/admin/UserManagement';
import UserDetail from '../pages/admin/UserDetail';
import UserEdit from '../pages/admin/UserEdit';
import UserCreate from '../pages/admin/UserCreate';

//Admin Supplier Delivery Zones
import AdminSupplierDeliveryZones from '../pages/admin/AdminSupplierDeliveryZones';

//Admin Master Products
import MasterProductsList from '../pages/admin/MasterProducts/MasterProductsList';
import AddMasterProduct from '../pages/admin/MasterProducts/AddMasterProduct';
import EditMasterProduct from '../pages/admin/MasterProducts/EditMasterProduct';
import ViewMasterProduct from '../pages/admin/MasterProducts/ViewMasterProduct';

//Client Projects
import ProjectsList from '../pages/client/projects/ProjectsList';
import ProjectDetail from '../pages/client/projects/ProjectDetail';
import ProjectEdit from '../pages/client/projects/ProjectEdit';
import ProjectCreate from '../pages/client/projects/ProjectCreate';

//Supplier Delivery Zones
import DeliveryZonesPage from '../pages/supplier/DeliveryZones';
import ProductManagement from '../pages/supplier/ProductManagement';

// Shared
import ProfileSettings from '../pages/shared/ProfileSettings';

const AppRouter = () => {
  return (
    <BrowserRouter>
      <Routes>
        {/* Public Routes */}
        <Route path="/login" element={<Login />} />
        <Route path="/register/client" element={<RegisterClient />} />
        <Route path="/register/supplier" element={<RegisterSupplier />} />

        {/* Client Routes */}
        <Route
          path="/client/dashboard"
          element={
            <ProtectedRoute allowedRoles={['client']}>
              <ClientDashboard />
            </ProtectedRoute>
          }
        />
        <Route
          path="/client/profile"
          element={
            <ProtectedRoute allowedRoles={['client']}>
              <ProfileSettings />
            </ProtectedRoute>
          }
        />
        <Route
          path="/client/projects"
          element={
            <ProtectedRoute allowedRoles={['client']}>
              <ProjectsList />
            </ProtectedRoute>
          }
        />
        <Route
          path="/client/projects/create"
          element={
            <ProtectedRoute allowedRoles={['client']}>
              <ProjectCreate />
            </ProtectedRoute>
          }
        />
        <Route
          path="/client/projects/:id"
          element={
            <ProtectedRoute allowedRoles={['client']}>
              <ProjectDetail />
            </ProtectedRoute>
          }
        />
        <Route
          path="/client/projects/:id/edit"
          element={
            <ProtectedRoute allowedRoles={['client']}>
              <ProjectEdit />
            </ProtectedRoute>
          }
        />


        {/* Supplier Routes */}
        <Route
          path="/supplier/dashboard"
          element={
            <ProtectedRoute allowedRoles={['supplier']}>
              <SupplierDashboard />
            </ProtectedRoute>
          }
        />
        <Route
          path="/supplier/profile"
          element={
            <ProtectedRoute allowedRoles={['supplier']}>
              <ProfileSettings />
            </ProtectedRoute>
          }
        />
        <Route
          path="/supplier/zones"
          element={
            <ProtectedRoute allowedRoles={['supplier']}>
              <DeliveryZonesPage />
            </ProtectedRoute>
          }
        />
        <Route
          path="/supplier/products"
          element={
            <ProtectedRoute allowedRoles={['supplier']}>
              <ProductManagement />
            </ProtectedRoute>
          }
        />

        {/* Admin Routes - IMPORTANT: ORDER MATTERS! */}
        <Route
          path="/admin/dashboard"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <AdminDashboard />
            </ProtectedRoute>
          }
        />
        
        {/* NEW: Supplier Delivery Zones */}
        <Route
          path="/admin/supplier-zones"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <AdminSupplierDeliveryZones />
            </ProtectedRoute>
          }
        />

        {/* User Management - Specific routes BEFORE dynamic :id */}
        <Route
          path="/admin/users"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <UserManagement />
            </ProtectedRoute>
          }
        />
        
        {/* CREATE - Must come before :id */}
        <Route
          path="/admin/users/create"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <UserCreate />
            </ProtectedRoute>
          }
        />
        
        {/* EDIT - Must come before plain :id */}
        <Route
          path="/admin/users/:id/edit"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <UserEdit />
            </ProtectedRoute>
          }
        />
        
        {/* VIEW - Dynamic route comes LAST */}
        <Route
          path="/admin/users/:id"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <UserDetail />
            </ProtectedRoute>
          }
        />

        {/* Master Products Routes */}
        <Route
          path="/admin/master-products"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <MasterProductsList />
            </ProtectedRoute>
          }
        />
        <Route
          path="/admin/master-products/add"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <AddMasterProduct />
            </ProtectedRoute>
          }
        />
        <Route
          path="/admin/master-products/edit/:id"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <EditMasterProduct />
            </ProtectedRoute>
          }
        />
        <Route
          path="/admin/master-products/view/:id"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <ViewMasterProduct />
            </ProtectedRoute>
          }
        />
        
        <Route
          path="/admin/profile"
          element={
            <ProtectedRoute allowedRoles={['admin']}>
              <ProfileSettings />
            </ProtectedRoute>
          }
        />

        {/* Fallback */}
        <Route path="/" element={<Navigate to="/login" replace />} />
        <Route path="*" element={<Navigate to="/login" replace />} />
      </Routes>
    </BrowserRouter>
  );
};

export default AppRouter;
/* FILE: src/routes/ProtectedRoute.tsx */
// src/routes/ProtectedRoute.tsx
import { Navigate } from 'react-router-dom';
import { useAuthStore } from '../store/authStore';
import { ReactNode } from 'react';

interface ProtectedRouteProps {
  children: ReactNode;
  allowedRoles?: ('admin' | 'client' | 'supplier')[];
}

const ProtectedRoute = ({ children, allowedRoles }: ProtectedRouteProps) => {
  const { isAuthenticated, user } = useAuthStore();

  if (!isAuthenticated) {
    return <Navigate to="/login" replace />;
  }

  if (allowedRoles && user && !allowedRoles.includes(user.role)) {
    const dashboardMap: Record<string, string> = {
      admin: '/admin/dashboard',
      client: '/client/dashboard',
      supplier: '/supplier/dashboard',
    };
    return <Navigate to={dashboardMap[user.role] || '/login'} replace />;
  }

  return <>{children}</>;
};

export default ProtectedRoute;
/* FILE: src/store/authStore.ts */
// src/store/authStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface Company {
  id: number;
  name: string;
  created_at: string;
  updated_at: string;
}

interface User {
  id: number;
  name: string;
  email: string;
  role: 'admin' | 'client' | 'supplier';
  profile_image?: string;
  company_id?: number;
  contact_name?: string;
  contact_number?: string;
  location?: string;
  lat?: number;
  long?: number;
  delivery_radius?: number;
  shipping_address?: string;
  billing_address?: string;
  company?: {
    id: number;
    name: string;
  };
}

interface AuthState {
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;
  login: (user: User, token: string) => void;
  logout: () => void;
  updateUser: (userData: Partial<User>) => void;
  setToken: (token: string) => void; // ✅ NEW: Update token only
  isAdmin: () => boolean;
  isClient: () => boolean;
  isSupplier: () => boolean;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set, get) => ({
      user: null,
      token: null,
      isAuthenticated: false,
      
      // Actions
      login: (user, token) => {
        set({ user, token, isAuthenticated: true });
      },
      
      logout: () => {
        set({ user: null, token: null, isAuthenticated: false });
        localStorage.clear();
      },
      
      updateUser: (userData) => {
        set((state) => {
          if (!state.user) return state;
          
          console.log('Current user:', state.user);
          console.log('Updating with:', userData);
          
          const updatedUser = {
            ...state.user,
            ...userData,
            // Ensure nested objects like company are properly merged
            ...(userData.company && {
              company: {
                ...state.user.company,
                ...userData.company,
              },
            }),
          };
          
          console.log('Updated user:', updatedUser);
          
          return { user: updatedUser };
        });
      },
      
      // ✅ NEW: Set token only (for password change)
      setToken: (token) => {
        set({ token });
      },
      
      // Role checks
      isAdmin: () => get().user?.role === 'admin',
      isClient: () => get().user?.role === 'client',
      isSupplier: () => get().user?.role === 'supplier',
    }),
    {
      name: 'auth-storage',
    }
  )
);
/* FILE: src/utils/validators.ts */
// src/utils/validators.ts
import { z } from 'zod';

// ==================== AUTH SCHEMAS ====================

export const loginSchema = z.object({
  email: z.string().email('Invalid email address'),
  password: z.string().min(6, 'Password must be at least 6 characters'),
});

export const clientRegistrationSchema = z.object({
  name: z.string().min(1, 'Name is required'),
  email: z.string().email('Invalid email address'),
  password: z.string().min(6, 'Password must be at least 6 characters'),
  contact_name: z.string().min(1, 'Contact name is required'),
  contact_number: z.string().min(1, 'Contact number is required'),
  shipping_address: z.string().min(1, 'Shipping address is required'),
  billing_address: z.string().min(1, 'Billing address is required'),
  company_name: z.string().optional(),
  profile_image: z.any().optional(),
  lat: z.number(),
  long: z.number(),
});

export const supplierRegistrationSchema = z.object({
  name: z.string().min(1, 'Name is required'),
  email: z.string().email('Invalid email address'),
  password: z.string().min(6, 'Password must be at least 6 characters'),
  contact_name: z.string().min(1, 'Contact name is required'),
  contact_number: z.string().min(1, 'Contact number is required'),
  location: z.string().min(1, 'Location is required'),
  company_name: z.string().min(1, 'Company name is required'),
  profile_image: z.any().optional(),
});

// ==================== PROFILE SCHEMAS ====================

export const profileUpdateSchema = z.object({
  name: z.string().min(1, 'Name is required').optional(),
  email: z.string().email('Invalid email address').optional(),
  contact_name: z.string().optional(),
  contact_number: z.string().optional(),
  company_name: z.string().optional(),
  profile_image: z.any().optional(),
  
  // Client-specific fields
  shipping_address: z.string().optional(),
  billing_address: z.string().optional(),
  lat: z.number().optional(),
  long: z.number().optional(),
  
  // Supplier-specific fields
  location: z.string().optional(),
  delivery_radius: z.number().positive('Delivery radius must be positive').optional(),
});

export const changePasswordSchema = z.object({
  current_password: z.string().min(1, 'Current password is required'),
  new_password: z.string().min(6, 'New password must be at least 6 characters'),
  new_password_confirmation: z.string().min(1, 'Please confirm your password'),
}).refine((data) => data.new_password === data.new_password_confirmation, {
  message: "Passwords don't match",
  path: ['new_password_confirmation'],
});



// ==================== SUPPLIER PRODUCT MANAGEMENT SCHEMAS ====================

/**
 * Schema for adding a product to supplier offers
 */
export const addOfferSchema = z.object({
  price: z.string()
    .min(1, 'Price is required')
    .refine(
      (val) => !isNaN(parseFloat(val)) && parseFloat(val) > 0,
      { message: 'Price must be a positive number' }
    ),
  
  availability_status: z.enum(['In Stock', 'Out of Stock', 'Limited Stock'], {
    required_error: 'Availability status is required',
  }),
});
/**
 * Schema for updating supplier offer
 */
export const updateOfferSchema = z.object({
  price: z.string()
    .min(1, 'Price is required')
    .refine(
      (val) => !isNaN(parseFloat(val)) && parseFloat(val) > 0,
      { message: 'Price must be a positive number' }
    ),
  
  availability_status: z.enum(['In Stock', 'Out of Stock', 'Limited Stock'], {
    required_error: 'Availability status is required',
  }),
});

/**
 * Schema for requesting new master product
 */
export const requestProductSchema = z.object({
  product_name: z.string()
    .min(1, 'Product name is required')
    .min(3, 'Product name must be at least 3 characters')
    .max(255, 'Product name must not exceed 255 characters'),

  product_type: z.string()
    .min(1, 'Product type is required')
    .max(255, 'Product type must not exceed 255 characters'),

  // category_id is NUMBER (as per your API)
  category_id: z.number({
    required_error: 'Category is required',
    invalid_type_error: 'Category must be selected',
  }).positive('Please select a valid category'),

  unit_of_measure: z.string()
    .min(1, 'Unit of measure is required')
    .max(50, 'Unit of measure must not exceed 50 characters'),

  specifications: z.string()
    .max(1000, 'Specifications must not exceed 1000 characters')
    .optional(),

  // ========== NEW FIELD: Price ==========
  price: z.string()
    .min(1, 'Price is required')
    .refine(
      (val) => !isNaN(parseFloat(val)) && parseFloat(val) > 0,
      { message: 'Price must be a positive number' }
    ),

  // ========== NEW FIELD: Availability Status ==========
  availability_status: z.enum(
    ['In Stock', 'Out of Stock', 'Limited'],
    {
      required_error: 'Availability status is required',
      invalid_type_error: 'Please select a valid availability status',
    }
  ),
});




// ==================== TYPE EXPORTS ====================

export type LoginFormData = z.infer<typeof loginSchema>;
export type ClientRegistrationFormData = z.infer<typeof clientRegistrationSchema>;
export type SupplierRegistrationFormData = z.infer<typeof supplierRegistrationSchema>;
export type ProfileUpdateFormData = z.infer<typeof profileUpdateSchema>;
export type ChangePasswordFormData = z.infer<typeof changePasswordSchema>;
export type RequestProductFormData = z.infer<typeof requestProductSchema>;
export type AddOfferFormData = z.infer<typeof addOfferSchema>;
export type UpdateOfferFormData = z.infer<typeof updateOfferSchema>;
/* FILE: src/vite-env.d.ts */
// src/vite-env.d.ts
interface ImportMetaEnv {
  readonly VITE_GOOGLE_MAPS_API_KEY: string;
}
interface ImportMeta {
  readonly env: ImportMetaEnv;
}
